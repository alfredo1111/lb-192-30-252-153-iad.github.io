!function(g){var I={};function C(A){if(I[A])return I[A].exports;var n=I[A]={i:A,l:!1,exports:{}};return g[A].call(n.exports,n,n.exports,C),n.l=!0,n.exports}C.m=g,C.c=I,C.d=function(g,I,A){C.o(g,I)||Object.defineProperty(g,I,{configurable:!1,enumerable:!0,get:A})},C.r=function(g){Object.defineProperty(g,"__esModule",{value:!0})},C.n=function(g){var I=g&&g.__esModule?function(){return g.default}:function(){return g};return C.d(I,"a",I),I},C.o=function(g,I){return Object.prototype.hasOwnProperty.call(g,I)},C.p="",C(C.s=11)}([function(module,__webpack_exports__,__webpack_require__){"use strict";eval('/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "a", function() { return LogLevel; });\n// Copyright (c) .NET Foundation. All rights reserved.\r\n// Licensed under the Apache License, Version 2.0. See License.txt in the project root for license information.\r\nvar LogLevel;\r\n(function (LogLevel) {\r\n    LogLevel[LogLevel["Trace"] = 0] = "Trace";\r\n    LogLevel[LogLevel["Information"] = 1] = "Information";\r\n    LogLevel[LogLevel["Warning"] = 2] = "Warning";\r\n    LogLevel[LogLevel["Error"] = 3] = "Error";\r\n    LogLevel[LogLevel["None"] = 4] = "None";\r\n})(LogLevel || (LogLevel = {}));\r\n//# sourceMappingURL=ILogger.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9ub2RlX21vZHVsZXMvQGFzcG5ldC9zaWduYWxyL2Rpc3QvZXNtL0lMb2dnZXIuanM/NzgzNSJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLENBQUMsNEJBQTRCO0FBQzdCIiwiZmlsZSI6IjAuanMiLCJzb3VyY2VzQ29udGVudCI6WyIvLyBDb3B5cmlnaHQgKGMpIC5ORVQgRm91bmRhdGlvbi4gQWxsIHJpZ2h0cyByZXNlcnZlZC5cclxuLy8gTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMC4gU2VlIExpY2Vuc2UudHh0IGluIHRoZSBwcm9qZWN0IHJvb3QgZm9yIGxpY2Vuc2UgaW5mb3JtYXRpb24uXHJcbmV4cG9ydCB2YXIgTG9nTGV2ZWw7XHJcbihmdW5jdGlvbiAoTG9nTGV2ZWwpIHtcclxuICAgIExvZ0xldmVsW0xvZ0xldmVsW1wiVHJhY2VcIl0gPSAwXSA9IFwiVHJhY2VcIjtcclxuICAgIExvZ0xldmVsW0xvZ0xldmVsW1wiSW5mb3JtYXRpb25cIl0gPSAxXSA9IFwiSW5mb3JtYXRpb25cIjtcclxuICAgIExvZ0xldmVsW0xvZ0xldmVsW1wiV2FybmluZ1wiXSA9IDJdID0gXCJXYXJuaW5nXCI7XHJcbiAgICBMb2dMZXZlbFtMb2dMZXZlbFtcIkVycm9yXCJdID0gM10gPSBcIkVycm9yXCI7XHJcbiAgICBMb2dMZXZlbFtMb2dMZXZlbFtcIk5vbmVcIl0gPSA0XSA9IFwiTm9uZVwiO1xyXG59KShMb2dMZXZlbCB8fCAoTG9nTGV2ZWwgPSB7fSkpO1xyXG4vLyMgc291cmNlTWFwcGluZ1VSTD1JTG9nZ2VyLmpzLm1hcCJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///0\n')},function(module,__webpack_exports__,__webpack_require__){"use strict";eval('\n// CONCATENATED MODULE: ./node_modules/@aspnet/signalr/dist/esm/AbortController.js\n// Copyright (c) .NET Foundation. All rights reserved.\r\n// Licensed under the Apache License, Version 2.0. See License.txt in the project root for license information.\r\n// Rough polyfill of https://developer.mozilla.org/en-US/docs/Web/API/AbortController\r\n// We don\'t actually ever use the API being polyfilled, we always use the polyfill because\r\n// it\'s a very new API right now.\r\nclass AbortController {\r\n    constructor() {\r\n        this.isAborted = false;\r\n    }\r\n    abort() {\r\n        if (!this.isAborted) {\r\n            this.isAborted = true;\r\n            if (this.onabort) {\r\n                this.onabort();\r\n            }\r\n        }\r\n    }\r\n    get signal() {\r\n        return this;\r\n    }\r\n    get aborted() {\r\n        return this.isAborted;\r\n    }\r\n}\r\n//# sourceMappingURL=AbortController.js.map\n// EXTERNAL MODULE: ./node_modules/@aspnet/signalr/dist/esm/Errors.js\nvar Errors = __webpack_require__(3);\n\n// EXTERNAL MODULE: ./node_modules/@aspnet/signalr/dist/esm/ILogger.js\nvar ILogger = __webpack_require__(0);\n\n// EXTERNAL MODULE: ./node_modules/@aspnet/signalr/dist/esm/Utils.js\nvar Utils = __webpack_require__(2);\n\n// CONCATENATED MODULE: ./node_modules/@aspnet/signalr/dist/esm/Transports.js\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "d", function() { return TransportType; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "c", function() { return TransferFormat; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "e", function() { return Transports_WebSocketTransport; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "b", function() { return Transports_ServerSentEventsTransport; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "a", function() { return Transports_LongPollingTransport; });\n// Copyright (c) .NET Foundation. All rights reserved.\r\n// Licensed under the Apache License, Version 2.0. See License.txt in the project root for license information.\r\nvar __awaiter = (undefined && undefined.__awaiter) || function (thisArg, _arguments, P, generator) {\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n};\r\n\r\n\r\n\r\n\r\nvar TransportType;\r\n(function (TransportType) {\r\n    TransportType[TransportType["WebSockets"] = 0] = "WebSockets";\r\n    TransportType[TransportType["ServerSentEvents"] = 1] = "ServerSentEvents";\r\n    TransportType[TransportType["LongPolling"] = 2] = "LongPolling";\r\n})(TransportType || (TransportType = {}));\r\nvar TransferFormat;\r\n(function (TransferFormat) {\r\n    TransferFormat[TransferFormat["Text"] = 1] = "Text";\r\n    TransferFormat[TransferFormat["Binary"] = 2] = "Binary";\r\n})(TransferFormat || (TransferFormat = {}));\r\nclass Transports_WebSocketTransport {\r\n    constructor(accessTokenFactory, logger) {\r\n        this.logger = logger;\r\n        this.accessTokenFactory = accessTokenFactory || (() => null);\r\n    }\r\n    connect(url, transferFormat, connection) {\r\n        Utils["a" /* Arg */].isRequired(url, "url");\r\n        Utils["a" /* Arg */].isRequired(transferFormat, "transferFormat");\r\n        Utils["a" /* Arg */].isIn(transferFormat, TransferFormat, "transferFormat");\r\n        Utils["a" /* Arg */].isRequired(connection, "connection");\r\n        if (typeof (WebSocket) === "undefined") {\r\n            throw new Error("\'WebSocket\' is not supported in your environment.");\r\n        }\r\n        this.logger.log(ILogger["a" /* LogLevel */].Trace, "(WebSockets transport) Connecting");\r\n        return new Promise((resolve, reject) => {\r\n            url = url.replace(/^http/, "ws");\r\n            const token = this.accessTokenFactory();\r\n            if (token) {\r\n                url += (url.indexOf("?") < 0 ? "?" : "&") + `access_token=${encodeURIComponent(token)}`;\r\n            }\r\n            const webSocket = new WebSocket(url);\r\n            if (transferFormat === TransferFormat.Binary) {\r\n                webSocket.binaryType = "arraybuffer";\r\n            }\r\n            webSocket.onopen = (event) => {\r\n                this.logger.log(ILogger["a" /* LogLevel */].Information, `WebSocket connected to ${url}`);\r\n                this.webSocket = webSocket;\r\n                resolve();\r\n            };\r\n            webSocket.onerror = (event) => {\r\n                reject(event.error);\r\n            };\r\n            webSocket.onmessage = (message) => {\r\n                this.logger.log(ILogger["a" /* LogLevel */].Trace, `(WebSockets transport) data received. ${getDataDetail(message.data)}.`);\r\n                if (this.onreceive) {\r\n                    this.onreceive(message.data);\r\n                }\r\n            };\r\n            webSocket.onclose = (event) => {\r\n                // webSocket will be null if the transport did not start successfully\r\n                if (this.onclose && this.webSocket) {\r\n                    if (event.wasClean === false || event.code !== 1000) {\r\n                        this.onclose(new Error(`Websocket closed with status code: ${event.code} (${event.reason})`));\r\n                    }\r\n                    else {\r\n                        this.onclose();\r\n                    }\r\n                }\r\n            };\r\n        });\r\n    }\r\n    send(data) {\r\n        if (this.webSocket && this.webSocket.readyState === WebSocket.OPEN) {\r\n            this.logger.log(ILogger["a" /* LogLevel */].Trace, `(WebSockets transport) sending data. ${getDataDetail(data)}.`);\r\n            this.webSocket.send(data);\r\n            return Promise.resolve();\r\n        }\r\n        return Promise.reject("WebSocket is not in the OPEN state");\r\n    }\r\n    stop() {\r\n        if (this.webSocket) {\r\n            this.webSocket.close();\r\n            this.webSocket = null;\r\n        }\r\n        return Promise.resolve();\r\n    }\r\n}\r\nclass Transports_ServerSentEventsTransport {\r\n    constructor(httpClient, accessTokenFactory, logger) {\r\n        this.httpClient = httpClient;\r\n        this.accessTokenFactory = accessTokenFactory || (() => null);\r\n        this.logger = logger;\r\n    }\r\n    connect(url, transferFormat, connection) {\r\n        Utils["a" /* Arg */].isRequired(url, "url");\r\n        Utils["a" /* Arg */].isRequired(transferFormat, "transferFormat");\r\n        Utils["a" /* Arg */].isIn(transferFormat, TransferFormat, "transferFormat");\r\n        Utils["a" /* Arg */].isRequired(connection, "connection");\r\n        if (typeof (EventSource) === "undefined") {\r\n            throw new Error("\'EventSource\' is not supported in your environment.");\r\n        }\r\n        this.logger.log(ILogger["a" /* LogLevel */].Trace, "(SSE transport) Connecting");\r\n        this.url = url;\r\n        return new Promise((resolve, reject) => {\r\n            if (transferFormat !== TransferFormat.Text) {\r\n                reject(new Error("The Server-Sent Events transport only supports the \'Text\' transfer format"));\r\n            }\r\n            const token = this.accessTokenFactory();\r\n            if (token) {\r\n                url += (url.indexOf("?") < 0 ? "?" : "&") + `access_token=${encodeURIComponent(token)}`;\r\n            }\r\n            const eventSource = new EventSource(url, { withCredentials: true });\r\n            try {\r\n                eventSource.onmessage = (e) => {\r\n                    if (this.onreceive) {\r\n                        try {\r\n                            this.logger.log(ILogger["a" /* LogLevel */].Trace, `(SSE transport) data received. ${getDataDetail(e.data)}.`);\r\n                            this.onreceive(e.data);\r\n                        }\r\n                        catch (error) {\r\n                            if (this.onclose) {\r\n                                this.onclose(error);\r\n                            }\r\n                            return;\r\n                        }\r\n                    }\r\n                };\r\n                eventSource.onerror = (e) => {\r\n                    reject(new Error(e.message || "Error occurred"));\r\n                    // don\'t report an error if the transport did not start successfully\r\n                    if (this.eventSource && this.onclose) {\r\n                        this.onclose(new Error(e.message || "Error occurred"));\r\n                    }\r\n                };\r\n                eventSource.onopen = () => {\r\n                    this.logger.log(ILogger["a" /* LogLevel */].Information, `SSE connected to ${this.url}`);\r\n                    this.eventSource = eventSource;\r\n                    // SSE is a text protocol\r\n                    resolve();\r\n                };\r\n            }\r\n            catch (e) {\r\n                return Promise.reject(e);\r\n            }\r\n        });\r\n    }\r\n    send(data) {\r\n        return __awaiter(this, void 0, void 0, function* () {\r\n            return send(this.logger, "SSE", this.httpClient, this.url, this.accessTokenFactory, data);\r\n        });\r\n    }\r\n    stop() {\r\n        if (this.eventSource) {\r\n            this.eventSource.close();\r\n            this.eventSource = null;\r\n        }\r\n        return Promise.resolve();\r\n    }\r\n}\r\nclass Transports_LongPollingTransport {\r\n    constructor(httpClient, accessTokenFactory, logger) {\r\n        this.httpClient = httpClient;\r\n        this.accessTokenFactory = accessTokenFactory || (() => null);\r\n        this.logger = logger;\r\n        this.pollAbort = new AbortController();\r\n    }\r\n    connect(url, transferFormat, connection) {\r\n        Utils["a" /* Arg */].isRequired(url, "url");\r\n        Utils["a" /* Arg */].isRequired(transferFormat, "transferFormat");\r\n        Utils["a" /* Arg */].isIn(transferFormat, TransferFormat, "transferFormat");\r\n        Utils["a" /* Arg */].isRequired(connection, "connection");\r\n        this.url = url;\r\n        this.logger.log(ILogger["a" /* LogLevel */].Trace, "(LongPolling transport) Connecting");\r\n        // Set a flag indicating we have inherent keep-alive in this transport.\r\n        connection.features.inherentKeepAlive = true;\r\n        if (transferFormat === TransferFormat.Binary && (typeof new XMLHttpRequest().responseType !== "string")) {\r\n            // This will work if we fix: https://github.com/aspnet/SignalR/issues/742\r\n            throw new Error("Binary protocols over XmlHttpRequest not implementing advanced features are not supported.");\r\n        }\r\n        this.poll(this.url, transferFormat);\r\n        return Promise.resolve();\r\n    }\r\n    poll(url, transferFormat) {\r\n        return __awaiter(this, void 0, void 0, function* () {\r\n            const pollOptions = {\r\n                abortSignal: this.pollAbort.signal,\r\n                headers: {},\r\n                timeout: 90000,\r\n            };\r\n            if (transferFormat === TransferFormat.Binary) {\r\n                pollOptions.responseType = "arraybuffer";\r\n            }\r\n            const token = this.accessTokenFactory();\r\n            if (token) {\r\n                // tslint:disable-next-line:no-string-literal\r\n                pollOptions.headers["Authorization"] = `Bearer ${token}`;\r\n            }\r\n            while (!this.pollAbort.signal.aborted) {\r\n                try {\r\n                    const pollUrl = `${url}&_=${Date.now()}`;\r\n                    this.logger.log(ILogger["a" /* LogLevel */].Trace, `(LongPolling transport) polling: ${pollUrl}`);\r\n                    const response = yield this.httpClient.get(pollUrl, pollOptions);\r\n                    if (response.statusCode === 204) {\r\n                        this.logger.log(ILogger["a" /* LogLevel */].Information, "(LongPolling transport) Poll terminated by server");\r\n                        // Poll terminated by server\r\n                        if (this.onclose) {\r\n                            this.onclose();\r\n                        }\r\n                        this.pollAbort.abort();\r\n                    }\r\n                    else if (response.statusCode !== 200) {\r\n                        this.logger.log(ILogger["a" /* LogLevel */].Error, `(LongPolling transport) Unexpected response code: ${response.statusCode}`);\r\n                        // Unexpected status code\r\n                        if (this.onclose) {\r\n                            this.onclose(new Errors["a" /* HttpError */](response.statusText, response.statusCode));\r\n                        }\r\n                        this.pollAbort.abort();\r\n                    }\r\n                    else {\r\n                        // Process the response\r\n                        if (response.content) {\r\n                            this.logger.log(ILogger["a" /* LogLevel */].Trace, `(LongPolling transport) data received. ${getDataDetail(response.content)}.`);\r\n                            if (this.onreceive) {\r\n                                this.onreceive(response.content);\r\n                            }\r\n                        }\r\n                        else {\r\n                            // This is another way timeout manifest.\r\n                            this.logger.log(ILogger["a" /* LogLevel */].Trace, "(LongPolling transport) Poll timed out, reissuing.");\r\n                        }\r\n                    }\r\n                }\r\n                catch (e) {\r\n                    if (e instanceof Errors["b" /* TimeoutError */]) {\r\n                        // Ignore timeouts and reissue the poll.\r\n                        this.logger.log(ILogger["a" /* LogLevel */].Trace, "(LongPolling transport) Poll timed out, reissuing.");\r\n                    }\r\n                    else {\r\n                        // Close the connection with the error as the result.\r\n                        if (this.onclose) {\r\n                            this.onclose(e);\r\n                        }\r\n                        this.pollAbort.abort();\r\n                    }\r\n                }\r\n            }\r\n        });\r\n    }\r\n    send(data) {\r\n        return __awaiter(this, void 0, void 0, function* () {\r\n            return send(this.logger, "LongPolling", this.httpClient, this.url, this.accessTokenFactory, data);\r\n        });\r\n    }\r\n    stop() {\r\n        this.pollAbort.abort();\r\n        return Promise.resolve();\r\n    }\r\n}\r\nfunction getDataDetail(data) {\r\n    let length = null;\r\n    if (data instanceof ArrayBuffer) {\r\n        length = `Binary data of length ${data.byteLength}`;\r\n    }\r\n    else if (typeof data === "string") {\r\n        length = `String data of length ${data.length}`;\r\n    }\r\n    return length;\r\n}\r\nfunction send(logger, transportName, httpClient, url, accessTokenFactory, content) {\r\n    return __awaiter(this, void 0, void 0, function* () {\r\n        let headers;\r\n        const token = accessTokenFactory();\r\n        if (token) {\r\n            headers = {\r\n                ["Authorization"]: `Bearer ${accessTokenFactory()}`,\r\n            };\r\n        }\r\n        logger.log(ILogger["a" /* LogLevel */].Trace, `(${transportName} transport) sending data. ${getDataDetail(content)}.`);\r\n        const response = yield httpClient.post(url, {\r\n            content,\r\n            headers,\r\n        });\r\n        logger.log(ILogger["a" /* LogLevel */].Trace, `(${transportName} transport) request complete. Response status: ${response.statusCode}.`);\r\n    });\r\n}\r\n//# sourceMappingURL=Transports.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9ub2RlX21vZHVsZXMvQGFzcG5ldC9zaWduYWxyL2Rpc3QvZXNtL0Fib3J0Q29udHJvbGxlci5qcz83ZTVhIiwid2VicGFjazovLy8uL25vZGVfbW9kdWxlcy9AYXNwbmV0L3NpZ25hbHIvZGlzdC9lc20vVHJhbnNwb3J0cy5qcz82MTU4Il0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsMkM7Ozs7Ozs7Ozs7Ozs7OztBQ3hCQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsbUNBQW1DLE1BQU0sNkJBQTZCLEVBQUUsWUFBWSxXQUFXLEVBQUU7QUFDakcsa0NBQWtDLE1BQU0saUNBQWlDLEVBQUUsWUFBWSxXQUFXLEVBQUU7QUFDcEcsK0JBQStCLGlFQUFpRSx1QkFBdUIsRUFBRSw0QkFBNEI7QUFDcko7QUFDQSxLQUFLO0FBQ0w7QUFDMEI7QUFDUTtBQUNmO0FBQ0w7QUFDZDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsQ0FBQyxzQ0FBc0M7QUFDdkM7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQUFDLHdDQUF3QztBQUN6QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw0RUFBNEUsMEJBQTBCO0FBQ3RHO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLG1HQUFnRixJQUFJO0FBQ3BGO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsNEdBQXlGLDRCQUE0QjtBQUNySDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EscUZBQXFGLFdBQVcsSUFBSSxhQUFhO0FBQ2pIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQSx1R0FBb0Ysb0JBQW9CO0FBQ3hHO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw0RUFBNEUsMEJBQTBCO0FBQ3RHO0FBQ0Esc0RBQXNELHdCQUF3QjtBQUM5RTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlIQUE4RixzQkFBc0I7QUFDcEg7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUdBQThFLFNBQVM7QUFDdkY7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwyQkFBMkI7QUFDM0I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlFQUFpRSxNQUFNO0FBQ3ZFO0FBQ0E7QUFDQTtBQUNBLHVDQUF1QyxJQUFJLEtBQUssV0FBVztBQUMzRCwyR0FBd0YsUUFBUTtBQUNoRztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGdJQUE2RyxvQkFBb0I7QUFDakk7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EseUhBQXNHLGdDQUFnQztBQUN0STtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsMENBQTBDLGdCQUFnQjtBQUMxRDtBQUNBO0FBQ0EsMENBQTBDLFlBQVk7QUFDdEQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsNkNBQTZDLHFCQUFxQjtBQUNsRTtBQUNBO0FBQ0EsMERBQXVDLGNBQWMsNEJBQTRCLHVCQUF1QjtBQUN4RztBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1QsMERBQXVDLGNBQWMsaURBQWlELG9CQUFvQjtBQUMxSCxLQUFLO0FBQ0w7QUFDQSIsImZpbGUiOiIxLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLy8gQ29weXJpZ2h0IChjKSAuTkVUIEZvdW5kYXRpb24uIEFsbCByaWdodHMgcmVzZXJ2ZWQuXHJcbi8vIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAuIFNlZSBMaWNlbnNlLnR4dCBpbiB0aGUgcHJvamVjdCByb290IGZvciBsaWNlbnNlIGluZm9ybWF0aW9uLlxyXG4vLyBSb3VnaCBwb2x5ZmlsbCBvZiBodHRwczovL2RldmVsb3Blci5tb3ppbGxhLm9yZy9lbi1VUy9kb2NzL1dlYi9BUEkvQWJvcnRDb250cm9sbGVyXHJcbi8vIFdlIGRvbid0IGFjdHVhbGx5IGV2ZXIgdXNlIHRoZSBBUEkgYmVpbmcgcG9seWZpbGxlZCwgd2UgYWx3YXlzIHVzZSB0aGUgcG9seWZpbGwgYmVjYXVzZVxyXG4vLyBpdCdzIGEgdmVyeSBuZXcgQVBJIHJpZ2h0IG5vdy5cclxuZXhwb3J0IGNsYXNzIEFib3J0Q29udHJvbGxlciB7XHJcbiAgICBjb25zdHJ1Y3RvcigpIHtcclxuICAgICAgICB0aGlzLmlzQWJvcnRlZCA9IGZhbHNlO1xyXG4gICAgfVxyXG4gICAgYWJvcnQoKSB7XHJcbiAgICAgICAgaWYgKCF0aGlzLmlzQWJvcnRlZCkge1xyXG4gICAgICAgICAgICB0aGlzLmlzQWJvcnRlZCA9IHRydWU7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLm9uYWJvcnQpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMub25hYm9ydCgpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgZ2V0IHNpZ25hbCgpIHtcclxuICAgICAgICByZXR1cm4gdGhpcztcclxuICAgIH1cclxuICAgIGdldCBhYm9ydGVkKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLmlzQWJvcnRlZDtcclxuICAgIH1cclxufVxyXG4vLyMgc291cmNlTWFwcGluZ1VSTD1BYm9ydENvbnRyb2xsZXIuanMubWFwIiwiLy8gQ29weXJpZ2h0IChjKSAuTkVUIEZvdW5kYXRpb24uIEFsbCByaWdodHMgcmVzZXJ2ZWQuXHJcbi8vIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAuIFNlZSBMaWNlbnNlLnR4dCBpbiB0aGUgcHJvamVjdCByb290IGZvciBsaWNlbnNlIGluZm9ybWF0aW9uLlxyXG52YXIgX19hd2FpdGVyID0gKHRoaXMgJiYgdGhpcy5fX2F3YWl0ZXIpIHx8IGZ1bmN0aW9uICh0aGlzQXJnLCBfYXJndW1lbnRzLCBQLCBnZW5lcmF0b3IpIHtcclxuICAgIHJldHVybiBuZXcgKFAgfHwgKFAgPSBQcm9taXNlKSkoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge1xyXG4gICAgICAgIGZ1bmN0aW9uIGZ1bGZpbGxlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvci5uZXh0KHZhbHVlKSk7IH0gY2F0Y2ggKGUpIHsgcmVqZWN0KGUpOyB9IH1cclxuICAgICAgICBmdW5jdGlvbiByZWplY3RlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvcltcInRocm93XCJdKHZhbHVlKSk7IH0gY2F0Y2ggKGUpIHsgcmVqZWN0KGUpOyB9IH1cclxuICAgICAgICBmdW5jdGlvbiBzdGVwKHJlc3VsdCkgeyByZXN1bHQuZG9uZSA/IHJlc29sdmUocmVzdWx0LnZhbHVlKSA6IG5ldyBQKGZ1bmN0aW9uIChyZXNvbHZlKSB7IHJlc29sdmUocmVzdWx0LnZhbHVlKTsgfSkudGhlbihmdWxmaWxsZWQsIHJlamVjdGVkKTsgfVxyXG4gICAgICAgIHN0ZXAoKGdlbmVyYXRvciA9IGdlbmVyYXRvci5hcHBseSh0aGlzQXJnLCBfYXJndW1lbnRzIHx8IFtdKSkubmV4dCgpKTtcclxuICAgIH0pO1xyXG59O1xyXG5pbXBvcnQgeyBBYm9ydENvbnRyb2xsZXIgfSBmcm9tIFwiLi9BYm9ydENvbnRyb2xsZXJcIjtcclxuaW1wb3J0IHsgSHR0cEVycm9yLCBUaW1lb3V0RXJyb3IgfSBmcm9tIFwiLi9FcnJvcnNcIjtcclxuaW1wb3J0IHsgTG9nTGV2ZWwgfSBmcm9tIFwiLi9JTG9nZ2VyXCI7XHJcbmltcG9ydCB7IEFyZyB9IGZyb20gXCIuL1V0aWxzXCI7XHJcbmV4cG9ydCB2YXIgVHJhbnNwb3J0VHlwZTtcclxuKGZ1bmN0aW9uIChUcmFuc3BvcnRUeXBlKSB7XHJcbiAgICBUcmFuc3BvcnRUeXBlW1RyYW5zcG9ydFR5cGVbXCJXZWJTb2NrZXRzXCJdID0gMF0gPSBcIldlYlNvY2tldHNcIjtcclxuICAgIFRyYW5zcG9ydFR5cGVbVHJhbnNwb3J0VHlwZVtcIlNlcnZlclNlbnRFdmVudHNcIl0gPSAxXSA9IFwiU2VydmVyU2VudEV2ZW50c1wiO1xyXG4gICAgVHJhbnNwb3J0VHlwZVtUcmFuc3BvcnRUeXBlW1wiTG9uZ1BvbGxpbmdcIl0gPSAyXSA9IFwiTG9uZ1BvbGxpbmdcIjtcclxufSkoVHJhbnNwb3J0VHlwZSB8fCAoVHJhbnNwb3J0VHlwZSA9IHt9KSk7XHJcbmV4cG9ydCB2YXIgVHJhbnNmZXJGb3JtYXQ7XHJcbihmdW5jdGlvbiAoVHJhbnNmZXJGb3JtYXQpIHtcclxuICAgIFRyYW5zZmVyRm9ybWF0W1RyYW5zZmVyRm9ybWF0W1wiVGV4dFwiXSA9IDFdID0gXCJUZXh0XCI7XHJcbiAgICBUcmFuc2ZlckZvcm1hdFtUcmFuc2ZlckZvcm1hdFtcIkJpbmFyeVwiXSA9IDJdID0gXCJCaW5hcnlcIjtcclxufSkoVHJhbnNmZXJGb3JtYXQgfHwgKFRyYW5zZmVyRm9ybWF0ID0ge30pKTtcclxuZXhwb3J0IGNsYXNzIFdlYlNvY2tldFRyYW5zcG9ydCB7XHJcbiAgICBjb25zdHJ1Y3RvcihhY2Nlc3NUb2tlbkZhY3RvcnksIGxvZ2dlcikge1xyXG4gICAgICAgIHRoaXMubG9nZ2VyID0gbG9nZ2VyO1xyXG4gICAgICAgIHRoaXMuYWNjZXNzVG9rZW5GYWN0b3J5ID0gYWNjZXNzVG9rZW5GYWN0b3J5IHx8ICgoKSA9PiBudWxsKTtcclxuICAgIH1cclxuICAgIGNvbm5lY3QodXJsLCB0cmFuc2ZlckZvcm1hdCwgY29ubmVjdGlvbikge1xyXG4gICAgICAgIEFyZy5pc1JlcXVpcmVkKHVybCwgXCJ1cmxcIik7XHJcbiAgICAgICAgQXJnLmlzUmVxdWlyZWQodHJhbnNmZXJGb3JtYXQsIFwidHJhbnNmZXJGb3JtYXRcIik7XHJcbiAgICAgICAgQXJnLmlzSW4odHJhbnNmZXJGb3JtYXQsIFRyYW5zZmVyRm9ybWF0LCBcInRyYW5zZmVyRm9ybWF0XCIpO1xyXG4gICAgICAgIEFyZy5pc1JlcXVpcmVkKGNvbm5lY3Rpb24sIFwiY29ubmVjdGlvblwiKTtcclxuICAgICAgICBpZiAodHlwZW9mIChXZWJTb2NrZXQpID09PSBcInVuZGVmaW5lZFwiKSB7XHJcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIidXZWJTb2NrZXQnIGlzIG5vdCBzdXBwb3J0ZWQgaW4geW91ciBlbnZpcm9ubWVudC5cIik7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMubG9nZ2VyLmxvZyhMb2dMZXZlbC5UcmFjZSwgXCIoV2ViU29ja2V0cyB0cmFuc3BvcnQpIENvbm5lY3RpbmdcIik7XHJcbiAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcclxuICAgICAgICAgICAgdXJsID0gdXJsLnJlcGxhY2UoL15odHRwLywgXCJ3c1wiKTtcclxuICAgICAgICAgICAgY29uc3QgdG9rZW4gPSB0aGlzLmFjY2Vzc1Rva2VuRmFjdG9yeSgpO1xyXG4gICAgICAgICAgICBpZiAodG9rZW4pIHtcclxuICAgICAgICAgICAgICAgIHVybCArPSAodXJsLmluZGV4T2YoXCI/XCIpIDwgMCA/IFwiP1wiIDogXCImXCIpICsgYGFjY2Vzc190b2tlbj0ke2VuY29kZVVSSUNvbXBvbmVudCh0b2tlbil9YDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBjb25zdCB3ZWJTb2NrZXQgPSBuZXcgV2ViU29ja2V0KHVybCk7XHJcbiAgICAgICAgICAgIGlmICh0cmFuc2ZlckZvcm1hdCA9PT0gVHJhbnNmZXJGb3JtYXQuQmluYXJ5KSB7XHJcbiAgICAgICAgICAgICAgICB3ZWJTb2NrZXQuYmluYXJ5VHlwZSA9IFwiYXJyYXlidWZmZXJcIjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB3ZWJTb2NrZXQub25vcGVuID0gKGV2ZW50KSA9PiB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmxvZ2dlci5sb2coTG9nTGV2ZWwuSW5mb3JtYXRpb24sIGBXZWJTb2NrZXQgY29ubmVjdGVkIHRvICR7dXJsfWApO1xyXG4gICAgICAgICAgICAgICAgdGhpcy53ZWJTb2NrZXQgPSB3ZWJTb2NrZXQ7XHJcbiAgICAgICAgICAgICAgICByZXNvbHZlKCk7XHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIHdlYlNvY2tldC5vbmVycm9yID0gKGV2ZW50KSA9PiB7XHJcbiAgICAgICAgICAgICAgICByZWplY3QoZXZlbnQuZXJyb3IpO1xyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICB3ZWJTb2NrZXQub25tZXNzYWdlID0gKG1lc3NhZ2UpID0+IHtcclxuICAgICAgICAgICAgICAgIHRoaXMubG9nZ2VyLmxvZyhMb2dMZXZlbC5UcmFjZSwgYChXZWJTb2NrZXRzIHRyYW5zcG9ydCkgZGF0YSByZWNlaXZlZC4gJHtnZXREYXRhRGV0YWlsKG1lc3NhZ2UuZGF0YSl9LmApO1xyXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMub25yZWNlaXZlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5vbnJlY2VpdmUobWVzc2FnZS5kYXRhKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgd2ViU29ja2V0Lm9uY2xvc2UgPSAoZXZlbnQpID0+IHtcclxuICAgICAgICAgICAgICAgIC8vIHdlYlNvY2tldCB3aWxsIGJlIG51bGwgaWYgdGhlIHRyYW5zcG9ydCBkaWQgbm90IHN0YXJ0IHN1Y2Nlc3NmdWxseVxyXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMub25jbG9zZSAmJiB0aGlzLndlYlNvY2tldCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChldmVudC53YXNDbGVhbiA9PT0gZmFsc2UgfHwgZXZlbnQuY29kZSAhPT0gMTAwMCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLm9uY2xvc2UobmV3IEVycm9yKGBXZWJzb2NrZXQgY2xvc2VkIHdpdGggc3RhdHVzIGNvZGU6ICR7ZXZlbnQuY29kZX0gKCR7ZXZlbnQucmVhc29ufSlgKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLm9uY2xvc2UoKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcbiAgICBzZW5kKGRhdGEpIHtcclxuICAgICAgICBpZiAodGhpcy53ZWJTb2NrZXQgJiYgdGhpcy53ZWJTb2NrZXQucmVhZHlTdGF0ZSA9PT0gV2ViU29ja2V0Lk9QRU4pIHtcclxuICAgICAgICAgICAgdGhpcy5sb2dnZXIubG9nKExvZ0xldmVsLlRyYWNlLCBgKFdlYlNvY2tldHMgdHJhbnNwb3J0KSBzZW5kaW5nIGRhdGEuICR7Z2V0RGF0YURldGFpbChkYXRhKX0uYCk7XHJcbiAgICAgICAgICAgIHRoaXMud2ViU29ja2V0LnNlbmQoZGF0YSk7XHJcbiAgICAgICAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUoKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KFwiV2ViU29ja2V0IGlzIG5vdCBpbiB0aGUgT1BFTiBzdGF0ZVwiKTtcclxuICAgIH1cclxuICAgIHN0b3AoKSB7XHJcbiAgICAgICAgaWYgKHRoaXMud2ViU29ja2V0KSB7XHJcbiAgICAgICAgICAgIHRoaXMud2ViU29ja2V0LmNsb3NlKCk7XHJcbiAgICAgICAgICAgIHRoaXMud2ViU29ja2V0ID0gbnVsbDtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZSgpO1xyXG4gICAgfVxyXG59XHJcbmV4cG9ydCBjbGFzcyBTZXJ2ZXJTZW50RXZlbnRzVHJhbnNwb3J0IHtcclxuICAgIGNvbnN0cnVjdG9yKGh0dHBDbGllbnQsIGFjY2Vzc1Rva2VuRmFjdG9yeSwgbG9nZ2VyKSB7XHJcbiAgICAgICAgdGhpcy5odHRwQ2xpZW50ID0gaHR0cENsaWVudDtcclxuICAgICAgICB0aGlzLmFjY2Vzc1Rva2VuRmFjdG9yeSA9IGFjY2Vzc1Rva2VuRmFjdG9yeSB8fCAoKCkgPT4gbnVsbCk7XHJcbiAgICAgICAgdGhpcy5sb2dnZXIgPSBsb2dnZXI7XHJcbiAgICB9XHJcbiAgICBjb25uZWN0KHVybCwgdHJhbnNmZXJGb3JtYXQsIGNvbm5lY3Rpb24pIHtcclxuICAgICAgICBBcmcuaXNSZXF1aXJlZCh1cmwsIFwidXJsXCIpO1xyXG4gICAgICAgIEFyZy5pc1JlcXVpcmVkKHRyYW5zZmVyRm9ybWF0LCBcInRyYW5zZmVyRm9ybWF0XCIpO1xyXG4gICAgICAgIEFyZy5pc0luKHRyYW5zZmVyRm9ybWF0LCBUcmFuc2ZlckZvcm1hdCwgXCJ0cmFuc2ZlckZvcm1hdFwiKTtcclxuICAgICAgICBBcmcuaXNSZXF1aXJlZChjb25uZWN0aW9uLCBcImNvbm5lY3Rpb25cIik7XHJcbiAgICAgICAgaWYgKHR5cGVvZiAoRXZlbnRTb3VyY2UpID09PSBcInVuZGVmaW5lZFwiKSB7XHJcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIidFdmVudFNvdXJjZScgaXMgbm90IHN1cHBvcnRlZCBpbiB5b3VyIGVudmlyb25tZW50LlwiKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5sb2dnZXIubG9nKExvZ0xldmVsLlRyYWNlLCBcIihTU0UgdHJhbnNwb3J0KSBDb25uZWN0aW5nXCIpO1xyXG4gICAgICAgIHRoaXMudXJsID0gdXJsO1xyXG4gICAgICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XHJcbiAgICAgICAgICAgIGlmICh0cmFuc2ZlckZvcm1hdCAhPT0gVHJhbnNmZXJGb3JtYXQuVGV4dCkge1xyXG4gICAgICAgICAgICAgICAgcmVqZWN0KG5ldyBFcnJvcihcIlRoZSBTZXJ2ZXItU2VudCBFdmVudHMgdHJhbnNwb3J0IG9ubHkgc3VwcG9ydHMgdGhlICdUZXh0JyB0cmFuc2ZlciBmb3JtYXRcIikpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGNvbnN0IHRva2VuID0gdGhpcy5hY2Nlc3NUb2tlbkZhY3RvcnkoKTtcclxuICAgICAgICAgICAgaWYgKHRva2VuKSB7XHJcbiAgICAgICAgICAgICAgICB1cmwgKz0gKHVybC5pbmRleE9mKFwiP1wiKSA8IDAgPyBcIj9cIiA6IFwiJlwiKSArIGBhY2Nlc3NfdG9rZW49JHtlbmNvZGVVUklDb21wb25lbnQodG9rZW4pfWA7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgY29uc3QgZXZlbnRTb3VyY2UgPSBuZXcgRXZlbnRTb3VyY2UodXJsLCB7IHdpdGhDcmVkZW50aWFsczogdHJ1ZSB9KTtcclxuICAgICAgICAgICAgdHJ5IHtcclxuICAgICAgICAgICAgICAgIGV2ZW50U291cmNlLm9ubWVzc2FnZSA9IChlKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMub25yZWNlaXZlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmxvZ2dlci5sb2coTG9nTGV2ZWwuVHJhY2UsIGAoU1NFIHRyYW5zcG9ydCkgZGF0YSByZWNlaXZlZC4gJHtnZXREYXRhRGV0YWlsKGUuZGF0YSl9LmApO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5vbnJlY2VpdmUoZS5kYXRhKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLm9uY2xvc2UpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLm9uY2xvc2UoZXJyb3IpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgICAgIGV2ZW50U291cmNlLm9uZXJyb3IgPSAoZSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIHJlamVjdChuZXcgRXJyb3IoZS5tZXNzYWdlIHx8IFwiRXJyb3Igb2NjdXJyZWRcIikpO1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIGRvbid0IHJlcG9ydCBhbiBlcnJvciBpZiB0aGUgdHJhbnNwb3J0IGRpZCBub3Qgc3RhcnQgc3VjY2Vzc2Z1bGx5XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuZXZlbnRTb3VyY2UgJiYgdGhpcy5vbmNsb3NlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMub25jbG9zZShuZXcgRXJyb3IoZS5tZXNzYWdlIHx8IFwiRXJyb3Igb2NjdXJyZWRcIikpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICAgICBldmVudFNvdXJjZS5vbm9wZW4gPSAoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5sb2dnZXIubG9nKExvZ0xldmVsLkluZm9ybWF0aW9uLCBgU1NFIGNvbm5lY3RlZCB0byAke3RoaXMudXJsfWApO1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZXZlbnRTb3VyY2UgPSBldmVudFNvdXJjZTtcclxuICAgICAgICAgICAgICAgICAgICAvLyBTU0UgaXMgYSB0ZXh0IHByb3RvY29sXHJcbiAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZSgpO1xyXG4gICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBjYXRjaCAoZSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KGUpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcbiAgICBzZW5kKGRhdGEpIHtcclxuICAgICAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gc2VuZCh0aGlzLmxvZ2dlciwgXCJTU0VcIiwgdGhpcy5odHRwQ2xpZW50LCB0aGlzLnVybCwgdGhpcy5hY2Nlc3NUb2tlbkZhY3RvcnksIGRhdGEpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG4gICAgc3RvcCgpIHtcclxuICAgICAgICBpZiAodGhpcy5ldmVudFNvdXJjZSkge1xyXG4gICAgICAgICAgICB0aGlzLmV2ZW50U291cmNlLmNsb3NlKCk7XHJcbiAgICAgICAgICAgIHRoaXMuZXZlbnRTb3VyY2UgPSBudWxsO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKCk7XHJcbiAgICB9XHJcbn1cclxuZXhwb3J0IGNsYXNzIExvbmdQb2xsaW5nVHJhbnNwb3J0IHtcclxuICAgIGNvbnN0cnVjdG9yKGh0dHBDbGllbnQsIGFjY2Vzc1Rva2VuRmFjdG9yeSwgbG9nZ2VyKSB7XHJcbiAgICAgICAgdGhpcy5odHRwQ2xpZW50ID0gaHR0cENsaWVudDtcclxuICAgICAgICB0aGlzLmFjY2Vzc1Rva2VuRmFjdG9yeSA9IGFjY2Vzc1Rva2VuRmFjdG9yeSB8fCAoKCkgPT4gbnVsbCk7XHJcbiAgICAgICAgdGhpcy5sb2dnZXIgPSBsb2dnZXI7XHJcbiAgICAgICAgdGhpcy5wb2xsQWJvcnQgPSBuZXcgQWJvcnRDb250cm9sbGVyKCk7XHJcbiAgICB9XHJcbiAgICBjb25uZWN0KHVybCwgdHJhbnNmZXJGb3JtYXQsIGNvbm5lY3Rpb24pIHtcclxuICAgICAgICBBcmcuaXNSZXF1aXJlZCh1cmwsIFwidXJsXCIpO1xyXG4gICAgICAgIEFyZy5pc1JlcXVpcmVkKHRyYW5zZmVyRm9ybWF0LCBcInRyYW5zZmVyRm9ybWF0XCIpO1xyXG4gICAgICAgIEFyZy5pc0luKHRyYW5zZmVyRm9ybWF0LCBUcmFuc2ZlckZvcm1hdCwgXCJ0cmFuc2ZlckZvcm1hdFwiKTtcclxuICAgICAgICBBcmcuaXNSZXF1aXJlZChjb25uZWN0aW9uLCBcImNvbm5lY3Rpb25cIik7XHJcbiAgICAgICAgdGhpcy51cmwgPSB1cmw7XHJcbiAgICAgICAgdGhpcy5sb2dnZXIubG9nKExvZ0xldmVsLlRyYWNlLCBcIihMb25nUG9sbGluZyB0cmFuc3BvcnQpIENvbm5lY3RpbmdcIik7XHJcbiAgICAgICAgLy8gU2V0IGEgZmxhZyBpbmRpY2F0aW5nIHdlIGhhdmUgaW5oZXJlbnQga2VlcC1hbGl2ZSBpbiB0aGlzIHRyYW5zcG9ydC5cclxuICAgICAgICBjb25uZWN0aW9uLmZlYXR1cmVzLmluaGVyZW50S2VlcEFsaXZlID0gdHJ1ZTtcclxuICAgICAgICBpZiAodHJhbnNmZXJGb3JtYXQgPT09IFRyYW5zZmVyRm9ybWF0LkJpbmFyeSAmJiAodHlwZW9mIG5ldyBYTUxIdHRwUmVxdWVzdCgpLnJlc3BvbnNlVHlwZSAhPT0gXCJzdHJpbmdcIikpIHtcclxuICAgICAgICAgICAgLy8gVGhpcyB3aWxsIHdvcmsgaWYgd2UgZml4OiBodHRwczovL2dpdGh1Yi5jb20vYXNwbmV0L1NpZ25hbFIvaXNzdWVzLzc0MlxyXG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJCaW5hcnkgcHJvdG9jb2xzIG92ZXIgWG1sSHR0cFJlcXVlc3Qgbm90IGltcGxlbWVudGluZyBhZHZhbmNlZCBmZWF0dXJlcyBhcmUgbm90IHN1cHBvcnRlZC5cIik7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMucG9sbCh0aGlzLnVybCwgdHJhbnNmZXJGb3JtYXQpO1xyXG4gICAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUoKTtcclxuICAgIH1cclxuICAgIHBvbGwodXJsLCB0cmFuc2ZlckZvcm1hdCkge1xyXG4gICAgICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IHBvbGxPcHRpb25zID0ge1xyXG4gICAgICAgICAgICAgICAgYWJvcnRTaWduYWw6IHRoaXMucG9sbEFib3J0LnNpZ25hbCxcclxuICAgICAgICAgICAgICAgIGhlYWRlcnM6IHt9LFxyXG4gICAgICAgICAgICAgICAgdGltZW91dDogOTAwMDAsXHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIGlmICh0cmFuc2ZlckZvcm1hdCA9PT0gVHJhbnNmZXJGb3JtYXQuQmluYXJ5KSB7XHJcbiAgICAgICAgICAgICAgICBwb2xsT3B0aW9ucy5yZXNwb25zZVR5cGUgPSBcImFycmF5YnVmZmVyXCI7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgY29uc3QgdG9rZW4gPSB0aGlzLmFjY2Vzc1Rva2VuRmFjdG9yeSgpO1xyXG4gICAgICAgICAgICBpZiAodG9rZW4pIHtcclxuICAgICAgICAgICAgICAgIC8vIHRzbGludDpkaXNhYmxlLW5leHQtbGluZTpuby1zdHJpbmctbGl0ZXJhbFxyXG4gICAgICAgICAgICAgICAgcG9sbE9wdGlvbnMuaGVhZGVyc1tcIkF1dGhvcml6YXRpb25cIl0gPSBgQmVhcmVyICR7dG9rZW59YDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB3aGlsZSAoIXRoaXMucG9sbEFib3J0LnNpZ25hbC5hYm9ydGVkKSB7XHJcbiAgICAgICAgICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHBvbGxVcmwgPSBgJHt1cmx9Jl89JHtEYXRlLm5vdygpfWA7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5sb2dnZXIubG9nKExvZ0xldmVsLlRyYWNlLCBgKExvbmdQb2xsaW5nIHRyYW5zcG9ydCkgcG9sbGluZzogJHtwb2xsVXJsfWApO1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHJlc3BvbnNlID0geWllbGQgdGhpcy5odHRwQ2xpZW50LmdldChwb2xsVXJsLCBwb2xsT3B0aW9ucyk7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLnN0YXR1c0NvZGUgPT09IDIwNCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmxvZ2dlci5sb2coTG9nTGV2ZWwuSW5mb3JtYXRpb24sIFwiKExvbmdQb2xsaW5nIHRyYW5zcG9ydCkgUG9sbCB0ZXJtaW5hdGVkIGJ5IHNlcnZlclwiKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gUG9sbCB0ZXJtaW5hdGVkIGJ5IHNlcnZlclxyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5vbmNsb3NlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLm9uY2xvc2UoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnBvbGxBYm9ydC5hYm9ydCgpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBlbHNlIGlmIChyZXNwb25zZS5zdGF0dXNDb2RlICE9PSAyMDApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5sb2dnZXIubG9nKExvZ0xldmVsLkVycm9yLCBgKExvbmdQb2xsaW5nIHRyYW5zcG9ydCkgVW5leHBlY3RlZCByZXNwb25zZSBjb2RlOiAke3Jlc3BvbnNlLnN0YXR1c0NvZGV9YCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIFVuZXhwZWN0ZWQgc3RhdHVzIGNvZGVcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMub25jbG9zZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5vbmNsb3NlKG5ldyBIdHRwRXJyb3IocmVzcG9uc2Uuc3RhdHVzVGV4dCwgcmVzcG9uc2Uuc3RhdHVzQ29kZSkpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucG9sbEFib3J0LmFib3J0KCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBQcm9jZXNzIHRoZSByZXNwb25zZVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2UuY29udGVudCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5sb2dnZXIubG9nKExvZ0xldmVsLlRyYWNlLCBgKExvbmdQb2xsaW5nIHRyYW5zcG9ydCkgZGF0YSByZWNlaXZlZC4gJHtnZXREYXRhRGV0YWlsKHJlc3BvbnNlLmNvbnRlbnQpfS5gKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLm9ucmVjZWl2ZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMub25yZWNlaXZlKHJlc3BvbnNlLmNvbnRlbnQpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gVGhpcyBpcyBhbm90aGVyIHdheSB0aW1lb3V0IG1hbmlmZXN0LlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5sb2dnZXIubG9nKExvZ0xldmVsLlRyYWNlLCBcIihMb25nUG9sbGluZyB0cmFuc3BvcnQpIFBvbGwgdGltZWQgb3V0LCByZWlzc3VpbmcuXCIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgY2F0Y2ggKGUpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoZSBpbnN0YW5jZW9mIFRpbWVvdXRFcnJvcikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBJZ25vcmUgdGltZW91dHMgYW5kIHJlaXNzdWUgdGhlIHBvbGwuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubG9nZ2VyLmxvZyhMb2dMZXZlbC5UcmFjZSwgXCIoTG9uZ1BvbGxpbmcgdHJhbnNwb3J0KSBQb2xsIHRpbWVkIG91dCwgcmVpc3N1aW5nLlwiKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIENsb3NlIHRoZSBjb25uZWN0aW9uIHdpdGggdGhlIGVycm9yIGFzIHRoZSByZXN1bHQuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLm9uY2xvc2UpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMub25jbG9zZShlKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnBvbGxBYm9ydC5hYm9ydCgpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG4gICAgc2VuZChkYXRhKSB7XHJcbiAgICAgICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHNlbmQodGhpcy5sb2dnZXIsIFwiTG9uZ1BvbGxpbmdcIiwgdGhpcy5odHRwQ2xpZW50LCB0aGlzLnVybCwgdGhpcy5hY2Nlc3NUb2tlbkZhY3RvcnksIGRhdGEpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG4gICAgc3RvcCgpIHtcclxuICAgICAgICB0aGlzLnBvbGxBYm9ydC5hYm9ydCgpO1xyXG4gICAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUoKTtcclxuICAgIH1cclxufVxyXG5mdW5jdGlvbiBnZXREYXRhRGV0YWlsKGRhdGEpIHtcclxuICAgIGxldCBsZW5ndGggPSBudWxsO1xyXG4gICAgaWYgKGRhdGEgaW5zdGFuY2VvZiBBcnJheUJ1ZmZlcikge1xyXG4gICAgICAgIGxlbmd0aCA9IGBCaW5hcnkgZGF0YSBvZiBsZW5ndGggJHtkYXRhLmJ5dGVMZW5ndGh9YDtcclxuICAgIH1cclxuICAgIGVsc2UgaWYgKHR5cGVvZiBkYXRhID09PSBcInN0cmluZ1wiKSB7XHJcbiAgICAgICAgbGVuZ3RoID0gYFN0cmluZyBkYXRhIG9mIGxlbmd0aCAke2RhdGEubGVuZ3RofWA7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gbGVuZ3RoO1xyXG59XHJcbmZ1bmN0aW9uIHNlbmQobG9nZ2VyLCB0cmFuc3BvcnROYW1lLCBodHRwQ2xpZW50LCB1cmwsIGFjY2Vzc1Rva2VuRmFjdG9yeSwgY29udGVudCkge1xyXG4gICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcclxuICAgICAgICBsZXQgaGVhZGVycztcclxuICAgICAgICBjb25zdCB0b2tlbiA9IGFjY2Vzc1Rva2VuRmFjdG9yeSgpO1xyXG4gICAgICAgIGlmICh0b2tlbikge1xyXG4gICAgICAgICAgICBoZWFkZXJzID0ge1xyXG4gICAgICAgICAgICAgICAgW1wiQXV0aG9yaXphdGlvblwiXTogYEJlYXJlciAke2FjY2Vzc1Rva2VuRmFjdG9yeSgpfWAsXHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGxvZ2dlci5sb2coTG9nTGV2ZWwuVHJhY2UsIGAoJHt0cmFuc3BvcnROYW1lfSB0cmFuc3BvcnQpIHNlbmRpbmcgZGF0YS4gJHtnZXREYXRhRGV0YWlsKGNvbnRlbnQpfS5gKTtcclxuICAgICAgICBjb25zdCByZXNwb25zZSA9IHlpZWxkIGh0dHBDbGllbnQucG9zdCh1cmwsIHtcclxuICAgICAgICAgICAgY29udGVudCxcclxuICAgICAgICAgICAgaGVhZGVycyxcclxuICAgICAgICB9KTtcclxuICAgICAgICBsb2dnZXIubG9nKExvZ0xldmVsLlRyYWNlLCBgKCR7dHJhbnNwb3J0TmFtZX0gdHJhbnNwb3J0KSByZXF1ZXN0IGNvbXBsZXRlLiBSZXNwb25zZSBzdGF0dXM6ICR7cmVzcG9uc2Uuc3RhdHVzQ29kZX0uYCk7XHJcbiAgICB9KTtcclxufVxyXG4vLyMgc291cmNlTWFwcGluZ1VSTD1UcmFuc3BvcnRzLmpzLm1hcCJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///1\n')},function(module,__webpack_exports__,__webpack_require__){"use strict";eval("/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"a\", function() { return Arg; });\n// Copyright (c) .NET Foundation. All rights reserved.\r\n// Licensed under the Apache License, Version 2.0. See License.txt in the project root for license information.\r\nclass Arg {\r\n    static isRequired(val, name) {\r\n        if (val === null || val === undefined) {\r\n            throw new Error(`The '${name}' argument is required.`);\r\n        }\r\n    }\r\n    static isIn(val, values, name) {\r\n        // TypeScript enums have keys for **both** the name and the value of each enum member on the type itself.\r\n        if (!(val in values)) {\r\n            throw new Error(`Unknown ${name} value: ${val}.`);\r\n        }\r\n    }\r\n}\r\n//# sourceMappingURL=Utils.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9ub2RlX21vZHVsZXMvQGFzcG5ldC9zaWduYWxyL2Rpc3QvZXNtL1V0aWxzLmpzP2M5ZjciXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esb0NBQW9DLEtBQUs7QUFDekM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHVDQUF1QyxLQUFLLFVBQVUsSUFBSTtBQUMxRDtBQUNBO0FBQ0E7QUFDQSIsImZpbGUiOiIyLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLy8gQ29weXJpZ2h0IChjKSAuTkVUIEZvdW5kYXRpb24uIEFsbCByaWdodHMgcmVzZXJ2ZWQuXHJcbi8vIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAuIFNlZSBMaWNlbnNlLnR4dCBpbiB0aGUgcHJvamVjdCByb290IGZvciBsaWNlbnNlIGluZm9ybWF0aW9uLlxyXG5leHBvcnQgY2xhc3MgQXJnIHtcclxuICAgIHN0YXRpYyBpc1JlcXVpcmVkKHZhbCwgbmFtZSkge1xyXG4gICAgICAgIGlmICh2YWwgPT09IG51bGwgfHwgdmFsID09PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBUaGUgJyR7bmFtZX0nIGFyZ3VtZW50IGlzIHJlcXVpcmVkLmApO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIHN0YXRpYyBpc0luKHZhbCwgdmFsdWVzLCBuYW1lKSB7XHJcbiAgICAgICAgLy8gVHlwZVNjcmlwdCBlbnVtcyBoYXZlIGtleXMgZm9yICoqYm90aCoqIHRoZSBuYW1lIGFuZCB0aGUgdmFsdWUgb2YgZWFjaCBlbnVtIG1lbWJlciBvbiB0aGUgdHlwZSBpdHNlbGYuXHJcbiAgICAgICAgaWYgKCEodmFsIGluIHZhbHVlcykpIHtcclxuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBVbmtub3duICR7bmFtZX0gdmFsdWU6ICR7dmFsfS5gKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn1cclxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9VXRpbHMuanMubWFwIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///2\n")},function(module,__webpack_exports__,__webpack_require__){"use strict";eval('/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "a", function() { return HttpError; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "b", function() { return TimeoutError; });\n// Copyright (c) .NET Foundation. All rights reserved.\r\n// Licensed under the Apache License, Version 2.0. See License.txt in the project root for license information.\r\nclass HttpError extends Error {\r\n    constructor(errorMessage, statusCode) {\r\n        const trueProto = new.target.prototype;\r\n        super(errorMessage);\r\n        this.statusCode = statusCode;\r\n        // Workaround issue in Typescript compiler\r\n        // https://github.com/Microsoft/TypeScript/issues/13965#issuecomment-278570200\r\n        this.__proto__ = trueProto;\r\n    }\r\n}\r\nclass TimeoutError extends Error {\r\n    constructor(errorMessage = "A timeout occurred.") {\r\n        const trueProto = new.target.prototype;\r\n        super(errorMessage);\r\n        // Workaround issue in Typescript compiler\r\n        // https://github.com/Microsoft/TypeScript/issues/13965#issuecomment-278570200\r\n        this.__proto__ = trueProto;\r\n    }\r\n}\r\n//# sourceMappingURL=Errors.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9ub2RlX21vZHVsZXMvQGFzcG5ldC9zaWduYWxyL2Rpc3QvZXNtL0Vycm9ycy5qcz9jNWZiIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBIiwiZmlsZSI6IjMuanMiLCJzb3VyY2VzQ29udGVudCI6WyIvLyBDb3B5cmlnaHQgKGMpIC5ORVQgRm91bmRhdGlvbi4gQWxsIHJpZ2h0cyByZXNlcnZlZC5cclxuLy8gTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMC4gU2VlIExpY2Vuc2UudHh0IGluIHRoZSBwcm9qZWN0IHJvb3QgZm9yIGxpY2Vuc2UgaW5mb3JtYXRpb24uXHJcbmV4cG9ydCBjbGFzcyBIdHRwRXJyb3IgZXh0ZW5kcyBFcnJvciB7XHJcbiAgICBjb25zdHJ1Y3RvcihlcnJvck1lc3NhZ2UsIHN0YXR1c0NvZGUpIHtcclxuICAgICAgICBjb25zdCB0cnVlUHJvdG8gPSBuZXcudGFyZ2V0LnByb3RvdHlwZTtcclxuICAgICAgICBzdXBlcihlcnJvck1lc3NhZ2UpO1xyXG4gICAgICAgIHRoaXMuc3RhdHVzQ29kZSA9IHN0YXR1c0NvZGU7XHJcbiAgICAgICAgLy8gV29ya2Fyb3VuZCBpc3N1ZSBpbiBUeXBlc2NyaXB0IGNvbXBpbGVyXHJcbiAgICAgICAgLy8gaHR0cHM6Ly9naXRodWIuY29tL01pY3Jvc29mdC9UeXBlU2NyaXB0L2lzc3Vlcy8xMzk2NSNpc3N1ZWNvbW1lbnQtMjc4NTcwMjAwXHJcbiAgICAgICAgdGhpcy5fX3Byb3RvX18gPSB0cnVlUHJvdG87XHJcbiAgICB9XHJcbn1cclxuZXhwb3J0IGNsYXNzIFRpbWVvdXRFcnJvciBleHRlbmRzIEVycm9yIHtcclxuICAgIGNvbnN0cnVjdG9yKGVycm9yTWVzc2FnZSA9IFwiQSB0aW1lb3V0IG9jY3VycmVkLlwiKSB7XHJcbiAgICAgICAgY29uc3QgdHJ1ZVByb3RvID0gbmV3LnRhcmdldC5wcm90b3R5cGU7XHJcbiAgICAgICAgc3VwZXIoZXJyb3JNZXNzYWdlKTtcclxuICAgICAgICAvLyBXb3JrYXJvdW5kIGlzc3VlIGluIFR5cGVzY3JpcHQgY29tcGlsZXJcclxuICAgICAgICAvLyBodHRwczovL2dpdGh1Yi5jb20vTWljcm9zb2Z0L1R5cGVTY3JpcHQvaXNzdWVzLzEzOTY1I2lzc3VlY29tbWVudC0yNzg1NzAyMDBcclxuICAgICAgICB0aGlzLl9fcHJvdG9fXyA9IHRydWVQcm90bztcclxuICAgIH1cclxufVxyXG4vLyMgc291cmNlTWFwcGluZ1VSTD1FcnJvcnMuanMubWFwIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///3\n')},function(module,__webpack_exports__,__webpack_require__){"use strict";eval('/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "c", function() { return NullLogger; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "a", function() { return ConsoleLogger; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "b", function() { return LoggerFactory; });\n/* harmony import */ var _ILogger__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(0);\n// Copyright (c) .NET Foundation. All rights reserved.\r\n// Licensed under the Apache License, Version 2.0. See License.txt in the project root for license information.\r\n\r\nclass NullLogger {\r\n    log(logLevel, message) {\r\n    }\r\n}\r\nclass ConsoleLogger {\r\n    constructor(minimumLogLevel) {\r\n        this.minimumLogLevel = minimumLogLevel;\r\n    }\r\n    log(logLevel, message) {\r\n        if (logLevel >= this.minimumLogLevel) {\r\n            switch (logLevel) {\r\n                case _ILogger__WEBPACK_IMPORTED_MODULE_0__[/* LogLevel */ "a"].Error:\r\n                    console.error(`${_ILogger__WEBPACK_IMPORTED_MODULE_0__[/* LogLevel */ "a"][logLevel]}: ${message}`);\r\n                    break;\r\n                case _ILogger__WEBPACK_IMPORTED_MODULE_0__[/* LogLevel */ "a"].Warning:\r\n                    console.warn(`${_ILogger__WEBPACK_IMPORTED_MODULE_0__[/* LogLevel */ "a"][logLevel]}: ${message}`);\r\n                    break;\r\n                case _ILogger__WEBPACK_IMPORTED_MODULE_0__[/* LogLevel */ "a"].Information:\r\n                    console.info(`${_ILogger__WEBPACK_IMPORTED_MODULE_0__[/* LogLevel */ "a"][logLevel]}: ${message}`);\r\n                    break;\r\n                default:\r\n                    console.log(`${_ILogger__WEBPACK_IMPORTED_MODULE_0__[/* LogLevel */ "a"][logLevel]}: ${message}`);\r\n                    break;\r\n            }\r\n        }\r\n    }\r\n}\r\nclass LoggerFactory {\r\n    static createLogger(logging) {\r\n        if (logging === undefined) {\r\n            return new ConsoleLogger(_ILogger__WEBPACK_IMPORTED_MODULE_0__[/* LogLevel */ "a"].Information);\r\n        }\r\n        if (logging === null) {\r\n            return new NullLogger();\r\n        }\r\n        if (logging.log) {\r\n            return logging;\r\n        }\r\n        return new ConsoleLogger(logging);\r\n    }\r\n}\r\n//# sourceMappingURL=Loggers.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9ub2RlX21vZHVsZXMvQGFzcG5ldC9zaWduYWxyL2Rpc3QvZXNtL0xvZ2dlcnMuanM/N2I3NCJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7QUFBQTtBQUFBO0FBQ0E7QUFDbUI7QUFDbkI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EscUNBQXFDLG9FQUFtQixJQUFJLFFBQVE7QUFDcEU7QUFDQTtBQUNBLG9DQUFvQyxvRUFBbUIsSUFBSSxRQUFRO0FBQ25FO0FBQ0E7QUFDQSxvQ0FBb0Msb0VBQW1CLElBQUksUUFBUTtBQUNuRTtBQUNBO0FBQ0EsbUNBQW1DLG9FQUFtQixJQUFJLFFBQVE7QUFDbEU7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSIsImZpbGUiOiI0LmpzIiwic291cmNlc0NvbnRlbnQiOlsiLy8gQ29weXJpZ2h0IChjKSAuTkVUIEZvdW5kYXRpb24uIEFsbCByaWdodHMgcmVzZXJ2ZWQuXHJcbi8vIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAuIFNlZSBMaWNlbnNlLnR4dCBpbiB0aGUgcHJvamVjdCByb290IGZvciBsaWNlbnNlIGluZm9ybWF0aW9uLlxyXG5pbXBvcnQgeyBMb2dMZXZlbCB9IGZyb20gXCIuL0lMb2dnZXJcIjtcclxuZXhwb3J0IGNsYXNzIE51bGxMb2dnZXIge1xyXG4gICAgbG9nKGxvZ0xldmVsLCBtZXNzYWdlKSB7XHJcbiAgICB9XHJcbn1cclxuZXhwb3J0IGNsYXNzIENvbnNvbGVMb2dnZXIge1xyXG4gICAgY29uc3RydWN0b3IobWluaW11bUxvZ0xldmVsKSB7XHJcbiAgICAgICAgdGhpcy5taW5pbXVtTG9nTGV2ZWwgPSBtaW5pbXVtTG9nTGV2ZWw7XHJcbiAgICB9XHJcbiAgICBsb2cobG9nTGV2ZWwsIG1lc3NhZ2UpIHtcclxuICAgICAgICBpZiAobG9nTGV2ZWwgPj0gdGhpcy5taW5pbXVtTG9nTGV2ZWwpIHtcclxuICAgICAgICAgICAgc3dpdGNoIChsb2dMZXZlbCkge1xyXG4gICAgICAgICAgICAgICAgY2FzZSBMb2dMZXZlbC5FcnJvcjpcclxuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKGAke0xvZ0xldmVsW2xvZ0xldmVsXX06ICR7bWVzc2FnZX1gKTtcclxuICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgIGNhc2UgTG9nTGV2ZWwuV2FybmluZzpcclxuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLndhcm4oYCR7TG9nTGV2ZWxbbG9nTGV2ZWxdfTogJHttZXNzYWdlfWApO1xyXG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgY2FzZSBMb2dMZXZlbC5JbmZvcm1hdGlvbjpcclxuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmluZm8oYCR7TG9nTGV2ZWxbbG9nTGV2ZWxdfTogJHttZXNzYWdlfWApO1xyXG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgZGVmYXVsdDpcclxuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhgJHtMb2dMZXZlbFtsb2dMZXZlbF19OiAke21lc3NhZ2V9YCk7XHJcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcbn1cclxuZXhwb3J0IGNsYXNzIExvZ2dlckZhY3Rvcnkge1xyXG4gICAgc3RhdGljIGNyZWF0ZUxvZ2dlcihsb2dnaW5nKSB7XHJcbiAgICAgICAgaWYgKGxvZ2dpbmcgPT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICByZXR1cm4gbmV3IENvbnNvbGVMb2dnZXIoTG9nTGV2ZWwuSW5mb3JtYXRpb24pO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAobG9nZ2luZyA9PT0gbnVsbCkge1xyXG4gICAgICAgICAgICByZXR1cm4gbmV3IE51bGxMb2dnZXIoKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKGxvZ2dpbmcubG9nKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBsb2dnaW5nO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gbmV3IENvbnNvbGVMb2dnZXIobG9nZ2luZyk7XHJcbiAgICB9XHJcbn1cclxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9TG9nZ2Vycy5qcy5tYXAiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///4\n')},function(module,__webpack_exports__,__webpack_require__){"use strict";eval('/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "b", function() { return Subscription; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "a", function() { return Subject; });\n// Copyright (c) .NET Foundation. All rights reserved.\r\n// Licensed under the Apache License, Version 2.0. See License.txt in the project root for license information.\r\nclass Subscription {\r\n    constructor(subject, observer) {\r\n        this.subject = subject;\r\n        this.observer = observer;\r\n    }\r\n    dispose() {\r\n        const index = this.subject.observers.indexOf(this.observer);\r\n        if (index > -1) {\r\n            this.subject.observers.splice(index, 1);\r\n        }\r\n        if (this.subject.observers.length === 0) {\r\n            this.subject.cancelCallback().catch((_) => { });\r\n        }\r\n    }\r\n}\r\nclass Subject {\r\n    constructor(cancelCallback) {\r\n        this.observers = [];\r\n        this.cancelCallback = cancelCallback;\r\n    }\r\n    next(item) {\r\n        for (const observer of this.observers) {\r\n            observer.next(item);\r\n        }\r\n    }\r\n    error(err) {\r\n        for (const observer of this.observers) {\r\n            if (observer.error) {\r\n                observer.error(err);\r\n            }\r\n        }\r\n    }\r\n    complete() {\r\n        for (const observer of this.observers) {\r\n            if (observer.complete) {\r\n                observer.complete();\r\n            }\r\n        }\r\n    }\r\n    subscribe(observer) {\r\n        this.observers.push(observer);\r\n        return new Subscription(this, observer);\r\n    }\r\n}\r\n//# sourceMappingURL=Observable.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9ub2RlX21vZHVsZXMvQGFzcG5ldC9zaWduYWxyL2Rpc3QvZXNtL09ic2VydmFibGUuanM/ZmM4OSJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUE7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHdEQUF3RCxFQUFFO0FBQzFEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSIsImZpbGUiOiI1LmpzIiwic291cmNlc0NvbnRlbnQiOlsiLy8gQ29weXJpZ2h0IChjKSAuTkVUIEZvdW5kYXRpb24uIEFsbCByaWdodHMgcmVzZXJ2ZWQuXHJcbi8vIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAuIFNlZSBMaWNlbnNlLnR4dCBpbiB0aGUgcHJvamVjdCByb290IGZvciBsaWNlbnNlIGluZm9ybWF0aW9uLlxyXG5leHBvcnQgY2xhc3MgU3Vic2NyaXB0aW9uIHtcclxuICAgIGNvbnN0cnVjdG9yKHN1YmplY3QsIG9ic2VydmVyKSB7XHJcbiAgICAgICAgdGhpcy5zdWJqZWN0ID0gc3ViamVjdDtcclxuICAgICAgICB0aGlzLm9ic2VydmVyID0gb2JzZXJ2ZXI7XHJcbiAgICB9XHJcbiAgICBkaXNwb3NlKCkge1xyXG4gICAgICAgIGNvbnN0IGluZGV4ID0gdGhpcy5zdWJqZWN0Lm9ic2VydmVycy5pbmRleE9mKHRoaXMub2JzZXJ2ZXIpO1xyXG4gICAgICAgIGlmIChpbmRleCA+IC0xKSB7XHJcbiAgICAgICAgICAgIHRoaXMuc3ViamVjdC5vYnNlcnZlcnMuc3BsaWNlKGluZGV4LCAxKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKHRoaXMuc3ViamVjdC5vYnNlcnZlcnMubGVuZ3RoID09PSAwKSB7XHJcbiAgICAgICAgICAgIHRoaXMuc3ViamVjdC5jYW5jZWxDYWxsYmFjaygpLmNhdGNoKChfKSA9PiB7IH0pO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxufVxyXG5leHBvcnQgY2xhc3MgU3ViamVjdCB7XHJcbiAgICBjb25zdHJ1Y3RvcihjYW5jZWxDYWxsYmFjaykge1xyXG4gICAgICAgIHRoaXMub2JzZXJ2ZXJzID0gW107XHJcbiAgICAgICAgdGhpcy5jYW5jZWxDYWxsYmFjayA9IGNhbmNlbENhbGxiYWNrO1xyXG4gICAgfVxyXG4gICAgbmV4dChpdGVtKSB7XHJcbiAgICAgICAgZm9yIChjb25zdCBvYnNlcnZlciBvZiB0aGlzLm9ic2VydmVycykge1xyXG4gICAgICAgICAgICBvYnNlcnZlci5uZXh0KGl0ZW0pO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIGVycm9yKGVycikge1xyXG4gICAgICAgIGZvciAoY29uc3Qgb2JzZXJ2ZXIgb2YgdGhpcy5vYnNlcnZlcnMpIHtcclxuICAgICAgICAgICAgaWYgKG9ic2VydmVyLmVycm9yKSB7XHJcbiAgICAgICAgICAgICAgICBvYnNlcnZlci5lcnJvcihlcnIpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgY29tcGxldGUoKSB7XHJcbiAgICAgICAgZm9yIChjb25zdCBvYnNlcnZlciBvZiB0aGlzLm9ic2VydmVycykge1xyXG4gICAgICAgICAgICBpZiAob2JzZXJ2ZXIuY29tcGxldGUpIHtcclxuICAgICAgICAgICAgICAgIG9ic2VydmVyLmNvbXBsZXRlKCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICBzdWJzY3JpYmUob2JzZXJ2ZXIpIHtcclxuICAgICAgICB0aGlzLm9ic2VydmVycy5wdXNoKG9ic2VydmVyKTtcclxuICAgICAgICByZXR1cm4gbmV3IFN1YnNjcmlwdGlvbih0aGlzLCBvYnNlcnZlcik7XHJcbiAgICB9XHJcbn1cclxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9T2JzZXJ2YWJsZS5qcy5tYXAiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///5\n')},function(module,__webpack_exports__,__webpack_require__){"use strict";eval('/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "a", function() { return HttpConnection; });\n/* harmony import */ var _HttpClient__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(7);\n/* harmony import */ var _ILogger__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(0);\n/* harmony import */ var _Loggers__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(4);\n/* harmony import */ var _Transports__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(1);\n/* harmony import */ var _Utils__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(2);\n// Copyright (c) .NET Foundation. All rights reserved.\r\n// Licensed under the Apache License, Version 2.0. See License.txt in the project root for license information.\r\nvar __awaiter = (undefined && undefined.__awaiter) || function (thisArg, _arguments, P, generator) {\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n};\r\n\r\n\r\n\r\n\r\n\r\nclass HttpConnection {\r\n    constructor(url, options = {}) {\r\n        this.features = {};\r\n        _Utils__WEBPACK_IMPORTED_MODULE_4__[/* Arg */ "a"].isRequired(url, "url");\r\n        this.logger = _Loggers__WEBPACK_IMPORTED_MODULE_2__[/* LoggerFactory */ "b"].createLogger(options.logger);\r\n        this.baseUrl = this.resolveUrl(url);\r\n        options = options || {};\r\n        options.accessTokenFactory = options.accessTokenFactory || (() => null);\r\n        this.httpClient = options.httpClient || new _HttpClient__WEBPACK_IMPORTED_MODULE_0__[/* DefaultHttpClient */ "a"](this.logger);\r\n        this.connectionState = 2 /* Disconnected */;\r\n        this.options = options;\r\n    }\r\n    start(transferFormat) {\r\n        _Utils__WEBPACK_IMPORTED_MODULE_4__[/* Arg */ "a"].isRequired(transferFormat, "transferFormat");\r\n        _Utils__WEBPACK_IMPORTED_MODULE_4__[/* Arg */ "a"].isIn(transferFormat, _Transports__WEBPACK_IMPORTED_MODULE_3__[/* TransferFormat */ "c"], "transferFormat");\r\n        this.logger.log(_ILogger__WEBPACK_IMPORTED_MODULE_1__[/* LogLevel */ "a"].Trace, `Starting connection with transfer format \'${_Transports__WEBPACK_IMPORTED_MODULE_3__[/* TransferFormat */ "c"][transferFormat]}\'.`);\r\n        if (this.connectionState !== 2 /* Disconnected */) {\r\n            return Promise.reject(new Error("Cannot start a connection that is not in the \'Disconnected\' state."));\r\n        }\r\n        this.connectionState = 0 /* Connecting */;\r\n        this.startPromise = this.startInternal(transferFormat);\r\n        return this.startPromise;\r\n    }\r\n    startInternal(transferFormat) {\r\n        return __awaiter(this, void 0, void 0, function* () {\r\n            try {\r\n                if (this.options.transport === _Transports__WEBPACK_IMPORTED_MODULE_3__[/* TransportType */ "d"].WebSockets) {\r\n                    // No need to add a connection ID in this case\r\n                    this.url = this.baseUrl;\r\n                    this.transport = this.constructTransport(_Transports__WEBPACK_IMPORTED_MODULE_3__[/* TransportType */ "d"].WebSockets);\r\n                    // We should just call connect directly in this case.\r\n                    // No fallback or negotiate in this case.\r\n                    yield this.transport.connect(this.url, transferFormat, this);\r\n                }\r\n                else {\r\n                    const token = this.options.accessTokenFactory();\r\n                    let headers;\r\n                    if (token) {\r\n                        headers = {\r\n                            ["Authorization"]: `Bearer ${token}`,\r\n                        };\r\n                    }\r\n                    const negotiateResponse = yield this.getNegotiationResponse(headers);\r\n                    // the user tries to stop the the connection when it is being started\r\n                    if (this.connectionState === 2 /* Disconnected */) {\r\n                        return;\r\n                    }\r\n                    yield this.createTransport(this.options.transport, negotiateResponse, transferFormat, headers);\r\n                }\r\n                this.transport.onreceive = this.onreceive;\r\n                this.transport.onclose = (e) => this.stopConnection(true, e);\r\n                // only change the state if we were connecting to not overwrite\r\n                // the state if the connection is already marked as Disconnected\r\n                this.changeState(0 /* Connecting */, 1 /* Connected */);\r\n            }\r\n            catch (e) {\r\n                this.logger.log(_ILogger__WEBPACK_IMPORTED_MODULE_1__[/* LogLevel */ "a"].Error, "Failed to start the connection: " + e);\r\n                this.connectionState = 2 /* Disconnected */;\r\n                this.transport = null;\r\n                throw e;\r\n            }\r\n        });\r\n    }\r\n    getNegotiationResponse(headers) {\r\n        return __awaiter(this, void 0, void 0, function* () {\r\n            const negotiateUrl = this.resolveNegotiateUrl(this.baseUrl);\r\n            this.logger.log(_ILogger__WEBPACK_IMPORTED_MODULE_1__[/* LogLevel */ "a"].Trace, `Sending negotiation request: ${negotiateUrl}`);\r\n            try {\r\n                const response = yield this.httpClient.post(negotiateUrl, {\r\n                    content: "",\r\n                    headers,\r\n                });\r\n                return JSON.parse(response.content);\r\n            }\r\n            catch (e) {\r\n                this.logger.log(_ILogger__WEBPACK_IMPORTED_MODULE_1__[/* LogLevel */ "a"].Error, "Failed to complete negotiation with the server: " + e);\r\n                throw e;\r\n            }\r\n        });\r\n    }\r\n    updateConnectionId(negotiateResponse) {\r\n        this.connectionId = negotiateResponse.connectionId;\r\n        this.url = this.baseUrl + (this.baseUrl.indexOf("?") === -1 ? "?" : "&") + `id=${this.connectionId}`;\r\n    }\r\n    createTransport(requestedTransport, negotiateResponse, requestedTransferFormat, headers) {\r\n        return __awaiter(this, void 0, void 0, function* () {\r\n            this.updateConnectionId(negotiateResponse);\r\n            if (this.isITransport(requestedTransport)) {\r\n                this.logger.log(_ILogger__WEBPACK_IMPORTED_MODULE_1__[/* LogLevel */ "a"].Trace, "Connection was provided an instance of ITransport, using that directly.");\r\n                this.transport = requestedTransport;\r\n                yield this.transport.connect(this.url, requestedTransferFormat, this);\r\n                // only change the state if we were connecting to not overwrite\r\n                // the state if the connection is already marked as Disconnected\r\n                this.changeState(0 /* Connecting */, 1 /* Connected */);\r\n                return;\r\n            }\r\n            const transports = negotiateResponse.availableTransports;\r\n            for (const endpoint of transports) {\r\n                this.connectionState = 0 /* Connecting */;\r\n                const transport = this.resolveTransport(endpoint, requestedTransport, requestedTransferFormat);\r\n                if (typeof transport === "number") {\r\n                    this.transport = this.constructTransport(transport);\r\n                    if (negotiateResponse.connectionId === null) {\r\n                        negotiateResponse = yield this.getNegotiationResponse(headers);\r\n                        this.updateConnectionId(negotiateResponse);\r\n                    }\r\n                    try {\r\n                        yield this.transport.connect(this.url, requestedTransferFormat, this);\r\n                        this.changeState(0 /* Connecting */, 1 /* Connected */);\r\n                        return;\r\n                    }\r\n                    catch (ex) {\r\n                        this.logger.log(_ILogger__WEBPACK_IMPORTED_MODULE_1__[/* LogLevel */ "a"].Error, `Failed to start the transport \'${_Transports__WEBPACK_IMPORTED_MODULE_3__[/* TransportType */ "d"][transport]}\': ${ex}`);\r\n                        this.connectionState = 2 /* Disconnected */;\r\n                        negotiateResponse.connectionId = null;\r\n                    }\r\n                }\r\n            }\r\n            throw new Error("Unable to initialize any of the available transports.");\r\n        });\r\n    }\r\n    constructTransport(transport) {\r\n        switch (transport) {\r\n            case _Transports__WEBPACK_IMPORTED_MODULE_3__[/* TransportType */ "d"].WebSockets:\r\n                return new _Transports__WEBPACK_IMPORTED_MODULE_3__[/* WebSocketTransport */ "e"](this.options.accessTokenFactory, this.logger);\r\n            case _Transports__WEBPACK_IMPORTED_MODULE_3__[/* TransportType */ "d"].ServerSentEvents:\r\n                return new _Transports__WEBPACK_IMPORTED_MODULE_3__[/* ServerSentEventsTransport */ "b"](this.httpClient, this.options.accessTokenFactory, this.logger);\r\n            case _Transports__WEBPACK_IMPORTED_MODULE_3__[/* TransportType */ "d"].LongPolling:\r\n                return new _Transports__WEBPACK_IMPORTED_MODULE_3__[/* LongPollingTransport */ "a"](this.httpClient, this.options.accessTokenFactory, this.logger);\r\n            default:\r\n                throw new Error(`Unknown transport: ${transport}.`);\r\n        }\r\n    }\r\n    resolveTransport(endpoint, requestedTransport, requestedTransferFormat) {\r\n        const transport = _Transports__WEBPACK_IMPORTED_MODULE_3__[/* TransportType */ "d"][endpoint.transport];\r\n        if (transport === null || transport === undefined) {\r\n            this.logger.log(_ILogger__WEBPACK_IMPORTED_MODULE_1__[/* LogLevel */ "a"].Trace, `Skipping transport \'${endpoint.transport}\' because it is not supported by this client.`);\r\n        }\r\n        else {\r\n            const transferFormats = endpoint.transferFormats.map((s) => _Transports__WEBPACK_IMPORTED_MODULE_3__[/* TransferFormat */ "c"][s]);\r\n            if (!requestedTransport || transport === requestedTransport) {\r\n                if (transferFormats.indexOf(requestedTransferFormat) >= 0) {\r\n                    if ((transport === _Transports__WEBPACK_IMPORTED_MODULE_3__[/* TransportType */ "d"].WebSockets && typeof WebSocket === "undefined") ||\r\n                        (transport === _Transports__WEBPACK_IMPORTED_MODULE_3__[/* TransportType */ "d"].ServerSentEvents && typeof EventSource === "undefined")) {\r\n                        this.logger.log(_ILogger__WEBPACK_IMPORTED_MODULE_1__[/* LogLevel */ "a"].Trace, `Skipping transport \'${_Transports__WEBPACK_IMPORTED_MODULE_3__[/* TransportType */ "d"][transport]}\' because it is not supported in your environment.\'`);\r\n                    }\r\n                    else {\r\n                        this.logger.log(_ILogger__WEBPACK_IMPORTED_MODULE_1__[/* LogLevel */ "a"].Trace, `Selecting transport \'${_Transports__WEBPACK_IMPORTED_MODULE_3__[/* TransportType */ "d"][transport]}\'`);\r\n                        return transport;\r\n                    }\r\n                }\r\n                else {\r\n                    this.logger.log(_ILogger__WEBPACK_IMPORTED_MODULE_1__[/* LogLevel */ "a"].Trace, `Skipping transport \'${_Transports__WEBPACK_IMPORTED_MODULE_3__[/* TransportType */ "d"][transport]}\' because it does not support the requested transfer format \'${_Transports__WEBPACK_IMPORTED_MODULE_3__[/* TransferFormat */ "c"][requestedTransferFormat]}\'.`);\r\n                }\r\n            }\r\n            else {\r\n                this.logger.log(_ILogger__WEBPACK_IMPORTED_MODULE_1__[/* LogLevel */ "a"].Trace, `Skipping transport \'${_Transports__WEBPACK_IMPORTED_MODULE_3__[/* TransportType */ "d"][transport]}\' because it was disabled by the client.`);\r\n            }\r\n        }\r\n        return null;\r\n    }\r\n    isITransport(transport) {\r\n        return typeof (transport) === "object" && "connect" in transport;\r\n    }\r\n    changeState(from, to) {\r\n        if (this.connectionState === from) {\r\n            this.connectionState = to;\r\n            return true;\r\n        }\r\n        return false;\r\n    }\r\n    send(data) {\r\n        if (this.connectionState !== 1 /* Connected */) {\r\n            throw new Error("Cannot send data if the connection is not in the \'Connected\' State.");\r\n        }\r\n        return this.transport.send(data);\r\n    }\r\n    stop(error) {\r\n        return __awaiter(this, void 0, void 0, function* () {\r\n            const previousState = this.connectionState;\r\n            this.connectionState = 2 /* Disconnected */;\r\n            try {\r\n                yield this.startPromise;\r\n            }\r\n            catch (e) {\r\n                // this exception is returned to the user as a rejected Promise from the start method\r\n            }\r\n            this.stopConnection(/*raiseClosed*/ previousState === 1 /* Connected */, error);\r\n        });\r\n    }\r\n    stopConnection(raiseClosed, error) {\r\n        if (this.transport) {\r\n            this.transport.stop();\r\n            this.transport = null;\r\n        }\r\n        if (error) {\r\n            this.logger.log(_ILogger__WEBPACK_IMPORTED_MODULE_1__[/* LogLevel */ "a"].Error, `Connection disconnected with error \'${error}\'.`);\r\n        }\r\n        else {\r\n            this.logger.log(_ILogger__WEBPACK_IMPORTED_MODULE_1__[/* LogLevel */ "a"].Information, "Connection disconnected.");\r\n        }\r\n        this.connectionState = 2 /* Disconnected */;\r\n        if (raiseClosed && this.onclose) {\r\n            this.onclose(error);\r\n        }\r\n    }\r\n    resolveUrl(url) {\r\n        // startsWith is not supported in IE\r\n        if (url.lastIndexOf("https://", 0) === 0 || url.lastIndexOf("http://", 0) === 0) {\r\n            return url;\r\n        }\r\n        if (typeof window === "undefined" || !window || !window.document) {\r\n            throw new Error(`Cannot resolve \'${url}\'.`);\r\n        }\r\n        const parser = window.document.createElement("a");\r\n        parser.href = url;\r\n        const baseUrl = (!parser.protocol || parser.protocol === ":")\r\n            ? `${window.document.location.protocol}//${(parser.host || window.document.location.host)}`\r\n            : `${parser.protocol}//${parser.host}`;\r\n        if (!url || url[0] !== "/") {\r\n            url = "/" + url;\r\n        }\r\n        const normalizedUrl = baseUrl + url;\r\n        this.logger.log(_ILogger__WEBPACK_IMPORTED_MODULE_1__[/* LogLevel */ "a"].Information, `Normalizing \'${url}\' to \'${normalizedUrl}\'.`);\r\n        return normalizedUrl;\r\n    }\r\n    resolveNegotiateUrl(url) {\r\n        const index = url.indexOf("?");\r\n        let negotiateUrl = url.substring(0, index === -1 ? url.length : index);\r\n        if (negotiateUrl[negotiateUrl.length - 1] !== "/") {\r\n            negotiateUrl += "/";\r\n        }\r\n        negotiateUrl += "negotiate";\r\n        negotiateUrl += index === -1 ? "" : url.substring(index);\r\n        return negotiateUrl;\r\n    }\r\n}\r\n//# sourceMappingURL=HttpConnection.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9ub2RlX21vZHVsZXMvQGFzcG5ldC9zaWduYWxyL2Rpc3QvZXNtL0h0dHBDb25uZWN0aW9uLmpzPzhlNmYiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7QUFBQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsbUNBQW1DLE1BQU0sNkJBQTZCLEVBQUUsWUFBWSxXQUFXLEVBQUU7QUFDakcsa0NBQWtDLE1BQU0saUNBQWlDLEVBQUUsWUFBWSxXQUFXLEVBQUU7QUFDcEcsK0JBQStCLGlFQUFpRSx1QkFBdUIsRUFBRSw0QkFBNEI7QUFDcko7QUFDQSxLQUFLO0FBQ0w7QUFDNEI7QUFDVDtBQUNLO0FBQ3FGO0FBQy9GO0FBQ2Q7QUFDQSxpQ0FBaUM7QUFDakM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxzSUFBcUYsbUZBQStCO0FBQ3BIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx5REFBeUQsTUFBTTtBQUMvRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQSw2SEFBNEUsYUFBYTtBQUN6RjtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0EseUZBQXlGLGtCQUFrQjtBQUMzRztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsMklBQTBGLDZFQUF5QixLQUFLLEdBQUc7QUFDM0g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esc0RBQXNELFVBQVU7QUFDaEU7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLG9IQUFtRSxtQkFBbUI7QUFDdEY7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxnSUFBK0UsNkVBQXlCO0FBQ3hHO0FBQ0E7QUFDQSxpSUFBZ0YsNkVBQXlCO0FBQ3pHO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsNEhBQTJFLDZFQUF5QiwrREFBK0QsNEZBQXdDO0FBQzNNO0FBQ0E7QUFDQTtBQUNBLHdIQUF1RSw2RUFBeUI7QUFDaEc7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxvSUFBbUYsTUFBTTtBQUN6RjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwrQ0FBK0MsSUFBSTtBQUNuRDtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQixrQ0FBa0MsSUFBSSwrQ0FBK0M7QUFDdEcsaUJBQWlCLGdCQUFnQixJQUFJLFlBQVk7QUFDakQ7QUFDQTtBQUNBO0FBQ0E7QUFDQSwrR0FBOEQsSUFBSSxRQUFRLGNBQWM7QUFDeEY7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSIsImZpbGUiOiI2LmpzIiwic291cmNlc0NvbnRlbnQiOlsiLy8gQ29weXJpZ2h0IChjKSAuTkVUIEZvdW5kYXRpb24uIEFsbCByaWdodHMgcmVzZXJ2ZWQuXHJcbi8vIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAuIFNlZSBMaWNlbnNlLnR4dCBpbiB0aGUgcHJvamVjdCByb290IGZvciBsaWNlbnNlIGluZm9ybWF0aW9uLlxyXG52YXIgX19hd2FpdGVyID0gKHRoaXMgJiYgdGhpcy5fX2F3YWl0ZXIpIHx8IGZ1bmN0aW9uICh0aGlzQXJnLCBfYXJndW1lbnRzLCBQLCBnZW5lcmF0b3IpIHtcclxuICAgIHJldHVybiBuZXcgKFAgfHwgKFAgPSBQcm9taXNlKSkoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge1xyXG4gICAgICAgIGZ1bmN0aW9uIGZ1bGZpbGxlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvci5uZXh0KHZhbHVlKSk7IH0gY2F0Y2ggKGUpIHsgcmVqZWN0KGUpOyB9IH1cclxuICAgICAgICBmdW5jdGlvbiByZWplY3RlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvcltcInRocm93XCJdKHZhbHVlKSk7IH0gY2F0Y2ggKGUpIHsgcmVqZWN0KGUpOyB9IH1cclxuICAgICAgICBmdW5jdGlvbiBzdGVwKHJlc3VsdCkgeyByZXN1bHQuZG9uZSA/IHJlc29sdmUocmVzdWx0LnZhbHVlKSA6IG5ldyBQKGZ1bmN0aW9uIChyZXNvbHZlKSB7IHJlc29sdmUocmVzdWx0LnZhbHVlKTsgfSkudGhlbihmdWxmaWxsZWQsIHJlamVjdGVkKTsgfVxyXG4gICAgICAgIHN0ZXAoKGdlbmVyYXRvciA9IGdlbmVyYXRvci5hcHBseSh0aGlzQXJnLCBfYXJndW1lbnRzIHx8IFtdKSkubmV4dCgpKTtcclxuICAgIH0pO1xyXG59O1xyXG5pbXBvcnQgeyBEZWZhdWx0SHR0cENsaWVudCB9IGZyb20gXCIuL0h0dHBDbGllbnRcIjtcclxuaW1wb3J0IHsgTG9nTGV2ZWwgfSBmcm9tIFwiLi9JTG9nZ2VyXCI7XHJcbmltcG9ydCB7IExvZ2dlckZhY3RvcnkgfSBmcm9tIFwiLi9Mb2dnZXJzXCI7XHJcbmltcG9ydCB7IExvbmdQb2xsaW5nVHJhbnNwb3J0LCBTZXJ2ZXJTZW50RXZlbnRzVHJhbnNwb3J0LCBUcmFuc2ZlckZvcm1hdCwgVHJhbnNwb3J0VHlwZSwgV2ViU29ja2V0VHJhbnNwb3J0IH0gZnJvbSBcIi4vVHJhbnNwb3J0c1wiO1xyXG5pbXBvcnQgeyBBcmcgfSBmcm9tIFwiLi9VdGlsc1wiO1xyXG5leHBvcnQgY2xhc3MgSHR0cENvbm5lY3Rpb24ge1xyXG4gICAgY29uc3RydWN0b3IodXJsLCBvcHRpb25zID0ge30pIHtcclxuICAgICAgICB0aGlzLmZlYXR1cmVzID0ge307XHJcbiAgICAgICAgQXJnLmlzUmVxdWlyZWQodXJsLCBcInVybFwiKTtcclxuICAgICAgICB0aGlzLmxvZ2dlciA9IExvZ2dlckZhY3RvcnkuY3JlYXRlTG9nZ2VyKG9wdGlvbnMubG9nZ2VyKTtcclxuICAgICAgICB0aGlzLmJhc2VVcmwgPSB0aGlzLnJlc29sdmVVcmwodXJsKTtcclxuICAgICAgICBvcHRpb25zID0gb3B0aW9ucyB8fCB7fTtcclxuICAgICAgICBvcHRpb25zLmFjY2Vzc1Rva2VuRmFjdG9yeSA9IG9wdGlvbnMuYWNjZXNzVG9rZW5GYWN0b3J5IHx8ICgoKSA9PiBudWxsKTtcclxuICAgICAgICB0aGlzLmh0dHBDbGllbnQgPSBvcHRpb25zLmh0dHBDbGllbnQgfHwgbmV3IERlZmF1bHRIdHRwQ2xpZW50KHRoaXMubG9nZ2VyKTtcclxuICAgICAgICB0aGlzLmNvbm5lY3Rpb25TdGF0ZSA9IDIgLyogRGlzY29ubmVjdGVkICovO1xyXG4gICAgICAgIHRoaXMub3B0aW9ucyA9IG9wdGlvbnM7XHJcbiAgICB9XHJcbiAgICBzdGFydCh0cmFuc2ZlckZvcm1hdCkge1xyXG4gICAgICAgIEFyZy5pc1JlcXVpcmVkKHRyYW5zZmVyRm9ybWF0LCBcInRyYW5zZmVyRm9ybWF0XCIpO1xyXG4gICAgICAgIEFyZy5pc0luKHRyYW5zZmVyRm9ybWF0LCBUcmFuc2ZlckZvcm1hdCwgXCJ0cmFuc2ZlckZvcm1hdFwiKTtcclxuICAgICAgICB0aGlzLmxvZ2dlci5sb2coTG9nTGV2ZWwuVHJhY2UsIGBTdGFydGluZyBjb25uZWN0aW9uIHdpdGggdHJhbnNmZXIgZm9ybWF0ICcke1RyYW5zZmVyRm9ybWF0W3RyYW5zZmVyRm9ybWF0XX0nLmApO1xyXG4gICAgICAgIGlmICh0aGlzLmNvbm5lY3Rpb25TdGF0ZSAhPT0gMiAvKiBEaXNjb25uZWN0ZWQgKi8pIHtcclxuICAgICAgICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KG5ldyBFcnJvcihcIkNhbm5vdCBzdGFydCBhIGNvbm5lY3Rpb24gdGhhdCBpcyBub3QgaW4gdGhlICdEaXNjb25uZWN0ZWQnIHN0YXRlLlwiKSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuY29ubmVjdGlvblN0YXRlID0gMCAvKiBDb25uZWN0aW5nICovO1xyXG4gICAgICAgIHRoaXMuc3RhcnRQcm9taXNlID0gdGhpcy5zdGFydEludGVybmFsKHRyYW5zZmVyRm9ybWF0KTtcclxuICAgICAgICByZXR1cm4gdGhpcy5zdGFydFByb21pc2U7XHJcbiAgICB9XHJcbiAgICBzdGFydEludGVybmFsKHRyYW5zZmVyRm9ybWF0KSB7XHJcbiAgICAgICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcclxuICAgICAgICAgICAgdHJ5IHtcclxuICAgICAgICAgICAgICAgIGlmICh0aGlzLm9wdGlvbnMudHJhbnNwb3J0ID09PSBUcmFuc3BvcnRUeXBlLldlYlNvY2tldHMpIHtcclxuICAgICAgICAgICAgICAgICAgICAvLyBObyBuZWVkIHRvIGFkZCBhIGNvbm5lY3Rpb24gSUQgaW4gdGhpcyBjYXNlXHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy51cmwgPSB0aGlzLmJhc2VVcmw7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy50cmFuc3BvcnQgPSB0aGlzLmNvbnN0cnVjdFRyYW5zcG9ydChUcmFuc3BvcnRUeXBlLldlYlNvY2tldHMpO1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIFdlIHNob3VsZCBqdXN0IGNhbGwgY29ubmVjdCBkaXJlY3RseSBpbiB0aGlzIGNhc2UuXHJcbiAgICAgICAgICAgICAgICAgICAgLy8gTm8gZmFsbGJhY2sgb3IgbmVnb3RpYXRlIGluIHRoaXMgY2FzZS5cclxuICAgICAgICAgICAgICAgICAgICB5aWVsZCB0aGlzLnRyYW5zcG9ydC5jb25uZWN0KHRoaXMudXJsLCB0cmFuc2ZlckZvcm1hdCwgdGhpcyk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCB0b2tlbiA9IHRoaXMub3B0aW9ucy5hY2Nlc3NUb2tlbkZhY3RvcnkoKTtcclxuICAgICAgICAgICAgICAgICAgICBsZXQgaGVhZGVycztcclxuICAgICAgICAgICAgICAgICAgICBpZiAodG9rZW4pIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaGVhZGVycyA9IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFtcIkF1dGhvcml6YXRpb25cIl06IGBCZWFyZXIgJHt0b2tlbn1gLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBjb25zdCBuZWdvdGlhdGVSZXNwb25zZSA9IHlpZWxkIHRoaXMuZ2V0TmVnb3RpYXRpb25SZXNwb25zZShoZWFkZXJzKTtcclxuICAgICAgICAgICAgICAgICAgICAvLyB0aGUgdXNlciB0cmllcyB0byBzdG9wIHRoZSB0aGUgY29ubmVjdGlvbiB3aGVuIGl0IGlzIGJlaW5nIHN0YXJ0ZWRcclxuICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5jb25uZWN0aW9uU3RhdGUgPT09IDIgLyogRGlzY29ubmVjdGVkICovKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgeWllbGQgdGhpcy5jcmVhdGVUcmFuc3BvcnQodGhpcy5vcHRpb25zLnRyYW5zcG9ydCwgbmVnb3RpYXRlUmVzcG9uc2UsIHRyYW5zZmVyRm9ybWF0LCBoZWFkZXJzKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIHRoaXMudHJhbnNwb3J0Lm9ucmVjZWl2ZSA9IHRoaXMub25yZWNlaXZlO1xyXG4gICAgICAgICAgICAgICAgdGhpcy50cmFuc3BvcnQub25jbG9zZSA9IChlKSA9PiB0aGlzLnN0b3BDb25uZWN0aW9uKHRydWUsIGUpO1xyXG4gICAgICAgICAgICAgICAgLy8gb25seSBjaGFuZ2UgdGhlIHN0YXRlIGlmIHdlIHdlcmUgY29ubmVjdGluZyB0byBub3Qgb3ZlcndyaXRlXHJcbiAgICAgICAgICAgICAgICAvLyB0aGUgc3RhdGUgaWYgdGhlIGNvbm5lY3Rpb24gaXMgYWxyZWFkeSBtYXJrZWQgYXMgRGlzY29ubmVjdGVkXHJcbiAgICAgICAgICAgICAgICB0aGlzLmNoYW5nZVN0YXRlKDAgLyogQ29ubmVjdGluZyAqLywgMSAvKiBDb25uZWN0ZWQgKi8pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGNhdGNoIChlKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmxvZ2dlci5sb2coTG9nTGV2ZWwuRXJyb3IsIFwiRmFpbGVkIHRvIHN0YXJ0IHRoZSBjb25uZWN0aW9uOiBcIiArIGUpO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5jb25uZWN0aW9uU3RhdGUgPSAyIC8qIERpc2Nvbm5lY3RlZCAqLztcclxuICAgICAgICAgICAgICAgIHRoaXMudHJhbnNwb3J0ID0gbnVsbDtcclxuICAgICAgICAgICAgICAgIHRocm93IGU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgIH1cclxuICAgIGdldE5lZ290aWF0aW9uUmVzcG9uc2UoaGVhZGVycykge1xyXG4gICAgICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IG5lZ290aWF0ZVVybCA9IHRoaXMucmVzb2x2ZU5lZ290aWF0ZVVybCh0aGlzLmJhc2VVcmwpO1xyXG4gICAgICAgICAgICB0aGlzLmxvZ2dlci5sb2coTG9nTGV2ZWwuVHJhY2UsIGBTZW5kaW5nIG5lZ290aWF0aW9uIHJlcXVlc3Q6ICR7bmVnb3RpYXRlVXJsfWApO1xyXG4gICAgICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICAgICAgY29uc3QgcmVzcG9uc2UgPSB5aWVsZCB0aGlzLmh0dHBDbGllbnQucG9zdChuZWdvdGlhdGVVcmwsIHtcclxuICAgICAgICAgICAgICAgICAgICBjb250ZW50OiBcIlwiLFxyXG4gICAgICAgICAgICAgICAgICAgIGhlYWRlcnMsXHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIHJldHVybiBKU09OLnBhcnNlKHJlc3BvbnNlLmNvbnRlbnQpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGNhdGNoIChlKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmxvZ2dlci5sb2coTG9nTGV2ZWwuRXJyb3IsIFwiRmFpbGVkIHRvIGNvbXBsZXRlIG5lZ290aWF0aW9uIHdpdGggdGhlIHNlcnZlcjogXCIgKyBlKTtcclxuICAgICAgICAgICAgICAgIHRocm93IGU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgIH1cclxuICAgIHVwZGF0ZUNvbm5lY3Rpb25JZChuZWdvdGlhdGVSZXNwb25zZSkge1xyXG4gICAgICAgIHRoaXMuY29ubmVjdGlvbklkID0gbmVnb3RpYXRlUmVzcG9uc2UuY29ubmVjdGlvbklkO1xyXG4gICAgICAgIHRoaXMudXJsID0gdGhpcy5iYXNlVXJsICsgKHRoaXMuYmFzZVVybC5pbmRleE9mKFwiP1wiKSA9PT0gLTEgPyBcIj9cIiA6IFwiJlwiKSArIGBpZD0ke3RoaXMuY29ubmVjdGlvbklkfWA7XHJcbiAgICB9XHJcbiAgICBjcmVhdGVUcmFuc3BvcnQocmVxdWVzdGVkVHJhbnNwb3J0LCBuZWdvdGlhdGVSZXNwb25zZSwgcmVxdWVzdGVkVHJhbnNmZXJGb3JtYXQsIGhlYWRlcnMpIHtcclxuICAgICAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xyXG4gICAgICAgICAgICB0aGlzLnVwZGF0ZUNvbm5lY3Rpb25JZChuZWdvdGlhdGVSZXNwb25zZSk7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLmlzSVRyYW5zcG9ydChyZXF1ZXN0ZWRUcmFuc3BvcnQpKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmxvZ2dlci5sb2coTG9nTGV2ZWwuVHJhY2UsIFwiQ29ubmVjdGlvbiB3YXMgcHJvdmlkZWQgYW4gaW5zdGFuY2Ugb2YgSVRyYW5zcG9ydCwgdXNpbmcgdGhhdCBkaXJlY3RseS5cIik7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnRyYW5zcG9ydCA9IHJlcXVlc3RlZFRyYW5zcG9ydDtcclxuICAgICAgICAgICAgICAgIHlpZWxkIHRoaXMudHJhbnNwb3J0LmNvbm5lY3QodGhpcy51cmwsIHJlcXVlc3RlZFRyYW5zZmVyRm9ybWF0LCB0aGlzKTtcclxuICAgICAgICAgICAgICAgIC8vIG9ubHkgY2hhbmdlIHRoZSBzdGF0ZSBpZiB3ZSB3ZXJlIGNvbm5lY3RpbmcgdG8gbm90IG92ZXJ3cml0ZVxyXG4gICAgICAgICAgICAgICAgLy8gdGhlIHN0YXRlIGlmIHRoZSBjb25uZWN0aW9uIGlzIGFscmVhZHkgbWFya2VkIGFzIERpc2Nvbm5lY3RlZFxyXG4gICAgICAgICAgICAgICAgdGhpcy5jaGFuZ2VTdGF0ZSgwIC8qIENvbm5lY3RpbmcgKi8sIDEgLyogQ29ubmVjdGVkICovKTtcclxuICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBjb25zdCB0cmFuc3BvcnRzID0gbmVnb3RpYXRlUmVzcG9uc2UuYXZhaWxhYmxlVHJhbnNwb3J0cztcclxuICAgICAgICAgICAgZm9yIChjb25zdCBlbmRwb2ludCBvZiB0cmFuc3BvcnRzKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmNvbm5lY3Rpb25TdGF0ZSA9IDAgLyogQ29ubmVjdGluZyAqLztcclxuICAgICAgICAgICAgICAgIGNvbnN0IHRyYW5zcG9ydCA9IHRoaXMucmVzb2x2ZVRyYW5zcG9ydChlbmRwb2ludCwgcmVxdWVzdGVkVHJhbnNwb3J0LCByZXF1ZXN0ZWRUcmFuc2ZlckZvcm1hdCk7XHJcbiAgICAgICAgICAgICAgICBpZiAodHlwZW9mIHRyYW5zcG9ydCA9PT0gXCJudW1iZXJcIikge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMudHJhbnNwb3J0ID0gdGhpcy5jb25zdHJ1Y3RUcmFuc3BvcnQodHJhbnNwb3J0KTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAobmVnb3RpYXRlUmVzcG9uc2UuY29ubmVjdGlvbklkID09PSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG5lZ290aWF0ZVJlc3BvbnNlID0geWllbGQgdGhpcy5nZXROZWdvdGlhdGlvblJlc3BvbnNlKGhlYWRlcnMpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnVwZGF0ZUNvbm5lY3Rpb25JZChuZWdvdGlhdGVSZXNwb25zZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHlpZWxkIHRoaXMudHJhbnNwb3J0LmNvbm5lY3QodGhpcy51cmwsIHJlcXVlc3RlZFRyYW5zZmVyRm9ybWF0LCB0aGlzKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5jaGFuZ2VTdGF0ZSgwIC8qIENvbm5lY3RpbmcgKi8sIDEgLyogQ29ubmVjdGVkICovKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBjYXRjaCAoZXgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5sb2dnZXIubG9nKExvZ0xldmVsLkVycm9yLCBgRmFpbGVkIHRvIHN0YXJ0IHRoZSB0cmFuc3BvcnQgJyR7VHJhbnNwb3J0VHlwZVt0cmFuc3BvcnRdfSc6ICR7ZXh9YCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuY29ubmVjdGlvblN0YXRlID0gMiAvKiBEaXNjb25uZWN0ZWQgKi87XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG5lZ290aWF0ZVJlc3BvbnNlLmNvbm5lY3Rpb25JZCA9IG51bGw7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIlVuYWJsZSB0byBpbml0aWFsaXplIGFueSBvZiB0aGUgYXZhaWxhYmxlIHRyYW5zcG9ydHMuXCIpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG4gICAgY29uc3RydWN0VHJhbnNwb3J0KHRyYW5zcG9ydCkge1xyXG4gICAgICAgIHN3aXRjaCAodHJhbnNwb3J0KSB7XHJcbiAgICAgICAgICAgIGNhc2UgVHJhbnNwb3J0VHlwZS5XZWJTb2NrZXRzOlxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBXZWJTb2NrZXRUcmFuc3BvcnQodGhpcy5vcHRpb25zLmFjY2Vzc1Rva2VuRmFjdG9yeSwgdGhpcy5sb2dnZXIpO1xyXG4gICAgICAgICAgICBjYXNlIFRyYW5zcG9ydFR5cGUuU2VydmVyU2VudEV2ZW50czpcclxuICAgICAgICAgICAgICAgIHJldHVybiBuZXcgU2VydmVyU2VudEV2ZW50c1RyYW5zcG9ydCh0aGlzLmh0dHBDbGllbnQsIHRoaXMub3B0aW9ucy5hY2Nlc3NUb2tlbkZhY3RvcnksIHRoaXMubG9nZ2VyKTtcclxuICAgICAgICAgICAgY2FzZSBUcmFuc3BvcnRUeXBlLkxvbmdQb2xsaW5nOlxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBMb25nUG9sbGluZ1RyYW5zcG9ydCh0aGlzLmh0dHBDbGllbnQsIHRoaXMub3B0aW9ucy5hY2Nlc3NUb2tlbkZhY3RvcnksIHRoaXMubG9nZ2VyKTtcclxuICAgICAgICAgICAgZGVmYXVsdDpcclxuICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgVW5rbm93biB0cmFuc3BvcnQ6ICR7dHJhbnNwb3J0fS5gKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICByZXNvbHZlVHJhbnNwb3J0KGVuZHBvaW50LCByZXF1ZXN0ZWRUcmFuc3BvcnQsIHJlcXVlc3RlZFRyYW5zZmVyRm9ybWF0KSB7XHJcbiAgICAgICAgY29uc3QgdHJhbnNwb3J0ID0gVHJhbnNwb3J0VHlwZVtlbmRwb2ludC50cmFuc3BvcnRdO1xyXG4gICAgICAgIGlmICh0cmFuc3BvcnQgPT09IG51bGwgfHwgdHJhbnNwb3J0ID09PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgdGhpcy5sb2dnZXIubG9nKExvZ0xldmVsLlRyYWNlLCBgU2tpcHBpbmcgdHJhbnNwb3J0ICcke2VuZHBvaW50LnRyYW5zcG9ydH0nIGJlY2F1c2UgaXQgaXMgbm90IHN1cHBvcnRlZCBieSB0aGlzIGNsaWVudC5gKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIGNvbnN0IHRyYW5zZmVyRm9ybWF0cyA9IGVuZHBvaW50LnRyYW5zZmVyRm9ybWF0cy5tYXAoKHMpID0+IFRyYW5zZmVyRm9ybWF0W3NdKTtcclxuICAgICAgICAgICAgaWYgKCFyZXF1ZXN0ZWRUcmFuc3BvcnQgfHwgdHJhbnNwb3J0ID09PSByZXF1ZXN0ZWRUcmFuc3BvcnQpIHtcclxuICAgICAgICAgICAgICAgIGlmICh0cmFuc2ZlckZvcm1hdHMuaW5kZXhPZihyZXF1ZXN0ZWRUcmFuc2ZlckZvcm1hdCkgPj0gMCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICgodHJhbnNwb3J0ID09PSBUcmFuc3BvcnRUeXBlLldlYlNvY2tldHMgJiYgdHlwZW9mIFdlYlNvY2tldCA9PT0gXCJ1bmRlZmluZWRcIikgfHxcclxuICAgICAgICAgICAgICAgICAgICAgICAgKHRyYW5zcG9ydCA9PT0gVHJhbnNwb3J0VHlwZS5TZXJ2ZXJTZW50RXZlbnRzICYmIHR5cGVvZiBFdmVudFNvdXJjZSA9PT0gXCJ1bmRlZmluZWRcIikpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5sb2dnZXIubG9nKExvZ0xldmVsLlRyYWNlLCBgU2tpcHBpbmcgdHJhbnNwb3J0ICcke1RyYW5zcG9ydFR5cGVbdHJhbnNwb3J0XX0nIGJlY2F1c2UgaXQgaXMgbm90IHN1cHBvcnRlZCBpbiB5b3VyIGVudmlyb25tZW50LidgKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubG9nZ2VyLmxvZyhMb2dMZXZlbC5UcmFjZSwgYFNlbGVjdGluZyB0cmFuc3BvcnQgJyR7VHJhbnNwb3J0VHlwZVt0cmFuc3BvcnRdfSdgKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRyYW5zcG9ydDtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmxvZ2dlci5sb2coTG9nTGV2ZWwuVHJhY2UsIGBTa2lwcGluZyB0cmFuc3BvcnQgJyR7VHJhbnNwb3J0VHlwZVt0cmFuc3BvcnRdfScgYmVjYXVzZSBpdCBkb2VzIG5vdCBzdXBwb3J0IHRoZSByZXF1ZXN0ZWQgdHJhbnNmZXIgZm9ybWF0ICcke1RyYW5zZmVyRm9ybWF0W3JlcXVlc3RlZFRyYW5zZmVyRm9ybWF0XX0nLmApO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5sb2dnZXIubG9nKExvZ0xldmVsLlRyYWNlLCBgU2tpcHBpbmcgdHJhbnNwb3J0ICcke1RyYW5zcG9ydFR5cGVbdHJhbnNwb3J0XX0nIGJlY2F1c2UgaXQgd2FzIGRpc2FibGVkIGJ5IHRoZSBjbGllbnQuYCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICB9XHJcbiAgICBpc0lUcmFuc3BvcnQodHJhbnNwb3J0KSB7XHJcbiAgICAgICAgcmV0dXJuIHR5cGVvZiAodHJhbnNwb3J0KSA9PT0gXCJvYmplY3RcIiAmJiBcImNvbm5lY3RcIiBpbiB0cmFuc3BvcnQ7XHJcbiAgICB9XHJcbiAgICBjaGFuZ2VTdGF0ZShmcm9tLCB0bykge1xyXG4gICAgICAgIGlmICh0aGlzLmNvbm5lY3Rpb25TdGF0ZSA9PT0gZnJvbSkge1xyXG4gICAgICAgICAgICB0aGlzLmNvbm5lY3Rpb25TdGF0ZSA9IHRvO1xyXG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgfVxyXG4gICAgc2VuZChkYXRhKSB7XHJcbiAgICAgICAgaWYgKHRoaXMuY29ubmVjdGlvblN0YXRlICE9PSAxIC8qIENvbm5lY3RlZCAqLykge1xyXG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJDYW5ub3Qgc2VuZCBkYXRhIGlmIHRoZSBjb25uZWN0aW9uIGlzIG5vdCBpbiB0aGUgJ0Nvbm5lY3RlZCcgU3RhdGUuXCIpO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gdGhpcy50cmFuc3BvcnQuc2VuZChkYXRhKTtcclxuICAgIH1cclxuICAgIHN0b3AoZXJyb3IpIHtcclxuICAgICAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xyXG4gICAgICAgICAgICBjb25zdCBwcmV2aW91c1N0YXRlID0gdGhpcy5jb25uZWN0aW9uU3RhdGU7XHJcbiAgICAgICAgICAgIHRoaXMuY29ubmVjdGlvblN0YXRlID0gMiAvKiBEaXNjb25uZWN0ZWQgKi87XHJcbiAgICAgICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAgICAgICB5aWVsZCB0aGlzLnN0YXJ0UHJvbWlzZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBjYXRjaCAoZSkge1xyXG4gICAgICAgICAgICAgICAgLy8gdGhpcyBleGNlcHRpb24gaXMgcmV0dXJuZWQgdG8gdGhlIHVzZXIgYXMgYSByZWplY3RlZCBQcm9taXNlIGZyb20gdGhlIHN0YXJ0IG1ldGhvZFxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHRoaXMuc3RvcENvbm5lY3Rpb24oLypyYWlzZUNsb3NlZCovIHByZXZpb3VzU3RhdGUgPT09IDEgLyogQ29ubmVjdGVkICovLCBlcnJvcik7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcbiAgICBzdG9wQ29ubmVjdGlvbihyYWlzZUNsb3NlZCwgZXJyb3IpIHtcclxuICAgICAgICBpZiAodGhpcy50cmFuc3BvcnQpIHtcclxuICAgICAgICAgICAgdGhpcy50cmFuc3BvcnQuc3RvcCgpO1xyXG4gICAgICAgICAgICB0aGlzLnRyYW5zcG9ydCA9IG51bGw7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChlcnJvcikge1xyXG4gICAgICAgICAgICB0aGlzLmxvZ2dlci5sb2coTG9nTGV2ZWwuRXJyb3IsIGBDb25uZWN0aW9uIGRpc2Nvbm5lY3RlZCB3aXRoIGVycm9yICcke2Vycm9yfScuYCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICB0aGlzLmxvZ2dlci5sb2coTG9nTGV2ZWwuSW5mb3JtYXRpb24sIFwiQ29ubmVjdGlvbiBkaXNjb25uZWN0ZWQuXCIpO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLmNvbm5lY3Rpb25TdGF0ZSA9IDIgLyogRGlzY29ubmVjdGVkICovO1xyXG4gICAgICAgIGlmIChyYWlzZUNsb3NlZCAmJiB0aGlzLm9uY2xvc2UpIHtcclxuICAgICAgICAgICAgdGhpcy5vbmNsb3NlKGVycm9yKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICByZXNvbHZlVXJsKHVybCkge1xyXG4gICAgICAgIC8vIHN0YXJ0c1dpdGggaXMgbm90IHN1cHBvcnRlZCBpbiBJRVxyXG4gICAgICAgIGlmICh1cmwubGFzdEluZGV4T2YoXCJodHRwczovL1wiLCAwKSA9PT0gMCB8fCB1cmwubGFzdEluZGV4T2YoXCJodHRwOi8vXCIsIDApID09PSAwKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB1cmw7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICh0eXBlb2Ygd2luZG93ID09PSBcInVuZGVmaW5lZFwiIHx8ICF3aW5kb3cgfHwgIXdpbmRvdy5kb2N1bWVudCkge1xyXG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYENhbm5vdCByZXNvbHZlICcke3VybH0nLmApO1xyXG4gICAgICAgIH1cclxuICAgICAgICBjb25zdCBwYXJzZXIgPSB3aW5kb3cuZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImFcIik7XHJcbiAgICAgICAgcGFyc2VyLmhyZWYgPSB1cmw7XHJcbiAgICAgICAgY29uc3QgYmFzZVVybCA9ICghcGFyc2VyLnByb3RvY29sIHx8IHBhcnNlci5wcm90b2NvbCA9PT0gXCI6XCIpXHJcbiAgICAgICAgICAgID8gYCR7d2luZG93LmRvY3VtZW50LmxvY2F0aW9uLnByb3RvY29sfS8vJHsocGFyc2VyLmhvc3QgfHwgd2luZG93LmRvY3VtZW50LmxvY2F0aW9uLmhvc3QpfWBcclxuICAgICAgICAgICAgOiBgJHtwYXJzZXIucHJvdG9jb2x9Ly8ke3BhcnNlci5ob3N0fWA7XHJcbiAgICAgICAgaWYgKCF1cmwgfHwgdXJsWzBdICE9PSBcIi9cIikge1xyXG4gICAgICAgICAgICB1cmwgPSBcIi9cIiArIHVybDtcclxuICAgICAgICB9XHJcbiAgICAgICAgY29uc3Qgbm9ybWFsaXplZFVybCA9IGJhc2VVcmwgKyB1cmw7XHJcbiAgICAgICAgdGhpcy5sb2dnZXIubG9nKExvZ0xldmVsLkluZm9ybWF0aW9uLCBgTm9ybWFsaXppbmcgJyR7dXJsfScgdG8gJyR7bm9ybWFsaXplZFVybH0nLmApO1xyXG4gICAgICAgIHJldHVybiBub3JtYWxpemVkVXJsO1xyXG4gICAgfVxyXG4gICAgcmVzb2x2ZU5lZ290aWF0ZVVybCh1cmwpIHtcclxuICAgICAgICBjb25zdCBpbmRleCA9IHVybC5pbmRleE9mKFwiP1wiKTtcclxuICAgICAgICBsZXQgbmVnb3RpYXRlVXJsID0gdXJsLnN1YnN0cmluZygwLCBpbmRleCA9PT0gLTEgPyB1cmwubGVuZ3RoIDogaW5kZXgpO1xyXG4gICAgICAgIGlmIChuZWdvdGlhdGVVcmxbbmVnb3RpYXRlVXJsLmxlbmd0aCAtIDFdICE9PSBcIi9cIikge1xyXG4gICAgICAgICAgICBuZWdvdGlhdGVVcmwgKz0gXCIvXCI7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIG5lZ290aWF0ZVVybCArPSBcIm5lZ290aWF0ZVwiO1xyXG4gICAgICAgIG5lZ290aWF0ZVVybCArPSBpbmRleCA9PT0gLTEgPyBcIlwiIDogdXJsLnN1YnN0cmluZyhpbmRleCk7XHJcbiAgICAgICAgcmV0dXJuIG5lZ290aWF0ZVVybDtcclxuICAgIH1cclxufVxyXG4vLyMgc291cmNlTWFwcGluZ1VSTD1IdHRwQ29ubmVjdGlvbi5qcy5tYXAiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///6\n')},function(module,__webpack_exports__,__webpack_require__){"use strict";eval('/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "c", function() { return HttpResponse; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "b", function() { return HttpClient; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "a", function() { return DefaultHttpClient; });\n/* harmony import */ var _Errors__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(3);\n/* harmony import */ var _ILogger__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(0);\n// Copyright (c) .NET Foundation. All rights reserved.\r\n// Licensed under the Apache License, Version 2.0. See License.txt in the project root for license information.\r\n\r\n\r\nclass HttpResponse {\r\n    constructor(statusCode, statusText, content) {\r\n        this.statusCode = statusCode;\r\n        this.statusText = statusText;\r\n        this.content = content;\r\n    }\r\n}\r\nclass HttpClient {\r\n    get(url, options) {\r\n        return this.send(Object.assign({}, options, { method: "GET", url }));\r\n    }\r\n    post(url, options) {\r\n        return this.send(Object.assign({}, options, { method: "POST", url }));\r\n    }\r\n}\r\nclass DefaultHttpClient extends HttpClient {\r\n    constructor(logger) {\r\n        super();\r\n        this.logger = logger;\r\n    }\r\n    send(request) {\r\n        return new Promise((resolve, reject) => {\r\n            const xhr = new XMLHttpRequest();\r\n            xhr.open(request.method, request.url, true);\r\n            xhr.withCredentials = true;\r\n            xhr.setRequestHeader("X-Requested-With", "XMLHttpRequest");\r\n            if (request.headers) {\r\n                Object.keys(request.headers)\r\n                    .forEach((header) => xhr.setRequestHeader(header, request.headers[header]));\r\n            }\r\n            if (request.responseType) {\r\n                xhr.responseType = request.responseType;\r\n            }\r\n            if (request.abortSignal) {\r\n                request.abortSignal.onabort = () => {\r\n                    xhr.abort();\r\n                };\r\n            }\r\n            if (request.timeout) {\r\n                xhr.timeout = request.timeout;\r\n            }\r\n            xhr.onload = () => {\r\n                if (request.abortSignal) {\r\n                    request.abortSignal.onabort = null;\r\n                }\r\n                if (xhr.status >= 200 && xhr.status < 300) {\r\n                    resolve(new HttpResponse(xhr.status, xhr.statusText, xhr.response || xhr.responseText));\r\n                }\r\n                else {\r\n                    reject(new _Errors__WEBPACK_IMPORTED_MODULE_0__[/* HttpError */ "a"](xhr.statusText, xhr.status));\r\n                }\r\n            };\r\n            xhr.onerror = () => {\r\n                this.logger.log(_ILogger__WEBPACK_IMPORTED_MODULE_1__[/* LogLevel */ "a"].Warning, `Error from HTTP request. ${xhr.status}: ${xhr.statusText}`);\r\n                reject(new _Errors__WEBPACK_IMPORTED_MODULE_0__[/* HttpError */ "a"](xhr.statusText, xhr.status));\r\n            };\r\n            xhr.ontimeout = () => {\r\n                this.logger.log(_ILogger__WEBPACK_IMPORTED_MODULE_1__[/* LogLevel */ "a"].Warning, `Timeout from HTTP request.`);\r\n                reject(new _Errors__WEBPACK_IMPORTED_MODULE_0__[/* TimeoutError */ "b"]());\r\n            };\r\n            xhr.send(request.content || "");\r\n        });\r\n    }\r\n}\r\n//# sourceMappingURL=HttpClient.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9ub2RlX21vZHVsZXMvQGFzcG5ldC9zaWduYWxyL2Rpc3QvZXNtL0h0dHBDbGllbnQuanM/ODNmZCJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7O0FBQUE7QUFBQTtBQUNBO0FBQ2tDO0FBQ2Y7QUFDbkI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EseUNBQXlDLFlBQVkscUJBQXFCO0FBQzFFO0FBQ0E7QUFDQSx5Q0FBeUMsWUFBWSxzQkFBc0I7QUFDM0U7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwrSEFBOEUsV0FBVyxJQUFJLGVBQWU7QUFDNUc7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBIiwiZmlsZSI6IjcuanMiLCJzb3VyY2VzQ29udGVudCI6WyIvLyBDb3B5cmlnaHQgKGMpIC5ORVQgRm91bmRhdGlvbi4gQWxsIHJpZ2h0cyByZXNlcnZlZC5cclxuLy8gTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMC4gU2VlIExpY2Vuc2UudHh0IGluIHRoZSBwcm9qZWN0IHJvb3QgZm9yIGxpY2Vuc2UgaW5mb3JtYXRpb24uXHJcbmltcG9ydCB7IEh0dHBFcnJvciwgVGltZW91dEVycm9yIH0gZnJvbSBcIi4vRXJyb3JzXCI7XHJcbmltcG9ydCB7IExvZ0xldmVsIH0gZnJvbSBcIi4vSUxvZ2dlclwiO1xyXG5leHBvcnQgY2xhc3MgSHR0cFJlc3BvbnNlIHtcclxuICAgIGNvbnN0cnVjdG9yKHN0YXR1c0NvZGUsIHN0YXR1c1RleHQsIGNvbnRlbnQpIHtcclxuICAgICAgICB0aGlzLnN0YXR1c0NvZGUgPSBzdGF0dXNDb2RlO1xyXG4gICAgICAgIHRoaXMuc3RhdHVzVGV4dCA9IHN0YXR1c1RleHQ7XHJcbiAgICAgICAgdGhpcy5jb250ZW50ID0gY29udGVudDtcclxuICAgIH1cclxufVxyXG5leHBvcnQgY2xhc3MgSHR0cENsaWVudCB7XHJcbiAgICBnZXQodXJsLCBvcHRpb25zKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuc2VuZChPYmplY3QuYXNzaWduKHt9LCBvcHRpb25zLCB7IG1ldGhvZDogXCJHRVRcIiwgdXJsIH0pKTtcclxuICAgIH1cclxuICAgIHBvc3QodXJsLCBvcHRpb25zKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuc2VuZChPYmplY3QuYXNzaWduKHt9LCBvcHRpb25zLCB7IG1ldGhvZDogXCJQT1NUXCIsIHVybCB9KSk7XHJcbiAgICB9XHJcbn1cclxuZXhwb3J0IGNsYXNzIERlZmF1bHRIdHRwQ2xpZW50IGV4dGVuZHMgSHR0cENsaWVudCB7XHJcbiAgICBjb25zdHJ1Y3Rvcihsb2dnZXIpIHtcclxuICAgICAgICBzdXBlcigpO1xyXG4gICAgICAgIHRoaXMubG9nZ2VyID0gbG9nZ2VyO1xyXG4gICAgfVxyXG4gICAgc2VuZChyZXF1ZXN0KSB7XHJcbiAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcclxuICAgICAgICAgICAgY29uc3QgeGhyID0gbmV3IFhNTEh0dHBSZXF1ZXN0KCk7XHJcbiAgICAgICAgICAgIHhoci5vcGVuKHJlcXVlc3QubWV0aG9kLCByZXF1ZXN0LnVybCwgdHJ1ZSk7XHJcbiAgICAgICAgICAgIHhoci53aXRoQ3JlZGVudGlhbHMgPSB0cnVlO1xyXG4gICAgICAgICAgICB4aHIuc2V0UmVxdWVzdEhlYWRlcihcIlgtUmVxdWVzdGVkLVdpdGhcIiwgXCJYTUxIdHRwUmVxdWVzdFwiKTtcclxuICAgICAgICAgICAgaWYgKHJlcXVlc3QuaGVhZGVycykge1xyXG4gICAgICAgICAgICAgICAgT2JqZWN0LmtleXMocmVxdWVzdC5oZWFkZXJzKVxyXG4gICAgICAgICAgICAgICAgICAgIC5mb3JFYWNoKChoZWFkZXIpID0+IHhoci5zZXRSZXF1ZXN0SGVhZGVyKGhlYWRlciwgcmVxdWVzdC5oZWFkZXJzW2hlYWRlcl0pKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAocmVxdWVzdC5yZXNwb25zZVR5cGUpIHtcclxuICAgICAgICAgICAgICAgIHhoci5yZXNwb25zZVR5cGUgPSByZXF1ZXN0LnJlc3BvbnNlVHlwZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAocmVxdWVzdC5hYm9ydFNpZ25hbCkge1xyXG4gICAgICAgICAgICAgICAgcmVxdWVzdC5hYm9ydFNpZ25hbC5vbmFib3J0ID0gKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIHhoci5hYm9ydCgpO1xyXG4gICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAocmVxdWVzdC50aW1lb3V0KSB7XHJcbiAgICAgICAgICAgICAgICB4aHIudGltZW91dCA9IHJlcXVlc3QudGltZW91dDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB4aHIub25sb2FkID0gKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgaWYgKHJlcXVlc3QuYWJvcnRTaWduYWwpIHtcclxuICAgICAgICAgICAgICAgICAgICByZXF1ZXN0LmFib3J0U2lnbmFsLm9uYWJvcnQgPSBudWxsO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgaWYgKHhoci5zdGF0dXMgPj0gMjAwICYmIHhoci5zdGF0dXMgPCAzMDApIHtcclxuICAgICAgICAgICAgICAgICAgICByZXNvbHZlKG5ldyBIdHRwUmVzcG9uc2UoeGhyLnN0YXR1cywgeGhyLnN0YXR1c1RleHQsIHhoci5yZXNwb25zZSB8fCB4aHIucmVzcG9uc2VUZXh0KSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICByZWplY3QobmV3IEh0dHBFcnJvcih4aHIuc3RhdHVzVGV4dCwgeGhyLnN0YXR1cykpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICB4aHIub25lcnJvciA9ICgpID0+IHtcclxuICAgICAgICAgICAgICAgIHRoaXMubG9nZ2VyLmxvZyhMb2dMZXZlbC5XYXJuaW5nLCBgRXJyb3IgZnJvbSBIVFRQIHJlcXVlc3QuICR7eGhyLnN0YXR1c306ICR7eGhyLnN0YXR1c1RleHR9YCk7XHJcbiAgICAgICAgICAgICAgICByZWplY3QobmV3IEh0dHBFcnJvcih4aHIuc3RhdHVzVGV4dCwgeGhyLnN0YXR1cykpO1xyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICB4aHIub250aW1lb3V0ID0gKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5sb2dnZXIubG9nKExvZ0xldmVsLldhcm5pbmcsIGBUaW1lb3V0IGZyb20gSFRUUCByZXF1ZXN0LmApO1xyXG4gICAgICAgICAgICAgICAgcmVqZWN0KG5ldyBUaW1lb3V0RXJyb3IoKSk7XHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIHhoci5zZW5kKHJlcXVlc3QuY29udGVudCB8fCBcIlwiKTtcclxuICAgICAgICB9KTtcclxuICAgIH1cclxufVxyXG4vLyMgc291cmNlTWFwcGluZ1VSTD1IdHRwQ2xpZW50LmpzLm1hcCJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///7\n')},function(module,__webpack_exports__,__webpack_require__){"use strict";eval('\n// EXTERNAL MODULE: ./node_modules/@aspnet/signalr/dist/esm/HttpConnection.js\nvar HttpConnection = __webpack_require__(6);\n\n// EXTERNAL MODULE: ./node_modules/@aspnet/signalr/dist/esm/ILogger.js\nvar ILogger = __webpack_require__(0);\n\n// EXTERNAL MODULE: ./node_modules/@aspnet/signalr/dist/esm/Loggers.js\nvar Loggers = __webpack_require__(4);\n\n// CONCATENATED MODULE: ./node_modules/@aspnet/signalr/dist/esm/TextMessageFormat.js\n// Copyright (c) .NET Foundation. All rights reserved.\r\n// Licensed under the Apache License, Version 2.0. See License.txt in the project root for license information.\r\nclass TextMessageFormat {\r\n    static write(output) {\r\n        return `${output}${TextMessageFormat.RecordSeparator}`;\r\n    }\r\n    static parse(input) {\r\n        if (input[input.length - 1] !== TextMessageFormat.RecordSeparator) {\r\n            throw new Error("Message is incomplete.");\r\n        }\r\n        const messages = input.split(TextMessageFormat.RecordSeparator);\r\n        messages.pop();\r\n        return messages;\r\n    }\r\n}\r\nTextMessageFormat.RecordSeparatorCode = 0x1e;\r\nTextMessageFormat.RecordSeparator = String.fromCharCode(TextMessageFormat.RecordSeparatorCode);\r\n//# sourceMappingURL=TextMessageFormat.js.map\n// EXTERNAL MODULE: ./node_modules/@aspnet/signalr/dist/esm/Transports.js + 1 modules\nvar Transports = __webpack_require__(1);\n\n// CONCATENATED MODULE: ./node_modules/@aspnet/signalr/dist/esm/JsonHubProtocol.js\n// Copyright (c) .NET Foundation. All rights reserved.\r\n// Licensed under the Apache License, Version 2.0. See License.txt in the project root for license information.\r\n\r\n\r\n\r\n\r\nconst JSON_HUB_PROTOCOL_NAME = "json";\r\nclass JsonHubProtocol_JsonHubProtocol {\r\n    constructor() {\r\n        this.name = JSON_HUB_PROTOCOL_NAME;\r\n        this.version = 1;\r\n        this.transferFormat = Transports["c" /* TransferFormat */].Text;\r\n    }\r\n    parseMessages(input, logger) {\r\n        if (!input) {\r\n            return [];\r\n        }\r\n        if (logger === null) {\r\n            logger = new Loggers["c" /* NullLogger */]();\r\n        }\r\n        // Parse the messages\r\n        const messages = TextMessageFormat.parse(input);\r\n        const hubMessages = [];\r\n        for (const message of messages) {\r\n            const parsedMessage = JSON.parse(message);\r\n            if (typeof parsedMessage.type !== "number") {\r\n                throw new Error("Invalid payload.");\r\n            }\r\n            switch (parsedMessage.type) {\r\n                case 1 /* Invocation */:\r\n                    this.isInvocationMessage(parsedMessage);\r\n                    break;\r\n                case 2 /* StreamItem */:\r\n                    this.isStreamItemMessage(parsedMessage);\r\n                    break;\r\n                case 3 /* Completion */:\r\n                    this.isCompletionMessage(parsedMessage);\r\n                    break;\r\n                case 6 /* Ping */:\r\n                    // Single value, no need to validate\r\n                    break;\r\n                case 7 /* Close */:\r\n                    // All optional values, no need to validate\r\n                    break;\r\n                default:\r\n                    // Future protocol changes can add message types, old clients can ignore them\r\n                    logger.log(ILogger["a" /* LogLevel */].Information, "Unknown message type \'" + parsedMessage.type + "\' ignored.");\r\n                    continue;\r\n            }\r\n            hubMessages.push(parsedMessage);\r\n        }\r\n        return hubMessages;\r\n    }\r\n    writeMessage(message) {\r\n        return TextMessageFormat.write(JSON.stringify(message));\r\n    }\r\n    isInvocationMessage(message) {\r\n        this.assertNotEmptyString(message.target, "Invalid payload for Invocation message.");\r\n        if (message.invocationId !== undefined) {\r\n            this.assertNotEmptyString(message.invocationId, "Invalid payload for Invocation message.");\r\n        }\r\n    }\r\n    isStreamItemMessage(message) {\r\n        this.assertNotEmptyString(message.invocationId, "Invalid payload for StreamItem message.");\r\n        if (message.item === undefined) {\r\n            throw new Error("Invalid payload for StreamItem message.");\r\n        }\r\n    }\r\n    isCompletionMessage(message) {\r\n        if (message.result && message.error) {\r\n            throw new Error("Invalid payload for Completion message.");\r\n        }\r\n        if (!message.result && message.error) {\r\n            this.assertNotEmptyString(message.error, "Invalid payload for Completion message.");\r\n        }\r\n        this.assertNotEmptyString(message.invocationId, "Invalid payload for Completion message.");\r\n    }\r\n    assertNotEmptyString(value, errorMessage) {\r\n        if (typeof value !== "string" || value === "") {\r\n            throw new Error(errorMessage);\r\n        }\r\n    }\r\n}\r\n//# sourceMappingURL=JsonHubProtocol.js.map\n// EXTERNAL MODULE: ./node_modules/@aspnet/signalr/dist/esm/Observable.js\nvar Observable = __webpack_require__(5);\n\n// CONCATENATED MODULE: ./node_modules/@aspnet/signalr/dist/esm/HubConnection.js\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "a", function() { return HubConnection_HubConnection; });\n/* concated harmony reexport */__webpack_require__.d(__webpack_exports__, "b", function() { return JsonHubProtocol_JsonHubProtocol; });\n// Copyright (c) .NET Foundation. All rights reserved.\r\n// Licensed under the Apache License, Version 2.0. See License.txt in the project root for license information.\r\nvar __awaiter = (undefined && undefined.__awaiter) || function (thisArg, _arguments, P, generator) {\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n};\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\nconst DEFAULT_TIMEOUT_IN_MS = 30 * 1000;\r\nclass HubConnection_HubConnection {\r\n    constructor(urlOrConnection, options = {}) {\r\n        options = options || {};\r\n        this.timeoutInMilliseconds = options.timeoutInMilliseconds || DEFAULT_TIMEOUT_IN_MS;\r\n        this.protocol = options.protocol || new JsonHubProtocol_JsonHubProtocol();\r\n        if (typeof urlOrConnection === "string") {\r\n            this.connection = new HttpConnection["a" /* HttpConnection */](urlOrConnection, options);\r\n        }\r\n        else {\r\n            this.connection = urlOrConnection;\r\n        }\r\n        this.logger = Loggers["b" /* LoggerFactory */].createLogger(options.logger);\r\n        this.connection.onreceive = (data) => this.processIncomingData(data);\r\n        this.connection.onclose = (error) => this.connectionClosed(error);\r\n        this.callbacks = {};\r\n        this.methods = {};\r\n        this.closedCallbacks = [];\r\n        this.id = 0;\r\n    }\r\n    processIncomingData(data) {\r\n        this.cleanupTimeout();\r\n        if (!this.receivedHandshakeResponse) {\r\n            data = this.processHandshakeResponse(data);\r\n            this.receivedHandshakeResponse = true;\r\n        }\r\n        // Data may have all been read when processing handshake response\r\n        if (data) {\r\n            // Parse the messages\r\n            const messages = this.protocol.parseMessages(data, this.logger);\r\n            for (const message of messages) {\r\n                switch (message.type) {\r\n                    case 1 /* Invocation */:\r\n                        this.invokeClientMethod(message);\r\n                        break;\r\n                    case 2 /* StreamItem */:\r\n                    case 3 /* Completion */:\r\n                        const callback = this.callbacks[message.invocationId];\r\n                        if (callback != null) {\r\n                            if (message.type === 3 /* Completion */) {\r\n                                delete this.callbacks[message.invocationId];\r\n                            }\r\n                            callback(message);\r\n                        }\r\n                        break;\r\n                    case 6 /* Ping */:\r\n                        // Don\'t care about pings\r\n                        break;\r\n                    case 7 /* Close */:\r\n                        this.logger.log(ILogger["a" /* LogLevel */].Information, "Close message received from server.");\r\n                        this.connection.stop(message.error ? new Error("Server returned an error on close: " + message.error) : null);\r\n                        break;\r\n                    default:\r\n                        this.logger.log(ILogger["a" /* LogLevel */].Warning, "Invalid message type: " + message.type);\r\n                        break;\r\n                }\r\n            }\r\n        }\r\n        this.configureTimeout();\r\n    }\r\n    processHandshakeResponse(data) {\r\n        let responseMessage;\r\n        let messageData;\r\n        let remainingData;\r\n        try {\r\n            if (data instanceof ArrayBuffer) {\r\n                // Format is binary but still need to read JSON text from handshake response\r\n                const binaryData = new Uint8Array(data);\r\n                const separatorIndex = binaryData.indexOf(TextMessageFormat.RecordSeparatorCode);\r\n                if (separatorIndex === -1) {\r\n                    throw new Error("Message is incomplete.");\r\n                }\r\n                // content before separator is handshake response\r\n                // optional content after is additional messages\r\n                const responseLength = separatorIndex + 1;\r\n                messageData = String.fromCharCode.apply(null, binaryData.slice(0, responseLength));\r\n                remainingData = (binaryData.byteLength > responseLength) ? binaryData.slice(responseLength).buffer : null;\r\n            }\r\n            else {\r\n                const textData = data;\r\n                const separatorIndex = textData.indexOf(TextMessageFormat.RecordSeparator);\r\n                if (separatorIndex === -1) {\r\n                    throw new Error("Message is incomplete.");\r\n                }\r\n                // content before separator is handshake response\r\n                // optional content after is additional messages\r\n                const responseLength = separatorIndex + 1;\r\n                messageData = textData.substring(0, responseLength);\r\n                remainingData = (textData.length > responseLength) ? textData.substring(responseLength) : null;\r\n            }\r\n            // At this point we should have just the single handshake message\r\n            const messages = TextMessageFormat.parse(messageData);\r\n            responseMessage = JSON.parse(messages[0]);\r\n        }\r\n        catch (e) {\r\n            const message = "Error parsing handshake response: " + e;\r\n            this.logger.log(ILogger["a" /* LogLevel */].Error, message);\r\n            const error = new Error(message);\r\n            this.connection.stop(error);\r\n            throw error;\r\n        }\r\n        if (responseMessage.error) {\r\n            const message = "Server returned handshake error: " + responseMessage.error;\r\n            this.logger.log(ILogger["a" /* LogLevel */].Error, message);\r\n            this.connection.stop(new Error(message));\r\n        }\r\n        else {\r\n            this.logger.log(ILogger["a" /* LogLevel */].Trace, "Server handshake complete.");\r\n        }\r\n        // multiple messages could have arrived with handshake\r\n        // return additional data to be parsed as usual, or null if all parsed\r\n        return remainingData;\r\n    }\r\n    configureTimeout() {\r\n        if (!this.connection.features || !this.connection.features.inherentKeepAlive) {\r\n            // Set the timeout timer\r\n            this.timeoutHandle = setTimeout(() => this.serverTimeout(), this.timeoutInMilliseconds);\r\n        }\r\n    }\r\n    serverTimeout() {\r\n        // The server hasn\'t talked to us in a while. It doesn\'t like us anymore ... :(\r\n        // Terminate the connection\r\n        this.connection.stop(new Error("Server timeout elapsed without receiving a message from the server."));\r\n    }\r\n    invokeClientMethod(invocationMessage) {\r\n        const methods = this.methods[invocationMessage.target.toLowerCase()];\r\n        if (methods) {\r\n            methods.forEach((m) => m.apply(this, invocationMessage.arguments));\r\n            if (invocationMessage.invocationId) {\r\n                // This is not supported in v1. So we return an error to avoid blocking the server waiting for the response.\r\n                const message = "Server requested a response, which is not supported in this version of the client.";\r\n                this.logger.log(ILogger["a" /* LogLevel */].Error, message);\r\n                this.connection.stop(new Error(message));\r\n            }\r\n        }\r\n        else {\r\n            this.logger.log(ILogger["a" /* LogLevel */].Warning, `No client method with the name \'${invocationMessage.target}\' found.`);\r\n        }\r\n    }\r\n    connectionClosed(error) {\r\n        const callbacks = this.callbacks;\r\n        this.callbacks = {};\r\n        Object.keys(callbacks)\r\n            .forEach((key) => {\r\n            const callback = callbacks[key];\r\n            callback(undefined, error ? error : new Error("Invocation canceled due to connection being closed."));\r\n        });\r\n        this.cleanupTimeout();\r\n        this.closedCallbacks.forEach((c) => c.apply(this, [error]));\r\n    }\r\n    start() {\r\n        return __awaiter(this, void 0, void 0, function* () {\r\n            this.logger.log(ILogger["a" /* LogLevel */].Trace, "Starting HubConnection.");\r\n            this.receivedHandshakeResponse = false;\r\n            yield this.connection.start(this.protocol.transferFormat);\r\n            this.logger.log(ILogger["a" /* LogLevel */].Trace, "Sending handshake request.");\r\n            // Handshake request is always JSON\r\n            yield this.connection.send(TextMessageFormat.write(JSON.stringify({ protocol: this.protocol.name, version: this.protocol.version })));\r\n            this.logger.log(ILogger["a" /* LogLevel */].Information, `Using HubProtocol \'${this.protocol.name}\'.`);\r\n            // defensively cleanup timeout in case we receive a message from the server before we finish start\r\n            this.cleanupTimeout();\r\n            this.configureTimeout();\r\n        });\r\n    }\r\n    stop() {\r\n        this.logger.log(ILogger["a" /* LogLevel */].Trace, "Stopping HubConnection.");\r\n        this.cleanupTimeout();\r\n        return this.connection.stop();\r\n    }\r\n    stream(methodName, ...args) {\r\n        const invocationDescriptor = this.createStreamInvocation(methodName, args);\r\n        const subject = new Observable["a" /* Subject */](() => {\r\n            const cancelInvocation = this.createCancelInvocation(invocationDescriptor.invocationId);\r\n            const cancelMessage = this.protocol.writeMessage(cancelInvocation);\r\n            delete this.callbacks[invocationDescriptor.invocationId];\r\n            return this.connection.send(cancelMessage);\r\n        });\r\n        this.callbacks[invocationDescriptor.invocationId] = (invocationEvent, error) => {\r\n            if (error) {\r\n                subject.error(error);\r\n                return;\r\n            }\r\n            if (invocationEvent.type === 3 /* Completion */) {\r\n                if (invocationEvent.error) {\r\n                    subject.error(new Error(invocationEvent.error));\r\n                }\r\n                else {\r\n                    subject.complete();\r\n                }\r\n            }\r\n            else {\r\n                subject.next((invocationEvent.item));\r\n            }\r\n        };\r\n        const message = this.protocol.writeMessage(invocationDescriptor);\r\n        this.connection.send(message)\r\n            .catch((e) => {\r\n            subject.error(e);\r\n            delete this.callbacks[invocationDescriptor.invocationId];\r\n        });\r\n        return subject;\r\n    }\r\n    send(methodName, ...args) {\r\n        const invocationDescriptor = this.createInvocation(methodName, args, true);\r\n        const message = this.protocol.writeMessage(invocationDescriptor);\r\n        return this.connection.send(message);\r\n    }\r\n    invoke(methodName, ...args) {\r\n        const invocationDescriptor = this.createInvocation(methodName, args, false);\r\n        const p = new Promise((resolve, reject) => {\r\n            this.callbacks[invocationDescriptor.invocationId] = (invocationEvent, error) => {\r\n                if (error) {\r\n                    reject(error);\r\n                    return;\r\n                }\r\n                if (invocationEvent.type === 3 /* Completion */) {\r\n                    const completionMessage = invocationEvent;\r\n                    if (completionMessage.error) {\r\n                        reject(new Error(completionMessage.error));\r\n                    }\r\n                    else {\r\n                        resolve(completionMessage.result);\r\n                    }\r\n                }\r\n                else {\r\n                    reject(new Error(`Unexpected message type: ${invocationEvent.type}`));\r\n                }\r\n            };\r\n            const message = this.protocol.writeMessage(invocationDescriptor);\r\n            this.connection.send(message)\r\n                .catch((e) => {\r\n                reject(e);\r\n                delete this.callbacks[invocationDescriptor.invocationId];\r\n            });\r\n        });\r\n        return p;\r\n    }\r\n    on(methodName, newMethod) {\r\n        if (!methodName || !newMethod) {\r\n            return;\r\n        }\r\n        methodName = methodName.toLowerCase();\r\n        if (!this.methods[methodName]) {\r\n            this.methods[methodName] = [];\r\n        }\r\n        // Preventing adding the same handler multiple times.\r\n        if (this.methods[methodName].indexOf(newMethod) !== -1) {\r\n            return;\r\n        }\r\n        this.methods[methodName].push(newMethod);\r\n    }\r\n    off(methodName, method) {\r\n        if (!methodName) {\r\n            return;\r\n        }\r\n        methodName = methodName.toLowerCase();\r\n        const handlers = this.methods[methodName];\r\n        if (!handlers) {\r\n            return;\r\n        }\r\n        if (method) {\r\n            const removeIdx = handlers.indexOf(method);\r\n            if (removeIdx !== -1) {\r\n                handlers.splice(removeIdx, 1);\r\n                if (handlers.length === 0) {\r\n                    delete this.methods[methodName];\r\n                }\r\n            }\r\n        }\r\n        else {\r\n            delete this.methods[methodName];\r\n        }\r\n    }\r\n    onclose(callback) {\r\n        if (callback) {\r\n            this.closedCallbacks.push(callback);\r\n        }\r\n    }\r\n    cleanupTimeout() {\r\n        if (this.timeoutHandle) {\r\n            clearTimeout(this.timeoutHandle);\r\n        }\r\n    }\r\n    createInvocation(methodName, args, nonblocking) {\r\n        if (nonblocking) {\r\n            return {\r\n                arguments: args,\r\n                target: methodName,\r\n                type: 1 /* Invocation */,\r\n            };\r\n        }\r\n        else {\r\n            const id = this.id;\r\n            this.id++;\r\n            return {\r\n                arguments: args,\r\n                invocationId: id.toString(),\r\n                target: methodName,\r\n                type: 1 /* Invocation */,\r\n            };\r\n        }\r\n    }\r\n    createStreamInvocation(methodName, args) {\r\n        const id = this.id;\r\n        this.id++;\r\n        return {\r\n            arguments: args,\r\n            invocationId: id.toString(),\r\n            target: methodName,\r\n            type: 4 /* StreamInvocation */,\r\n        };\r\n    }\r\n    createCancelInvocation(id) {\r\n        return {\r\n            invocationId: id,\r\n            type: 5 /* CancelInvocation */,\r\n        };\r\n    }\r\n}\r\n//# sourceMappingURL=HubConnection.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9ub2RlX21vZHVsZXMvQGFzcG5ldC9zaWduYWxyL2Rpc3QvZXNtL1RleHRNZXNzYWdlRm9ybWF0LmpzPzIxODMiLCJ3ZWJwYWNrOi8vLy4vbm9kZV9tb2R1bGVzL0Bhc3BuZXQvc2lnbmFsci9kaXN0L2VzbS9Kc29uSHViUHJvdG9jb2wuanM/ZGI4ZiIsIndlYnBhY2s6Ly8vLi9ub2RlX21vZHVsZXMvQGFzcG5ldC9zaWduYWxyL2Rpc3QvZXNtL0h1YkNvbm5lY3Rpb24uanM/NmNmOSJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7OztBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esa0JBQWtCLE9BQU8sRUFBRSxrQ0FBa0M7QUFDN0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsNkM7Ozs7O0FDakJBO0FBQ0E7QUFDbUI7QUFDRTtBQUNPO0FBQ0g7QUFDekI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDJDOzs7Ozs7QUNuRkE7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLG1DQUFtQyxNQUFNLDZCQUE2QixFQUFFLFlBQVksV0FBVyxFQUFFO0FBQ2pHLGtDQUFrQyxNQUFNLGlDQUFpQyxFQUFFLFlBQVksV0FBVyxFQUFFO0FBQ3BHLCtCQUErQixpRUFBaUUsdUJBQXVCLEVBQUUsNEJBQTRCO0FBQ3JKO0FBQ0EsS0FBSztBQUNMO0FBQ3lCO0FBQ047QUFDTztBQUNGO0FBQ047QUFDVTtBQUNwQjtBQUNSO0FBQ0E7QUFDQSw2Q0FBNkM7QUFDN0M7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxvR0FBaUYseUJBQXlCO0FBQzFHO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLCtFQUErRSwrREFBK0Q7QUFDOUksMkZBQXdFLG1CQUFtQjtBQUMzRjtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpRUFBaUUscUJBQXFCO0FBQ3RGO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSIsImZpbGUiOiI4LmpzIiwic291cmNlc0NvbnRlbnQiOlsiLy8gQ29weXJpZ2h0IChjKSAuTkVUIEZvdW5kYXRpb24uIEFsbCByaWdodHMgcmVzZXJ2ZWQuXHJcbi8vIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAuIFNlZSBMaWNlbnNlLnR4dCBpbiB0aGUgcHJvamVjdCByb290IGZvciBsaWNlbnNlIGluZm9ybWF0aW9uLlxyXG5leHBvcnQgY2xhc3MgVGV4dE1lc3NhZ2VGb3JtYXQge1xyXG4gICAgc3RhdGljIHdyaXRlKG91dHB1dCkge1xyXG4gICAgICAgIHJldHVybiBgJHtvdXRwdXR9JHtUZXh0TWVzc2FnZUZvcm1hdC5SZWNvcmRTZXBhcmF0b3J9YDtcclxuICAgIH1cclxuICAgIHN0YXRpYyBwYXJzZShpbnB1dCkge1xyXG4gICAgICAgIGlmIChpbnB1dFtpbnB1dC5sZW5ndGggLSAxXSAhPT0gVGV4dE1lc3NhZ2VGb3JtYXQuUmVjb3JkU2VwYXJhdG9yKSB7XHJcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIk1lc3NhZ2UgaXMgaW5jb21wbGV0ZS5cIik7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGNvbnN0IG1lc3NhZ2VzID0gaW5wdXQuc3BsaXQoVGV4dE1lc3NhZ2VGb3JtYXQuUmVjb3JkU2VwYXJhdG9yKTtcclxuICAgICAgICBtZXNzYWdlcy5wb3AoKTtcclxuICAgICAgICByZXR1cm4gbWVzc2FnZXM7XHJcbiAgICB9XHJcbn1cclxuVGV4dE1lc3NhZ2VGb3JtYXQuUmVjb3JkU2VwYXJhdG9yQ29kZSA9IDB4MWU7XHJcblRleHRNZXNzYWdlRm9ybWF0LlJlY29yZFNlcGFyYXRvciA9IFN0cmluZy5mcm9tQ2hhckNvZGUoVGV4dE1lc3NhZ2VGb3JtYXQuUmVjb3JkU2VwYXJhdG9yQ29kZSk7XHJcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPVRleHRNZXNzYWdlRm9ybWF0LmpzLm1hcCIsIi8vIENvcHlyaWdodCAoYykgLk5FVCBGb3VuZGF0aW9uLiBBbGwgcmlnaHRzIHJlc2VydmVkLlxyXG4vLyBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wLiBTZWUgTGljZW5zZS50eHQgaW4gdGhlIHByb2plY3Qgcm9vdCBmb3IgbGljZW5zZSBpbmZvcm1hdGlvbi5cclxuaW1wb3J0IHsgTG9nTGV2ZWwgfSBmcm9tIFwiLi9JTG9nZ2VyXCI7XHJcbmltcG9ydCB7IE51bGxMb2dnZXIgfSBmcm9tIFwiLi9Mb2dnZXJzXCI7XHJcbmltcG9ydCB7IFRleHRNZXNzYWdlRm9ybWF0IH0gZnJvbSBcIi4vVGV4dE1lc3NhZ2VGb3JtYXRcIjtcclxuaW1wb3J0IHsgVHJhbnNmZXJGb3JtYXQgfSBmcm9tIFwiLi9UcmFuc3BvcnRzXCI7XHJcbmV4cG9ydCBjb25zdCBKU09OX0hVQl9QUk9UT0NPTF9OQU1FID0gXCJqc29uXCI7XHJcbmV4cG9ydCBjbGFzcyBKc29uSHViUHJvdG9jb2wge1xyXG4gICAgY29uc3RydWN0b3IoKSB7XHJcbiAgICAgICAgdGhpcy5uYW1lID0gSlNPTl9IVUJfUFJPVE9DT0xfTkFNRTtcclxuICAgICAgICB0aGlzLnZlcnNpb24gPSAxO1xyXG4gICAgICAgIHRoaXMudHJhbnNmZXJGb3JtYXQgPSBUcmFuc2ZlckZvcm1hdC5UZXh0O1xyXG4gICAgfVxyXG4gICAgcGFyc2VNZXNzYWdlcyhpbnB1dCwgbG9nZ2VyKSB7XHJcbiAgICAgICAgaWYgKCFpbnB1dCkge1xyXG4gICAgICAgICAgICByZXR1cm4gW107XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChsb2dnZXIgPT09IG51bGwpIHtcclxuICAgICAgICAgICAgbG9nZ2VyID0gbmV3IE51bGxMb2dnZXIoKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgLy8gUGFyc2UgdGhlIG1lc3NhZ2VzXHJcbiAgICAgICAgY29uc3QgbWVzc2FnZXMgPSBUZXh0TWVzc2FnZUZvcm1hdC5wYXJzZShpbnB1dCk7XHJcbiAgICAgICAgY29uc3QgaHViTWVzc2FnZXMgPSBbXTtcclxuICAgICAgICBmb3IgKGNvbnN0IG1lc3NhZ2Ugb2YgbWVzc2FnZXMpIHtcclxuICAgICAgICAgICAgY29uc3QgcGFyc2VkTWVzc2FnZSA9IEpTT04ucGFyc2UobWVzc2FnZSk7XHJcbiAgICAgICAgICAgIGlmICh0eXBlb2YgcGFyc2VkTWVzc2FnZS50eXBlICE9PSBcIm51bWJlclwiKSB7XHJcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJJbnZhbGlkIHBheWxvYWQuXCIpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHN3aXRjaCAocGFyc2VkTWVzc2FnZS50eXBlKSB7XHJcbiAgICAgICAgICAgICAgICBjYXNlIDEgLyogSW52b2NhdGlvbiAqLzpcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmlzSW52b2NhdGlvbk1lc3NhZ2UocGFyc2VkTWVzc2FnZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICBjYXNlIDIgLyogU3RyZWFtSXRlbSAqLzpcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmlzU3RyZWFtSXRlbU1lc3NhZ2UocGFyc2VkTWVzc2FnZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICBjYXNlIDMgLyogQ29tcGxldGlvbiAqLzpcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmlzQ29tcGxldGlvbk1lc3NhZ2UocGFyc2VkTWVzc2FnZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICBjYXNlIDYgLyogUGluZyAqLzpcclxuICAgICAgICAgICAgICAgICAgICAvLyBTaW5nbGUgdmFsdWUsIG5vIG5lZWQgdG8gdmFsaWRhdGVcclxuICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgIGNhc2UgNyAvKiBDbG9zZSAqLzpcclxuICAgICAgICAgICAgICAgICAgICAvLyBBbGwgb3B0aW9uYWwgdmFsdWVzLCBubyBuZWVkIHRvIHZhbGlkYXRlXHJcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICBkZWZhdWx0OlxyXG4gICAgICAgICAgICAgICAgICAgIC8vIEZ1dHVyZSBwcm90b2NvbCBjaGFuZ2VzIGNhbiBhZGQgbWVzc2FnZSB0eXBlcywgb2xkIGNsaWVudHMgY2FuIGlnbm9yZSB0aGVtXHJcbiAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLmxvZyhMb2dMZXZlbC5JbmZvcm1hdGlvbiwgXCJVbmtub3duIG1lc3NhZ2UgdHlwZSAnXCIgKyBwYXJzZWRNZXNzYWdlLnR5cGUgKyBcIicgaWdub3JlZC5cIik7XHJcbiAgICAgICAgICAgICAgICAgICAgY29udGludWU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaHViTWVzc2FnZXMucHVzaChwYXJzZWRNZXNzYWdlKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIGh1Yk1lc3NhZ2VzO1xyXG4gICAgfVxyXG4gICAgd3JpdGVNZXNzYWdlKG1lc3NhZ2UpIHtcclxuICAgICAgICByZXR1cm4gVGV4dE1lc3NhZ2VGb3JtYXQud3JpdGUoSlNPTi5zdHJpbmdpZnkobWVzc2FnZSkpO1xyXG4gICAgfVxyXG4gICAgaXNJbnZvY2F0aW9uTWVzc2FnZShtZXNzYWdlKSB7XHJcbiAgICAgICAgdGhpcy5hc3NlcnROb3RFbXB0eVN0cmluZyhtZXNzYWdlLnRhcmdldCwgXCJJbnZhbGlkIHBheWxvYWQgZm9yIEludm9jYXRpb24gbWVzc2FnZS5cIik7XHJcbiAgICAgICAgaWYgKG1lc3NhZ2UuaW52b2NhdGlvbklkICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgdGhpcy5hc3NlcnROb3RFbXB0eVN0cmluZyhtZXNzYWdlLmludm9jYXRpb25JZCwgXCJJbnZhbGlkIHBheWxvYWQgZm9yIEludm9jYXRpb24gbWVzc2FnZS5cIik7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgaXNTdHJlYW1JdGVtTWVzc2FnZShtZXNzYWdlKSB7XHJcbiAgICAgICAgdGhpcy5hc3NlcnROb3RFbXB0eVN0cmluZyhtZXNzYWdlLmludm9jYXRpb25JZCwgXCJJbnZhbGlkIHBheWxvYWQgZm9yIFN0cmVhbUl0ZW0gbWVzc2FnZS5cIik7XHJcbiAgICAgICAgaWYgKG1lc3NhZ2UuaXRlbSA9PT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIkludmFsaWQgcGF5bG9hZCBmb3IgU3RyZWFtSXRlbSBtZXNzYWdlLlwiKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICBpc0NvbXBsZXRpb25NZXNzYWdlKG1lc3NhZ2UpIHtcclxuICAgICAgICBpZiAobWVzc2FnZS5yZXN1bHQgJiYgbWVzc2FnZS5lcnJvcikge1xyXG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJJbnZhbGlkIHBheWxvYWQgZm9yIENvbXBsZXRpb24gbWVzc2FnZS5cIik7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICghbWVzc2FnZS5yZXN1bHQgJiYgbWVzc2FnZS5lcnJvcikge1xyXG4gICAgICAgICAgICB0aGlzLmFzc2VydE5vdEVtcHR5U3RyaW5nKG1lc3NhZ2UuZXJyb3IsIFwiSW52YWxpZCBwYXlsb2FkIGZvciBDb21wbGV0aW9uIG1lc3NhZ2UuXCIpO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLmFzc2VydE5vdEVtcHR5U3RyaW5nKG1lc3NhZ2UuaW52b2NhdGlvbklkLCBcIkludmFsaWQgcGF5bG9hZCBmb3IgQ29tcGxldGlvbiBtZXNzYWdlLlwiKTtcclxuICAgIH1cclxuICAgIGFzc2VydE5vdEVtcHR5U3RyaW5nKHZhbHVlLCBlcnJvck1lc3NhZ2UpIHtcclxuICAgICAgICBpZiAodHlwZW9mIHZhbHVlICE9PSBcInN0cmluZ1wiIHx8IHZhbHVlID09PSBcIlwiKSB7XHJcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihlcnJvck1lc3NhZ2UpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxufVxyXG4vLyMgc291cmNlTWFwcGluZ1VSTD1Kc29uSHViUHJvdG9jb2wuanMubWFwIiwiLy8gQ29weXJpZ2h0IChjKSAuTkVUIEZvdW5kYXRpb24uIEFsbCByaWdodHMgcmVzZXJ2ZWQuXHJcbi8vIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAuIFNlZSBMaWNlbnNlLnR4dCBpbiB0aGUgcHJvamVjdCByb290IGZvciBsaWNlbnNlIGluZm9ybWF0aW9uLlxyXG52YXIgX19hd2FpdGVyID0gKHRoaXMgJiYgdGhpcy5fX2F3YWl0ZXIpIHx8IGZ1bmN0aW9uICh0aGlzQXJnLCBfYXJndW1lbnRzLCBQLCBnZW5lcmF0b3IpIHtcclxuICAgIHJldHVybiBuZXcgKFAgfHwgKFAgPSBQcm9taXNlKSkoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge1xyXG4gICAgICAgIGZ1bmN0aW9uIGZ1bGZpbGxlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvci5uZXh0KHZhbHVlKSk7IH0gY2F0Y2ggKGUpIHsgcmVqZWN0KGUpOyB9IH1cclxuICAgICAgICBmdW5jdGlvbiByZWplY3RlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvcltcInRocm93XCJdKHZhbHVlKSk7IH0gY2F0Y2ggKGUpIHsgcmVqZWN0KGUpOyB9IH1cclxuICAgICAgICBmdW5jdGlvbiBzdGVwKHJlc3VsdCkgeyByZXN1bHQuZG9uZSA/IHJlc29sdmUocmVzdWx0LnZhbHVlKSA6IG5ldyBQKGZ1bmN0aW9uIChyZXNvbHZlKSB7IHJlc29sdmUocmVzdWx0LnZhbHVlKTsgfSkudGhlbihmdWxmaWxsZWQsIHJlamVjdGVkKTsgfVxyXG4gICAgICAgIHN0ZXAoKGdlbmVyYXRvciA9IGdlbmVyYXRvci5hcHBseSh0aGlzQXJnLCBfYXJndW1lbnRzIHx8IFtdKSkubmV4dCgpKTtcclxuICAgIH0pO1xyXG59O1xyXG5pbXBvcnQgeyBIdHRwQ29ubmVjdGlvbiB9IGZyb20gXCIuL0h0dHBDb25uZWN0aW9uXCI7XHJcbmltcG9ydCB7IExvZ0xldmVsIH0gZnJvbSBcIi4vSUxvZ2dlclwiO1xyXG5pbXBvcnQgeyBKc29uSHViUHJvdG9jb2wgfSBmcm9tIFwiLi9Kc29uSHViUHJvdG9jb2xcIjtcclxuaW1wb3J0IHsgTG9nZ2VyRmFjdG9yeSB9IGZyb20gXCIuL0xvZ2dlcnNcIjtcclxuaW1wb3J0IHsgU3ViamVjdCB9IGZyb20gXCIuL09ic2VydmFibGVcIjtcclxuaW1wb3J0IHsgVGV4dE1lc3NhZ2VGb3JtYXQgfSBmcm9tIFwiLi9UZXh0TWVzc2FnZUZvcm1hdFwiO1xyXG5leHBvcnQgeyBKc29uSHViUHJvdG9jb2wgfTtcclxuY29uc3QgREVGQVVMVF9USU1FT1VUX0lOX01TID0gMzAgKiAxMDAwO1xyXG5leHBvcnQgY2xhc3MgSHViQ29ubmVjdGlvbiB7XHJcbiAgICBjb25zdHJ1Y3Rvcih1cmxPckNvbm5lY3Rpb24sIG9wdGlvbnMgPSB7fSkge1xyXG4gICAgICAgIG9wdGlvbnMgPSBvcHRpb25zIHx8IHt9O1xyXG4gICAgICAgIHRoaXMudGltZW91dEluTWlsbGlzZWNvbmRzID0gb3B0aW9ucy50aW1lb3V0SW5NaWxsaXNlY29uZHMgfHwgREVGQVVMVF9USU1FT1VUX0lOX01TO1xyXG4gICAgICAgIHRoaXMucHJvdG9jb2wgPSBvcHRpb25zLnByb3RvY29sIHx8IG5ldyBKc29uSHViUHJvdG9jb2woKTtcclxuICAgICAgICBpZiAodHlwZW9mIHVybE9yQ29ubmVjdGlvbiA9PT0gXCJzdHJpbmdcIikge1xyXG4gICAgICAgICAgICB0aGlzLmNvbm5lY3Rpb24gPSBuZXcgSHR0cENvbm5lY3Rpb24odXJsT3JDb25uZWN0aW9uLCBvcHRpb25zKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIHRoaXMuY29ubmVjdGlvbiA9IHVybE9yQ29ubmVjdGlvbjtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5sb2dnZXIgPSBMb2dnZXJGYWN0b3J5LmNyZWF0ZUxvZ2dlcihvcHRpb25zLmxvZ2dlcik7XHJcbiAgICAgICAgdGhpcy5jb25uZWN0aW9uLm9ucmVjZWl2ZSA9IChkYXRhKSA9PiB0aGlzLnByb2Nlc3NJbmNvbWluZ0RhdGEoZGF0YSk7XHJcbiAgICAgICAgdGhpcy5jb25uZWN0aW9uLm9uY2xvc2UgPSAoZXJyb3IpID0+IHRoaXMuY29ubmVjdGlvbkNsb3NlZChlcnJvcik7XHJcbiAgICAgICAgdGhpcy5jYWxsYmFja3MgPSB7fTtcclxuICAgICAgICB0aGlzLm1ldGhvZHMgPSB7fTtcclxuICAgICAgICB0aGlzLmNsb3NlZENhbGxiYWNrcyA9IFtdO1xyXG4gICAgICAgIHRoaXMuaWQgPSAwO1xyXG4gICAgfVxyXG4gICAgcHJvY2Vzc0luY29taW5nRGF0YShkYXRhKSB7XHJcbiAgICAgICAgdGhpcy5jbGVhbnVwVGltZW91dCgpO1xyXG4gICAgICAgIGlmICghdGhpcy5yZWNlaXZlZEhhbmRzaGFrZVJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgIGRhdGEgPSB0aGlzLnByb2Nlc3NIYW5kc2hha2VSZXNwb25zZShkYXRhKTtcclxuICAgICAgICAgICAgdGhpcy5yZWNlaXZlZEhhbmRzaGFrZVJlc3BvbnNlID0gdHJ1ZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgLy8gRGF0YSBtYXkgaGF2ZSBhbGwgYmVlbiByZWFkIHdoZW4gcHJvY2Vzc2luZyBoYW5kc2hha2UgcmVzcG9uc2VcclxuICAgICAgICBpZiAoZGF0YSkge1xyXG4gICAgICAgICAgICAvLyBQYXJzZSB0aGUgbWVzc2FnZXNcclxuICAgICAgICAgICAgY29uc3QgbWVzc2FnZXMgPSB0aGlzLnByb3RvY29sLnBhcnNlTWVzc2FnZXMoZGF0YSwgdGhpcy5sb2dnZXIpO1xyXG4gICAgICAgICAgICBmb3IgKGNvbnN0IG1lc3NhZ2Ugb2YgbWVzc2FnZXMpIHtcclxuICAgICAgICAgICAgICAgIHN3aXRjaCAobWVzc2FnZS50eXBlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAxIC8qIEludm9jYXRpb24gKi86XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuaW52b2tlQ2xpZW50TWV0aG9kKG1lc3NhZ2UpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICBjYXNlIDIgLyogU3RyZWFtSXRlbSAqLzpcclxuICAgICAgICAgICAgICAgICAgICBjYXNlIDMgLyogQ29tcGxldGlvbiAqLzpcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgY2FsbGJhY2sgPSB0aGlzLmNhbGxiYWNrc1ttZXNzYWdlLmludm9jYXRpb25JZF07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjYWxsYmFjayAhPSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAobWVzc2FnZS50eXBlID09PSAzIC8qIENvbXBsZXRpb24gKi8pIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZWxldGUgdGhpcy5jYWxsYmFja3NbbWVzc2FnZS5pbnZvY2F0aW9uSWRdO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2sobWVzc2FnZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgY2FzZSA2IC8qIFBpbmcgKi86XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIERvbid0IGNhcmUgYWJvdXQgcGluZ3NcclxuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgY2FzZSA3IC8qIENsb3NlICovOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmxvZ2dlci5sb2coTG9nTGV2ZWwuSW5mb3JtYXRpb24sIFwiQ2xvc2UgbWVzc2FnZSByZWNlaXZlZCBmcm9tIHNlcnZlci5cIik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuY29ubmVjdGlvbi5zdG9wKG1lc3NhZ2UuZXJyb3IgPyBuZXcgRXJyb3IoXCJTZXJ2ZXIgcmV0dXJuZWQgYW4gZXJyb3Igb24gY2xvc2U6IFwiICsgbWVzc2FnZS5lcnJvcikgOiBudWxsKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDpcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5sb2dnZXIubG9nKExvZ0xldmVsLldhcm5pbmcsIFwiSW52YWxpZCBtZXNzYWdlIHR5cGU6IFwiICsgbWVzc2FnZS50eXBlKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5jb25maWd1cmVUaW1lb3V0KCk7XHJcbiAgICB9XHJcbiAgICBwcm9jZXNzSGFuZHNoYWtlUmVzcG9uc2UoZGF0YSkge1xyXG4gICAgICAgIGxldCByZXNwb25zZU1lc3NhZ2U7XHJcbiAgICAgICAgbGV0IG1lc3NhZ2VEYXRhO1xyXG4gICAgICAgIGxldCByZW1haW5pbmdEYXRhO1xyXG4gICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAgIGlmIChkYXRhIGluc3RhbmNlb2YgQXJyYXlCdWZmZXIpIHtcclxuICAgICAgICAgICAgICAgIC8vIEZvcm1hdCBpcyBiaW5hcnkgYnV0IHN0aWxsIG5lZWQgdG8gcmVhZCBKU09OIHRleHQgZnJvbSBoYW5kc2hha2UgcmVzcG9uc2VcclxuICAgICAgICAgICAgICAgIGNvbnN0IGJpbmFyeURhdGEgPSBuZXcgVWludDhBcnJheShkYXRhKTtcclxuICAgICAgICAgICAgICAgIGNvbnN0IHNlcGFyYXRvckluZGV4ID0gYmluYXJ5RGF0YS5pbmRleE9mKFRleHRNZXNzYWdlRm9ybWF0LlJlY29yZFNlcGFyYXRvckNvZGUpO1xyXG4gICAgICAgICAgICAgICAgaWYgKHNlcGFyYXRvckluZGV4ID09PSAtMSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIk1lc3NhZ2UgaXMgaW5jb21wbGV0ZS5cIik7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAvLyBjb250ZW50IGJlZm9yZSBzZXBhcmF0b3IgaXMgaGFuZHNoYWtlIHJlc3BvbnNlXHJcbiAgICAgICAgICAgICAgICAvLyBvcHRpb25hbCBjb250ZW50IGFmdGVyIGlzIGFkZGl0aW9uYWwgbWVzc2FnZXNcclxuICAgICAgICAgICAgICAgIGNvbnN0IHJlc3BvbnNlTGVuZ3RoID0gc2VwYXJhdG9ySW5kZXggKyAxO1xyXG4gICAgICAgICAgICAgICAgbWVzc2FnZURhdGEgPSBTdHJpbmcuZnJvbUNoYXJDb2RlLmFwcGx5KG51bGwsIGJpbmFyeURhdGEuc2xpY2UoMCwgcmVzcG9uc2VMZW5ndGgpKTtcclxuICAgICAgICAgICAgICAgIHJlbWFpbmluZ0RhdGEgPSAoYmluYXJ5RGF0YS5ieXRlTGVuZ3RoID4gcmVzcG9uc2VMZW5ndGgpID8gYmluYXJ5RGF0YS5zbGljZShyZXNwb25zZUxlbmd0aCkuYnVmZmVyIDogbnVsbDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IHRleHREYXRhID0gZGF0YTtcclxuICAgICAgICAgICAgICAgIGNvbnN0IHNlcGFyYXRvckluZGV4ID0gdGV4dERhdGEuaW5kZXhPZihUZXh0TWVzc2FnZUZvcm1hdC5SZWNvcmRTZXBhcmF0b3IpO1xyXG4gICAgICAgICAgICAgICAgaWYgKHNlcGFyYXRvckluZGV4ID09PSAtMSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIk1lc3NhZ2UgaXMgaW5jb21wbGV0ZS5cIik7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAvLyBjb250ZW50IGJlZm9yZSBzZXBhcmF0b3IgaXMgaGFuZHNoYWtlIHJlc3BvbnNlXHJcbiAgICAgICAgICAgICAgICAvLyBvcHRpb25hbCBjb250ZW50IGFmdGVyIGlzIGFkZGl0aW9uYWwgbWVzc2FnZXNcclxuICAgICAgICAgICAgICAgIGNvbnN0IHJlc3BvbnNlTGVuZ3RoID0gc2VwYXJhdG9ySW5kZXggKyAxO1xyXG4gICAgICAgICAgICAgICAgbWVzc2FnZURhdGEgPSB0ZXh0RGF0YS5zdWJzdHJpbmcoMCwgcmVzcG9uc2VMZW5ndGgpO1xyXG4gICAgICAgICAgICAgICAgcmVtYWluaW5nRGF0YSA9ICh0ZXh0RGF0YS5sZW5ndGggPiByZXNwb25zZUxlbmd0aCkgPyB0ZXh0RGF0YS5zdWJzdHJpbmcocmVzcG9uc2VMZW5ndGgpIDogbnVsbDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAvLyBBdCB0aGlzIHBvaW50IHdlIHNob3VsZCBoYXZlIGp1c3QgdGhlIHNpbmdsZSBoYW5kc2hha2UgbWVzc2FnZVxyXG4gICAgICAgICAgICBjb25zdCBtZXNzYWdlcyA9IFRleHRNZXNzYWdlRm9ybWF0LnBhcnNlKG1lc3NhZ2VEYXRhKTtcclxuICAgICAgICAgICAgcmVzcG9uc2VNZXNzYWdlID0gSlNPTi5wYXJzZShtZXNzYWdlc1swXSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGNhdGNoIChlKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IG1lc3NhZ2UgPSBcIkVycm9yIHBhcnNpbmcgaGFuZHNoYWtlIHJlc3BvbnNlOiBcIiArIGU7XHJcbiAgICAgICAgICAgIHRoaXMubG9nZ2VyLmxvZyhMb2dMZXZlbC5FcnJvciwgbWVzc2FnZSk7XHJcbiAgICAgICAgICAgIGNvbnN0IGVycm9yID0gbmV3IEVycm9yKG1lc3NhZ2UpO1xyXG4gICAgICAgICAgICB0aGlzLmNvbm5lY3Rpb24uc3RvcChlcnJvcik7XHJcbiAgICAgICAgICAgIHRocm93IGVycm9yO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAocmVzcG9uc2VNZXNzYWdlLmVycm9yKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IG1lc3NhZ2UgPSBcIlNlcnZlciByZXR1cm5lZCBoYW5kc2hha2UgZXJyb3I6IFwiICsgcmVzcG9uc2VNZXNzYWdlLmVycm9yO1xyXG4gICAgICAgICAgICB0aGlzLmxvZ2dlci5sb2coTG9nTGV2ZWwuRXJyb3IsIG1lc3NhZ2UpO1xyXG4gICAgICAgICAgICB0aGlzLmNvbm5lY3Rpb24uc3RvcChuZXcgRXJyb3IobWVzc2FnZSkpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgdGhpcy5sb2dnZXIubG9nKExvZ0xldmVsLlRyYWNlLCBcIlNlcnZlciBoYW5kc2hha2UgY29tcGxldGUuXCIpO1xyXG4gICAgICAgIH1cclxuICAgICAgICAvLyBtdWx0aXBsZSBtZXNzYWdlcyBjb3VsZCBoYXZlIGFycml2ZWQgd2l0aCBoYW5kc2hha2VcclxuICAgICAgICAvLyByZXR1cm4gYWRkaXRpb25hbCBkYXRhIHRvIGJlIHBhcnNlZCBhcyB1c3VhbCwgb3IgbnVsbCBpZiBhbGwgcGFyc2VkXHJcbiAgICAgICAgcmV0dXJuIHJlbWFpbmluZ0RhdGE7XHJcbiAgICB9XHJcbiAgICBjb25maWd1cmVUaW1lb3V0KCkge1xyXG4gICAgICAgIGlmICghdGhpcy5jb25uZWN0aW9uLmZlYXR1cmVzIHx8ICF0aGlzLmNvbm5lY3Rpb24uZmVhdHVyZXMuaW5oZXJlbnRLZWVwQWxpdmUpIHtcclxuICAgICAgICAgICAgLy8gU2V0IHRoZSB0aW1lb3V0IHRpbWVyXHJcbiAgICAgICAgICAgIHRoaXMudGltZW91dEhhbmRsZSA9IHNldFRpbWVvdXQoKCkgPT4gdGhpcy5zZXJ2ZXJUaW1lb3V0KCksIHRoaXMudGltZW91dEluTWlsbGlzZWNvbmRzKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICBzZXJ2ZXJUaW1lb3V0KCkge1xyXG4gICAgICAgIC8vIFRoZSBzZXJ2ZXIgaGFzbid0IHRhbGtlZCB0byB1cyBpbiBhIHdoaWxlLiBJdCBkb2Vzbid0IGxpa2UgdXMgYW55bW9yZSAuLi4gOihcclxuICAgICAgICAvLyBUZXJtaW5hdGUgdGhlIGNvbm5lY3Rpb25cclxuICAgICAgICB0aGlzLmNvbm5lY3Rpb24uc3RvcChuZXcgRXJyb3IoXCJTZXJ2ZXIgdGltZW91dCBlbGFwc2VkIHdpdGhvdXQgcmVjZWl2aW5nIGEgbWVzc2FnZSBmcm9tIHRoZSBzZXJ2ZXIuXCIpKTtcclxuICAgIH1cclxuICAgIGludm9rZUNsaWVudE1ldGhvZChpbnZvY2F0aW9uTWVzc2FnZSkge1xyXG4gICAgICAgIGNvbnN0IG1ldGhvZHMgPSB0aGlzLm1ldGhvZHNbaW52b2NhdGlvbk1lc3NhZ2UudGFyZ2V0LnRvTG93ZXJDYXNlKCldO1xyXG4gICAgICAgIGlmIChtZXRob2RzKSB7XHJcbiAgICAgICAgICAgIG1ldGhvZHMuZm9yRWFjaCgobSkgPT4gbS5hcHBseSh0aGlzLCBpbnZvY2F0aW9uTWVzc2FnZS5hcmd1bWVudHMpKTtcclxuICAgICAgICAgICAgaWYgKGludm9jYXRpb25NZXNzYWdlLmludm9jYXRpb25JZCkge1xyXG4gICAgICAgICAgICAgICAgLy8gVGhpcyBpcyBub3Qgc3VwcG9ydGVkIGluIHYxLiBTbyB3ZSByZXR1cm4gYW4gZXJyb3IgdG8gYXZvaWQgYmxvY2tpbmcgdGhlIHNlcnZlciB3YWl0aW5nIGZvciB0aGUgcmVzcG9uc2UuXHJcbiAgICAgICAgICAgICAgICBjb25zdCBtZXNzYWdlID0gXCJTZXJ2ZXIgcmVxdWVzdGVkIGEgcmVzcG9uc2UsIHdoaWNoIGlzIG5vdCBzdXBwb3J0ZWQgaW4gdGhpcyB2ZXJzaW9uIG9mIHRoZSBjbGllbnQuXCI7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmxvZ2dlci5sb2coTG9nTGV2ZWwuRXJyb3IsIG1lc3NhZ2UpO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5jb25uZWN0aW9uLnN0b3AobmV3IEVycm9yKG1lc3NhZ2UpKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgdGhpcy5sb2dnZXIubG9nKExvZ0xldmVsLldhcm5pbmcsIGBObyBjbGllbnQgbWV0aG9kIHdpdGggdGhlIG5hbWUgJyR7aW52b2NhdGlvbk1lc3NhZ2UudGFyZ2V0fScgZm91bmQuYCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgY29ubmVjdGlvbkNsb3NlZChlcnJvcikge1xyXG4gICAgICAgIGNvbnN0IGNhbGxiYWNrcyA9IHRoaXMuY2FsbGJhY2tzO1xyXG4gICAgICAgIHRoaXMuY2FsbGJhY2tzID0ge307XHJcbiAgICAgICAgT2JqZWN0LmtleXMoY2FsbGJhY2tzKVxyXG4gICAgICAgICAgICAuZm9yRWFjaCgoa2V5KSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IGNhbGxiYWNrID0gY2FsbGJhY2tzW2tleV07XHJcbiAgICAgICAgICAgIGNhbGxiYWNrKHVuZGVmaW5lZCwgZXJyb3IgPyBlcnJvciA6IG5ldyBFcnJvcihcIkludm9jYXRpb24gY2FuY2VsZWQgZHVlIHRvIGNvbm5lY3Rpb24gYmVpbmcgY2xvc2VkLlwiKSk7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgdGhpcy5jbGVhbnVwVGltZW91dCgpO1xyXG4gICAgICAgIHRoaXMuY2xvc2VkQ2FsbGJhY2tzLmZvckVhY2goKGMpID0+IGMuYXBwbHkodGhpcywgW2Vycm9yXSkpO1xyXG4gICAgfVxyXG4gICAgc3RhcnQoKSB7XHJcbiAgICAgICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcclxuICAgICAgICAgICAgdGhpcy5sb2dnZXIubG9nKExvZ0xldmVsLlRyYWNlLCBcIlN0YXJ0aW5nIEh1YkNvbm5lY3Rpb24uXCIpO1xyXG4gICAgICAgICAgICB0aGlzLnJlY2VpdmVkSGFuZHNoYWtlUmVzcG9uc2UgPSBmYWxzZTtcclxuICAgICAgICAgICAgeWllbGQgdGhpcy5jb25uZWN0aW9uLnN0YXJ0KHRoaXMucHJvdG9jb2wudHJhbnNmZXJGb3JtYXQpO1xyXG4gICAgICAgICAgICB0aGlzLmxvZ2dlci5sb2coTG9nTGV2ZWwuVHJhY2UsIFwiU2VuZGluZyBoYW5kc2hha2UgcmVxdWVzdC5cIik7XHJcbiAgICAgICAgICAgIC8vIEhhbmRzaGFrZSByZXF1ZXN0IGlzIGFsd2F5cyBKU09OXHJcbiAgICAgICAgICAgIHlpZWxkIHRoaXMuY29ubmVjdGlvbi5zZW5kKFRleHRNZXNzYWdlRm9ybWF0LndyaXRlKEpTT04uc3RyaW5naWZ5KHsgcHJvdG9jb2w6IHRoaXMucHJvdG9jb2wubmFtZSwgdmVyc2lvbjogdGhpcy5wcm90b2NvbC52ZXJzaW9uIH0pKSk7XHJcbiAgICAgICAgICAgIHRoaXMubG9nZ2VyLmxvZyhMb2dMZXZlbC5JbmZvcm1hdGlvbiwgYFVzaW5nIEh1YlByb3RvY29sICcke3RoaXMucHJvdG9jb2wubmFtZX0nLmApO1xyXG4gICAgICAgICAgICAvLyBkZWZlbnNpdmVseSBjbGVhbnVwIHRpbWVvdXQgaW4gY2FzZSB3ZSByZWNlaXZlIGEgbWVzc2FnZSBmcm9tIHRoZSBzZXJ2ZXIgYmVmb3JlIHdlIGZpbmlzaCBzdGFydFxyXG4gICAgICAgICAgICB0aGlzLmNsZWFudXBUaW1lb3V0KCk7XHJcbiAgICAgICAgICAgIHRoaXMuY29uZmlndXJlVGltZW91dCgpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG4gICAgc3RvcCgpIHtcclxuICAgICAgICB0aGlzLmxvZ2dlci5sb2coTG9nTGV2ZWwuVHJhY2UsIFwiU3RvcHBpbmcgSHViQ29ubmVjdGlvbi5cIik7XHJcbiAgICAgICAgdGhpcy5jbGVhbnVwVGltZW91dCgpO1xyXG4gICAgICAgIHJldHVybiB0aGlzLmNvbm5lY3Rpb24uc3RvcCgpO1xyXG4gICAgfVxyXG4gICAgc3RyZWFtKG1ldGhvZE5hbWUsIC4uLmFyZ3MpIHtcclxuICAgICAgICBjb25zdCBpbnZvY2F0aW9uRGVzY3JpcHRvciA9IHRoaXMuY3JlYXRlU3RyZWFtSW52b2NhdGlvbihtZXRob2ROYW1lLCBhcmdzKTtcclxuICAgICAgICBjb25zdCBzdWJqZWN0ID0gbmV3IFN1YmplY3QoKCkgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCBjYW5jZWxJbnZvY2F0aW9uID0gdGhpcy5jcmVhdGVDYW5jZWxJbnZvY2F0aW9uKGludm9jYXRpb25EZXNjcmlwdG9yLmludm9jYXRpb25JZCk7XHJcbiAgICAgICAgICAgIGNvbnN0IGNhbmNlbE1lc3NhZ2UgPSB0aGlzLnByb3RvY29sLndyaXRlTWVzc2FnZShjYW5jZWxJbnZvY2F0aW9uKTtcclxuICAgICAgICAgICAgZGVsZXRlIHRoaXMuY2FsbGJhY2tzW2ludm9jYXRpb25EZXNjcmlwdG9yLmludm9jYXRpb25JZF07XHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmNvbm5lY3Rpb24uc2VuZChjYW5jZWxNZXNzYWdlKTtcclxuICAgICAgICB9KTtcclxuICAgICAgICB0aGlzLmNhbGxiYWNrc1tpbnZvY2F0aW9uRGVzY3JpcHRvci5pbnZvY2F0aW9uSWRdID0gKGludm9jYXRpb25FdmVudCwgZXJyb3IpID0+IHtcclxuICAgICAgICAgICAgaWYgKGVycm9yKSB7XHJcbiAgICAgICAgICAgICAgICBzdWJqZWN0LmVycm9yKGVycm9yKTtcclxuICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAoaW52b2NhdGlvbkV2ZW50LnR5cGUgPT09IDMgLyogQ29tcGxldGlvbiAqLykge1xyXG4gICAgICAgICAgICAgICAgaWYgKGludm9jYXRpb25FdmVudC5lcnJvcikge1xyXG4gICAgICAgICAgICAgICAgICAgIHN1YmplY3QuZXJyb3IobmV3IEVycm9yKGludm9jYXRpb25FdmVudC5lcnJvcikpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgc3ViamVjdC5jb21wbGV0ZSgpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgc3ViamVjdC5uZXh0KChpbnZvY2F0aW9uRXZlbnQuaXRlbSkpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuICAgICAgICBjb25zdCBtZXNzYWdlID0gdGhpcy5wcm90b2NvbC53cml0ZU1lc3NhZ2UoaW52b2NhdGlvbkRlc2NyaXB0b3IpO1xyXG4gICAgICAgIHRoaXMuY29ubmVjdGlvbi5zZW5kKG1lc3NhZ2UpXHJcbiAgICAgICAgICAgIC5jYXRjaCgoZSkgPT4ge1xyXG4gICAgICAgICAgICBzdWJqZWN0LmVycm9yKGUpO1xyXG4gICAgICAgICAgICBkZWxldGUgdGhpcy5jYWxsYmFja3NbaW52b2NhdGlvbkRlc2NyaXB0b3IuaW52b2NhdGlvbklkXTtcclxuICAgICAgICB9KTtcclxuICAgICAgICByZXR1cm4gc3ViamVjdDtcclxuICAgIH1cclxuICAgIHNlbmQobWV0aG9kTmFtZSwgLi4uYXJncykge1xyXG4gICAgICAgIGNvbnN0IGludm9jYXRpb25EZXNjcmlwdG9yID0gdGhpcy5jcmVhdGVJbnZvY2F0aW9uKG1ldGhvZE5hbWUsIGFyZ3MsIHRydWUpO1xyXG4gICAgICAgIGNvbnN0IG1lc3NhZ2UgPSB0aGlzLnByb3RvY29sLndyaXRlTWVzc2FnZShpbnZvY2F0aW9uRGVzY3JpcHRvcik7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuY29ubmVjdGlvbi5zZW5kKG1lc3NhZ2UpO1xyXG4gICAgfVxyXG4gICAgaW52b2tlKG1ldGhvZE5hbWUsIC4uLmFyZ3MpIHtcclxuICAgICAgICBjb25zdCBpbnZvY2F0aW9uRGVzY3JpcHRvciA9IHRoaXMuY3JlYXRlSW52b2NhdGlvbihtZXRob2ROYW1lLCBhcmdzLCBmYWxzZSk7XHJcbiAgICAgICAgY29uc3QgcCA9IG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcclxuICAgICAgICAgICAgdGhpcy5jYWxsYmFja3NbaW52b2NhdGlvbkRlc2NyaXB0b3IuaW52b2NhdGlvbklkXSA9IChpbnZvY2F0aW9uRXZlbnQsIGVycm9yKSA9PiB7XHJcbiAgICAgICAgICAgICAgICBpZiAoZXJyb3IpIHtcclxuICAgICAgICAgICAgICAgICAgICByZWplY3QoZXJyb3IpO1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGlmIChpbnZvY2F0aW9uRXZlbnQudHlwZSA9PT0gMyAvKiBDb21wbGV0aW9uICovKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgY29tcGxldGlvbk1lc3NhZ2UgPSBpbnZvY2F0aW9uRXZlbnQ7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGNvbXBsZXRpb25NZXNzYWdlLmVycm9yKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlamVjdChuZXcgRXJyb3IoY29tcGxldGlvbk1lc3NhZ2UuZXJyb3IpKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUoY29tcGxldGlvbk1lc3NhZ2UucmVzdWx0KTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICByZWplY3QobmV3IEVycm9yKGBVbmV4cGVjdGVkIG1lc3NhZ2UgdHlwZTogJHtpbnZvY2F0aW9uRXZlbnQudHlwZX1gKSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIGNvbnN0IG1lc3NhZ2UgPSB0aGlzLnByb3RvY29sLndyaXRlTWVzc2FnZShpbnZvY2F0aW9uRGVzY3JpcHRvcik7XHJcbiAgICAgICAgICAgIHRoaXMuY29ubmVjdGlvbi5zZW5kKG1lc3NhZ2UpXHJcbiAgICAgICAgICAgICAgICAuY2F0Y2goKGUpID0+IHtcclxuICAgICAgICAgICAgICAgIHJlamVjdChlKTtcclxuICAgICAgICAgICAgICAgIGRlbGV0ZSB0aGlzLmNhbGxiYWNrc1tpbnZvY2F0aW9uRGVzY3JpcHRvci5pbnZvY2F0aW9uSWRdO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9KTtcclxuICAgICAgICByZXR1cm4gcDtcclxuICAgIH1cclxuICAgIG9uKG1ldGhvZE5hbWUsIG5ld01ldGhvZCkge1xyXG4gICAgICAgIGlmICghbWV0aG9kTmFtZSB8fCAhbmV3TWV0aG9kKSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgICAgbWV0aG9kTmFtZSA9IG1ldGhvZE5hbWUudG9Mb3dlckNhc2UoKTtcclxuICAgICAgICBpZiAoIXRoaXMubWV0aG9kc1ttZXRob2ROYW1lXSkge1xyXG4gICAgICAgICAgICB0aGlzLm1ldGhvZHNbbWV0aG9kTmFtZV0gPSBbXTtcclxuICAgICAgICB9XHJcbiAgICAgICAgLy8gUHJldmVudGluZyBhZGRpbmcgdGhlIHNhbWUgaGFuZGxlciBtdWx0aXBsZSB0aW1lcy5cclxuICAgICAgICBpZiAodGhpcy5tZXRob2RzW21ldGhvZE5hbWVdLmluZGV4T2YobmV3TWV0aG9kKSAhPT0gLTEpIHtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLm1ldGhvZHNbbWV0aG9kTmFtZV0ucHVzaChuZXdNZXRob2QpO1xyXG4gICAgfVxyXG4gICAgb2ZmKG1ldGhvZE5hbWUsIG1ldGhvZCkge1xyXG4gICAgICAgIGlmICghbWV0aG9kTmFtZSkge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIG1ldGhvZE5hbWUgPSBtZXRob2ROYW1lLnRvTG93ZXJDYXNlKCk7XHJcbiAgICAgICAgY29uc3QgaGFuZGxlcnMgPSB0aGlzLm1ldGhvZHNbbWV0aG9kTmFtZV07XHJcbiAgICAgICAgaWYgKCFoYW5kbGVycykge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChtZXRob2QpIHtcclxuICAgICAgICAgICAgY29uc3QgcmVtb3ZlSWR4ID0gaGFuZGxlcnMuaW5kZXhPZihtZXRob2QpO1xyXG4gICAgICAgICAgICBpZiAocmVtb3ZlSWR4ICE9PSAtMSkge1xyXG4gICAgICAgICAgICAgICAgaGFuZGxlcnMuc3BsaWNlKHJlbW92ZUlkeCwgMSk7XHJcbiAgICAgICAgICAgICAgICBpZiAoaGFuZGxlcnMubGVuZ3RoID09PSAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZGVsZXRlIHRoaXMubWV0aG9kc1ttZXRob2ROYW1lXTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgZGVsZXRlIHRoaXMubWV0aG9kc1ttZXRob2ROYW1lXTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICBvbmNsb3NlKGNhbGxiYWNrKSB7XHJcbiAgICAgICAgaWYgKGNhbGxiYWNrKSB7XHJcbiAgICAgICAgICAgIHRoaXMuY2xvc2VkQ2FsbGJhY2tzLnB1c2goY2FsbGJhY2spO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIGNsZWFudXBUaW1lb3V0KCkge1xyXG4gICAgICAgIGlmICh0aGlzLnRpbWVvdXRIYW5kbGUpIHtcclxuICAgICAgICAgICAgY2xlYXJUaW1lb3V0KHRoaXMudGltZW91dEhhbmRsZSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgY3JlYXRlSW52b2NhdGlvbihtZXRob2ROYW1lLCBhcmdzLCBub25ibG9ja2luZykge1xyXG4gICAgICAgIGlmIChub25ibG9ja2luZykge1xyXG4gICAgICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICAgICAgYXJndW1lbnRzOiBhcmdzLFxyXG4gICAgICAgICAgICAgICAgdGFyZ2V0OiBtZXRob2ROYW1lLFxyXG4gICAgICAgICAgICAgICAgdHlwZTogMSAvKiBJbnZvY2F0aW9uICovLFxyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgY29uc3QgaWQgPSB0aGlzLmlkO1xyXG4gICAgICAgICAgICB0aGlzLmlkKys7XHJcbiAgICAgICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgICAgICBhcmd1bWVudHM6IGFyZ3MsXHJcbiAgICAgICAgICAgICAgICBpbnZvY2F0aW9uSWQ6IGlkLnRvU3RyaW5nKCksXHJcbiAgICAgICAgICAgICAgICB0YXJnZXQ6IG1ldGhvZE5hbWUsXHJcbiAgICAgICAgICAgICAgICB0eXBlOiAxIC8qIEludm9jYXRpb24gKi8sXHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgY3JlYXRlU3RyZWFtSW52b2NhdGlvbihtZXRob2ROYW1lLCBhcmdzKSB7XHJcbiAgICAgICAgY29uc3QgaWQgPSB0aGlzLmlkO1xyXG4gICAgICAgIHRoaXMuaWQrKztcclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICBhcmd1bWVudHM6IGFyZ3MsXHJcbiAgICAgICAgICAgIGludm9jYXRpb25JZDogaWQudG9TdHJpbmcoKSxcclxuICAgICAgICAgICAgdGFyZ2V0OiBtZXRob2ROYW1lLFxyXG4gICAgICAgICAgICB0eXBlOiA0IC8qIFN0cmVhbUludm9jYXRpb24gKi8sXHJcbiAgICAgICAgfTtcclxuICAgIH1cclxuICAgIGNyZWF0ZUNhbmNlbEludm9jYXRpb24oaWQpIHtcclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICBpbnZvY2F0aW9uSWQ6IGlkLFxyXG4gICAgICAgICAgICB0eXBlOiA1IC8qIENhbmNlbEludm9jYXRpb24gKi8sXHJcbiAgICAgICAgfTtcclxuICAgIH1cclxufVxyXG4vLyMgc291cmNlTWFwcGluZ1VSTD1IdWJDb25uZWN0aW9uLmpzLm1hcCJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///8\n')},function(module,exports){eval("//# sourceMappingURL=IHubProtocol.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9ub2RlX21vZHVsZXMvQGFzcG5ldC9zaWduYWxyL2Rpc3QvZXNtL0lIdWJQcm90b2NvbC5qcz9kNjljIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBIiwiZmlsZSI6IjkuanMiLCJzb3VyY2VzQ29udGVudCI6WyIvLyMgc291cmNlTWFwcGluZ1VSTD1JSHViUHJvdG9jb2wuanMubWFwIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///9\n")},function(module,exports,__webpack_require__){eval('var __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;!(__WEBPACK_AMD_DEFINE_ARRAY__ = [__webpack_require__, exports], __WEBPACK_AMD_DEFINE_RESULT__ = (function (require, exports) {\r\n    "use strict";\r\n    Object.defineProperty(exports, "__esModule", { value: true });\r\n    var config = {\r\n        metadataEndpoint: "https://pxdraw-api.trafficmanager.net/api/metadata",\r\n        isLocal: true,\r\n        isTrendingTweetsEnabled: true,\r\n        isAuthRequired: false\r\n    };\r\n    exports.config = config;\r\n    if (window && window.location && window.location.hostname) {\r\n        if (!window.location.hostname.startsWith("localhost")) {\r\n            var info = parseHostnameByConvention(window.location.hostname);\r\n            config.isLocal = false;\r\n        }\r\n    }\r\n    function parseHostnameByConvention(hostname) {\r\n        var stages = ["dev"];\r\n        var fullname = hostname.replace(".azurewebsites.net", "").replace("www", "");\r\n        var stage = stages.find(function (v) { return fullname.endsWith("-" + v); });\r\n        if (stage) {\r\n            fullname = fullname.replace("-" + stage, "");\r\n        }\r\n        return {\r\n            base: fullname,\r\n            stage: stage\r\n        };\r\n    }\r\n    exports.parseHostnameByConvention = parseHostnameByConvention;\r\n}).apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__),\n\t\t\t\t__WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\r\n//# sourceMappingURL=config.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9idWlsdC9jb25maWcuanM/MDA0MCJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiZ0VBQUE7QUFDQTtBQUNBLGtEQUFrRCxjQUFjO0FBQ2hFO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsOENBQThDLG1DQUFtQyxFQUFFO0FBQ25GO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLENBQUM7QUFBQTtBQUNEIiwiZmlsZSI6IjEwLmpzIiwic291cmNlc0NvbnRlbnQiOlsiZGVmaW5lKFtcInJlcXVpcmVcIiwgXCJleHBvcnRzXCJdLCBmdW5jdGlvbiAocmVxdWlyZSwgZXhwb3J0cykge1xyXG4gICAgXCJ1c2Ugc3RyaWN0XCI7XHJcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XHJcbiAgICB2YXIgY29uZmlnID0ge1xyXG4gICAgICAgIG1ldGFkYXRhRW5kcG9pbnQ6IE1FVEFEQVRBX0VORFBPSU5ULFxyXG4gICAgICAgIGlzTG9jYWw6IHRydWUsXHJcbiAgICAgICAgaXNUcmVuZGluZ1R3ZWV0c0VuYWJsZWQ6IEVOQUJMRV9UUkVORElOR19UV0VFVFMsXHJcbiAgICAgICAgaXNBdXRoUmVxdWlyZWQ6IEFVVEhSRVFVSVJFRFxyXG4gICAgfTtcclxuICAgIGV4cG9ydHMuY29uZmlnID0gY29uZmlnO1xyXG4gICAgaWYgKHdpbmRvdyAmJiB3aW5kb3cubG9jYXRpb24gJiYgd2luZG93LmxvY2F0aW9uLmhvc3RuYW1lKSB7XHJcbiAgICAgICAgaWYgKCF3aW5kb3cubG9jYXRpb24uaG9zdG5hbWUuc3RhcnRzV2l0aChcImxvY2FsaG9zdFwiKSkge1xyXG4gICAgICAgICAgICB2YXIgaW5mbyA9IHBhcnNlSG9zdG5hbWVCeUNvbnZlbnRpb24od2luZG93LmxvY2F0aW9uLmhvc3RuYW1lKTtcclxuICAgICAgICAgICAgY29uZmlnLmlzTG9jYWwgPSBmYWxzZTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICBmdW5jdGlvbiBwYXJzZUhvc3RuYW1lQnlDb252ZW50aW9uKGhvc3RuYW1lKSB7XHJcbiAgICAgICAgdmFyIHN0YWdlcyA9IFtcImRldlwiXTtcclxuICAgICAgICB2YXIgZnVsbG5hbWUgPSBob3N0bmFtZS5yZXBsYWNlKFwiLmF6dXJld2Vic2l0ZXMubmV0XCIsIFwiXCIpLnJlcGxhY2UoXCJ3d3dcIiwgXCJcIik7XHJcbiAgICAgICAgdmFyIHN0YWdlID0gc3RhZ2VzLmZpbmQoZnVuY3Rpb24gKHYpIHsgcmV0dXJuIGZ1bGxuYW1lLmVuZHNXaXRoKFwiLVwiICsgdik7IH0pO1xyXG4gICAgICAgIGlmIChzdGFnZSkge1xyXG4gICAgICAgICAgICBmdWxsbmFtZSA9IGZ1bGxuYW1lLnJlcGxhY2UoXCItXCIgKyBzdGFnZSwgXCJcIik7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgIGJhc2U6IGZ1bGxuYW1lLFxyXG4gICAgICAgICAgICBzdGFnZTogc3RhZ2VcclxuICAgICAgICB9O1xyXG4gICAgfVxyXG4gICAgZXhwb3J0cy5wYXJzZUhvc3RuYW1lQnlDb252ZW50aW9uID0gcGFyc2VIb3N0bmFtZUJ5Q29udmVudGlvbjtcclxufSk7XHJcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWNvbmZpZy5qcy5tYXAiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///10\n')},function(module,exports,__webpack_require__){eval('var __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n};\r\nvar __generator = (this && this.__generator) || function (thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), "throw": verb(1), "return": verb(2) }, typeof Symbol === "function" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError("Generator is already executing.");\r\n        while (_) try {\r\n            if (f = 1, y && (t = y[op[0] & 2 ? "return" : op[0] ? "throw" : "next"]) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [0, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n};\r\n!(__WEBPACK_AMD_DEFINE_ARRAY__ = [__webpack_require__, exports, __webpack_require__(10), __webpack_require__(16), __webpack_require__(14), __webpack_require__(12)], __WEBPACK_AMD_DEFINE_RESULT__ = (function (require, exports, config_1, canvas_1, updateClient_1, user_1) {\r\n    "use strict";\r\n    var _this = this;\r\n    Object.defineProperty(exports, "__esModule", { value: true });\r\n    var BATCH_SIZE = 300;\r\n    var Main = /** @class */ (function () {\r\n        function Main() {\r\n            var _this = this;\r\n            this.receivedUpdates = []; // Assume for now they should be ordered by LSN asc\r\n            this.canvas = new canvas_1.Canvas({\r\n                onPixelUpdatesSubmitted: this.onPixelUpdatesFromUI.bind(this),\r\n                onDisabledPixelInsert: function () {\r\n                    if (!_this.isLoggedIn()) {\r\n                        alert("You must be logged in to insert a pixel.\\nClick the login button in the top right to login.");\r\n                    }\r\n                    else {\r\n                        alert("You must wait " + _this.getRemainingMsBeforeDraw() / 1000 + " seconds before your next insert.");\r\n                    }\r\n                },\r\n            });\r\n            this.isNow = ko.observable(false);\r\n            this.remainingTimeDisplay = ko.observable(null);\r\n            this.remainingTimeDisplay.subscribe(function () {\r\n                _this.isNow(_this.getRemainingMsBeforeDraw() <= 0);\r\n            });\r\n            this.loginUrl = ko.observable(null);\r\n            this.logoutUrl = ko.observable(null);\r\n            this.isLoggedIn = ko.observable(false);\r\n            this.isAdmin = ko.observable(false);\r\n            this.isFreehandDrawing = ko.observable(this.canvas.drawMode() === canvas_1.DrawModes.Freehand);\r\n            this.isFreehandDrawing.subscribe(function (newValue) {\r\n                _this.canvas.drawMode(newValue ? canvas_1.DrawModes.Freehand : canvas_1.DrawModes.Pixel);\r\n            });\r\n            this.timerId = 0;\r\n            this.isPreReleaseMode = ko.observable(false);\r\n            this.isTrendingTweetsEnabled = ko.observable(false);\r\n            this.isTweetPaneExpanded = ko.observable(false);\r\n        }\r\n        Main.prototype.init = function () {\r\n            return __awaiter(this, void 0, void 0, function () {\r\n                var _a, e_1;\r\n                return __generator(this, function (_b) {\r\n                    switch (_b.label) {\r\n                        case 0:\r\n                            this.updateClient = new updateClient_1.UpdateClient({\r\n                                onReceived: this.onPixelUpdateFromRemote.bind(this)\r\n                            });\r\n                            return [4 /*yield*/, this.fetchMetadata()];\r\n                        case 1:\r\n                            _b.sent();\r\n                            if (this.isPreReleaseMode()) {\r\n                                // Don\'t do anything else if we\'re still in pre-release mode.\r\n                                return [2 /*return*/];\r\n                            }\r\n                            // TODO Remove test code\r\n                            // this.getBoardEndpoint = \'https://pxdrawbuild18dev.blob.core.windows.net/dev/board1\';\r\n                            // this.websocketEndpoint = \'https://pxdraw-build18-notifcations.azurewebsites.net/hubs/notifications\';\r\n                            // this.topTweetsEndpoint = \'https://pxdrawwestus-api.azurewebsites.net/api/top-tweets\';\r\n                            // this.userEndpoint = \'http://blah\';\r\n                            // this.loginEndpoint = \'http://login\';\r\n                            // this.logoutEndpoint = \'http://logout\';\r\n                            this.loginUrl(this.loginEndpoint);\r\n                            this.logoutUrl(this.logoutEndpoint);\r\n                            _b.label = 2;\r\n                        case 2:\r\n                            _b.trys.push([2, 4, , 5]);\r\n                            _a = this;\r\n                            return [4 /*yield*/, user_1.User.getUser(this.userEndpoint)];\r\n                        case 3:\r\n                            _a.user = _b.sent();\r\n                            // TODO remove test code\r\n                            // this.user = {\r\n                            //     isAdmin: true,\r\n                            //     lastUpdate: new Date(new Date().getTime() - 3000),\r\n                            //     id: \'userid\'\r\n                            // };\r\n                            this.isLoggedIn(true);\r\n                            this.isAdmin(this.user.isAdmin);\r\n                            this.enableDraw(true);\r\n                            this.isFreehandDrawing(this.user.isAdmin);\r\n                            this.updateNextUpdateTime(this.user.lastUpdate);\r\n                            return [3 /*break*/, 5];\r\n                        case 4:\r\n                            e_1 = _b.sent();\r\n                            console.log("User is not logged in");\r\n                            return [3 /*break*/, 5];\r\n                        case 5:\r\n                            if (!config_1.config.isAuthRequired || this.isLoggedIn()) {\r\n                                this.updateClient.init(this.websocketEndpoint);\r\n                            }\r\n                            // Periodic board update\r\n                            this.updateBoard();\r\n                            setInterval(this.updateBoard.bind(this), Main.REFRESH_BOARD_DELAY_MS);\r\n                            this.isTrendingTweetsEnabled(config_1.config.isTrendingTweetsEnabled);\r\n                            if (this.isLoggedIn() && !this.isAdmin()) {\r\n                                this.canvas.executeZoom(canvas_1.Canvas.INITIAL_ZOOM);\r\n                            }\r\n                            return [2 /*return*/];\r\n                    }\r\n                });\r\n            });\r\n        };\r\n        Main.prototype.processFetchBoardResponse = function (data) {\r\n            var board8Uint = Main.unpackBoardBlob(new Uint8Array(data));\r\n            this.canvas.queueBoardUpdate(board8Uint);\r\n        };\r\n        Main.prototype.onPixelUpdateFromRemote = function (data) {\r\n            this.receivedUpdates.push(data);\r\n            this.canvas.queuePixelUpdate(data);\r\n        };\r\n        Main.prototype.enableDraw = function (enable) {\r\n            if (enable) {\r\n                this.canvas.drawMode(this.user.isAdmin ? canvas_1.DrawModes.Freehand : canvas_1.DrawModes.Pixel);\r\n            }\r\n            else {\r\n                if (!this.user.isAdmin) {\r\n                    this.canvas.drawMode(canvas_1.DrawModes.Disabled);\r\n                }\r\n            }\r\n        };\r\n        /**\r\n         * User submitted pixel updates through UI\r\n         * @param updates\r\n         */\r\n        Main.prototype.onPixelUpdatesFromUI = function (updates) {\r\n            this.submitPixelUpdates(updates).catch(function (err) {\r\n                console.error(err);\r\n            });\r\n        };\r\n        Main.prototype.startUpdateTimer = function () {\r\n            clearTimeout(this.timerId);\r\n            var remainingMs = this.getRemainingMsBeforeDraw();\r\n            if (remainingMs <= 0 || this.isAdmin()) {\r\n                this.enableDraw(true);\r\n                this.remainingTimeDisplay(\'Now!\');\r\n            }\r\n            else {\r\n                this.enableDraw(false);\r\n                this.remainingTimeDisplay(Math.ceil(remainingMs / 1000) + "s");\r\n                this.timerId = setTimeout(this.startUpdateTimer.bind(this), Main.TIME_UPDATE_MS);\r\n            }\r\n        };\r\n        Main.prototype.getRemainingMsBeforeDraw = function () {\r\n            if (!this.nextUpdateTime) {\r\n                return 0;\r\n            }\r\n            return this.nextUpdateTime.getTime() - new Date().getTime();\r\n        };\r\n        Main.prototype.updateNextUpdateTime = function (lastUpdate) {\r\n            this.nextUpdateTime = new Date();\r\n            if (lastUpdate) {\r\n                this.nextUpdateTime = lastUpdate;\r\n                this.nextUpdateTime.setSeconds(this.nextUpdateTime.getSeconds() + Main.draw_delay_s);\r\n            }\r\n            this.startUpdateTimer();\r\n        };\r\n        /**\r\n         * Board blob is an array of 4-bit integer: 0-15 color index for each pixel.\r\n         * Convert this into an easier array to read.\r\n         *\r\n         * @param blob\r\n         * @return result is a [width * height] array of 1-byte\r\n         */\r\n        Main.unpackBoardBlob = function (blob) {\r\n            var start = performance.now();\r\n            var result = new Uint8Array(canvas_1.Canvas.BOARD_WIDTH_PX * canvas_1.Canvas.BOARD_HEIGHT_PX);\r\n            for (var i = 0; i < blob.byteLength; i++) {\r\n                var byte = blob[i];\r\n                result[i * 2] = byte >> 4;\r\n                result[i * 2 + 1] = byte & 0xF;\r\n            }\r\n            console.log("unpackBoardBlob: " + (performance.now() - start) + " ms");\r\n            return result;\r\n        };\r\n        Main.prototype.fetchMetadata = function () {\r\n            return __awaiter(this, void 0, void 0, function () {\r\n                var _this = this;\r\n                return __generator(this, function (_a) {\r\n                    return [2 /*return*/, new Promise(function (resolve, reject) {\r\n                            $.ajax({\r\n                                type: \'GET\',\r\n                                url: config_1.config.metadataEndpoint,\r\n                                crossDomain: true,\r\n                                success: function (data, textStatus, jqXHR) {\r\n                                    _this.loginEndpoint = data.loginEndpoint;\r\n                                    _this.getBoardEndpoint = data.getBoardEndpoint;\r\n                                    _this.updatePixelEndpoint = data.updatePixelEndpoint;\r\n                                    _this.websocketEndpoint = data.websocketEndpoint;\r\n                                    _this.userEndpoint = data.userEndpoint;\r\n                                    _this.logoutEndpoint = data.logoutEndpoint;\r\n                                    _this.topTweetsEndpoint = data.topTweetsEndpoint;\r\n                                    Main.draw_delay_s = data.throttleRate;\r\n                                    _this.isPreReleaseMode(!!(data.isPreRelease));\r\n                                    resolve();\r\n                                },\r\n                                error: function (jqXHR, textStatus, errorThrown) {\r\n                                    console.error("Failed to fetch metadata:" + errorThrown);\r\n                                    reject(errorThrown);\r\n                                }\r\n                            });\r\n                        })];\r\n                });\r\n            });\r\n        };\r\n        Main.prototype.fetchBoard = function () {\r\n            return __awaiter(this, void 0, void 0, function () {\r\n                var _this = this;\r\n                var currentLSN;\r\n                return __generator(this, function (_a) {\r\n                    currentLSN = this.receivedUpdates && this.receivedUpdates.length > 0 ?\r\n                        this.receivedUpdates[this.receivedUpdates.length - 1] : 0;\r\n                    return [2 /*return*/, new Promise(function (resolve, reject) {\r\n                            var xhr = new XMLHttpRequest();\r\n                            var nonce = Date.now();\r\n                            xhr.open(\'GET\', _this.getBoardEndpoint + "?t=" + nonce, true);\r\n                            xhr.responseType = \'arraybuffer\';\r\n                            xhr.addEventListener(\'load\', function () {\r\n                                if (xhr.status === 200) {\r\n                                    if (!xhr.response) {\r\n                                        console.error(\'Fetching board returned no data\');\r\n                                    }\r\n                                    resolve({ board: xhr.response, lsn: currentLSN });\r\n                                }\r\n                            });\r\n                            xhr.send();\r\n                        })];\r\n                });\r\n            });\r\n        };\r\n        Main.prototype.updateBoard = function () {\r\n            var _this = this;\r\n            this.fetchBoard().then(function (result) {\r\n                _this.processFetchBoardResponse(result.board);\r\n                _this.replayAndCleanupUpdates(result.lsn);\r\n            });\r\n        };\r\n        /**\r\n         * Cull obsolete lsn\'s\r\n         * @param startLsn\r\n         */\r\n        Main.prototype.replayAndCleanupUpdates = function (startLsn) {\r\n            var start = performance.now();\r\n            var validUpdates = [];\r\n            console.log("Replaying " + this.receivedUpdates.length + " received updates");\r\n            var count = 0;\r\n            for (var i = 0; i < this.receivedUpdates.length; i++) {\r\n                var update = this.receivedUpdates[i];\r\n                if (startLsn <= update._lsn) {\r\n                    validUpdates.push(update);\r\n                    this.canvas.queuePixelUpdate(update);\r\n                    count++;\r\n                }\r\n            }\r\n            this.receivedUpdates = validUpdates;\r\n            console.log("Replayed " + count + " updates took " + (performance.now() - start) + " ms");\r\n        };\r\n        Main.prototype.submitPixelUpdates = function (updates) {\r\n            return __awaiter(this, void 0, void 0, function () {\r\n                var _this = this;\r\n                var remainingMs, error, numberOfBatches, _loop_1, i;\r\n                return __generator(this, function (_a) {\r\n                    switch (_a.label) {\r\n                        case 0:\r\n                            remainingMs = this.getRemainingMsBeforeDraw();\r\n                            if (remainingMs > 0 && !this.user.isAdmin) {\r\n                                error = "Must wait another " + remainingMs + "ms";\r\n                                return [2 /*return*/, Promise.reject(new Error(error))];\r\n                            }\r\n                            console.log("Submitting " + updates.length + " updates");\r\n                            numberOfBatches = updates.length / BATCH_SIZE;\r\n                            _loop_1 = function (i) {\r\n                                var data;\r\n                                return __generator(this, function (_a) {\r\n                                    switch (_a.label) {\r\n                                        case 0:\r\n                                            data = JSON.stringify(updates.slice(i * BATCH_SIZE, (i + 1) * BATCH_SIZE));\r\n                                            return [4 /*yield*/, new Promise(function (resolve, reject) {\r\n                                                    $.ajax({\r\n                                                        type: \'POST\',\r\n                                                        url: _this.updatePixelEndpoint,\r\n                                                        contentType: "application/json",\r\n                                                        xhrFields: {\r\n                                                            withCredentials: true\r\n                                                        },\r\n                                                        beforeSend: function (request) {\r\n                                                            if (config_1.config.isLocal) {\r\n                                                                // locally, we spoof the header\r\n                                                                request.setRequestHeader(\'x-ms-client-principal-id\', Main.LOCALHOST_CLIENT_PRINCIPAL_ID);\r\n                                                                request.setRequestHeader(\'x-ms-client-principal-idp\', Main.LOCALHOST_CLIENT_PRINCIPAL_IDP);\r\n                                                            }\r\n                                                        },\r\n                                                        data: data,\r\n                                                        success: function (data, textStatus, jqXHR) {\r\n                                                            console.log("Data: " + data + "\\nStatus: " + textStatus);\r\n                                                            _this.updateNextUpdateTime(new Date());\r\n                                                        },\r\n                                                        error: function (jqXHR, textStatus, errorThrown) {\r\n                                                            console.error("Failed to submit pixel update:" + errorThrown);\r\n                                                            // TODO Remove test code\r\n                                                            // this.updateNextUpdateTime(new Date());\r\n                                                            reject(errorThrown);\r\n                                                        }\r\n                                                    });\r\n                                                })];\r\n                                        case 1:\r\n                                            _a.sent();\r\n                                            return [2 /*return*/];\r\n                                    }\r\n                                });\r\n                            };\r\n                            i = 0;\r\n                            _a.label = 1;\r\n                        case 1:\r\n                            if (!(i < numberOfBatches)) return [3 /*break*/, 4];\r\n                            return [5 /*yield**/, _loop_1(i)];\r\n                        case 2:\r\n                            _a.sent();\r\n                            _a.label = 3;\r\n                        case 3:\r\n                            i++;\r\n                            return [3 /*break*/, 1];\r\n                        case 4: return [2 /*return*/];\r\n                    }\r\n                });\r\n            });\r\n        };\r\n        Main.prototype.updateTwitterTrend = function () {\r\n            var _this = this;\r\n            return new Promise(function (resolve, reject) {\r\n                $.ajax({\r\n                    type: \'GET\',\r\n                    url: _this.topTweetsEndpoint,\r\n                    success: function (data, textStatus, jqXHR) {\r\n                        if (!Array.isArray(data)) {\r\n                            console.error(\'Invalid twitter trend received\');\r\n                            reject(\'Results not an Array\');\r\n                            return;\r\n                        }\r\n                        var tweetsParentElt = document.getElementById(\'tweets\');\r\n                        var oldChildrenCount = tweetsParentElt.childElementCount;\r\n                        var promises = [];\r\n                        $.each(data, function (index, trend) {\r\n                            // This adds children to tweetsParentElt asynchronously\r\n                            var p = twttr.widgets.createTweet(trend.id, tweetsParentElt, { conversation: \'none\', width: 400 });\r\n                            promises.push(p);\r\n                        });\r\n                        (function () { return __awaiter(_this, void 0, void 0, function () {\r\n                            var i;\r\n                            return __generator(this, function (_a) {\r\n                                switch (_a.label) {\r\n                                    case 0:\r\n                                        _a.trys.push([0, , 2, 3]);\r\n                                        return [4 /*yield*/, Promise.all(promises)\r\n                                            // Must part with the old children :(\r\n                                        ];\r\n                                    case 1:\r\n                                        _a.sent();\r\n                                        // Must part with the old children :(\r\n                                        for (i = 0; i < oldChildrenCount; i++) {\r\n                                            tweetsParentElt.removeChild(tweetsParentElt.firstChild);\r\n                                        }\r\n                                        return [3 /*break*/, 3];\r\n                                    case 2:\r\n                                        resolve();\r\n                                        return [7 /*endfinally*/];\r\n                                    case 3: return [2 /*return*/];\r\n                                }\r\n                            });\r\n                        }); })();\r\n                    },\r\n                    error: function (jqXHR, textStatus, errorThrown) {\r\n                        console.error("Failed to get trend:" + errorThrown);\r\n                        reject(errorThrown);\r\n                    }\r\n                });\r\n            });\r\n        };\r\n        Main.prototype.toggleTweetPane = function () {\r\n            this.isTweetPaneExpanded(!this.isTweetPaneExpanded());\r\n            if (config_1.config.isTrendingTweetsEnabled && this.isTweetPaneExpanded()) {\r\n                var parentElt = document.getElementById("tweet-area2");\r\n                if (parentElt.childElementCount === 0) {\r\n                    // Create twitter button at run-time, because button won\'t size properly if initial container visible is none\r\n                    console.log(\'adding button\');\r\n                    twttr.widgets.createHashtagButton(\'CosmosDB\', parentElt, {\r\n                        size: \'large\',\r\n                        text: \'Drawing #<use a hashtag to describe your effort> with love on\',\r\n                        hashtags: \'Azure,PxDraw\'\r\n                    });\r\n                }\r\n                this.updateTwitterTrend();\r\n                this.twitterUpdateId = setInterval(this.updateTwitterTrend.bind(this), Main.REFRESH_TWITTER_TRENDS_MIN * 60 * 1000);\r\n            }\r\n            else {\r\n                clearInterval(this.twitterUpdateId);\r\n            }\r\n        };\r\n        Main.LOCALHOST_CLIENT_PRINCIPAL_ID = \'PrincicalId\';\r\n        Main.LOCALHOST_CLIENT_PRINCIPAL_IDP = \'aad\'; // use twitter for non-admin\r\n        Main.REFRESH_BOARD_DELAY_MS = 30000;\r\n        Main.draw_delay_s = 30;\r\n        Main.TIME_UPDATE_MS = 1000; // Update every second\r\n        Main.REFRESH_TWITTER_TRENDS_MIN = 1;\r\n        return Main;\r\n    }());\r\n    exports.Main = Main;\r\n    $(document).ready(function () { return __awaiter(_this, void 0, void 0, function () {\r\n        var main;\r\n        return __generator(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0:\r\n                    main = new Main();\r\n                    return [4 /*yield*/, main.init()];\r\n                case 1:\r\n                    _a.sent();\r\n                    ko.applyBindings(main);\r\n                    return [2 /*return*/];\r\n            }\r\n        });\r\n    }); });\r\n}).apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__),\n\t\t\t\t__WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\r\n//# sourceMappingURL=main.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9idWlsdC9tYWluLmpzPzgzYTIiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBLG1DQUFtQyxNQUFNLDZCQUE2QixFQUFFLFlBQVksV0FBVyxFQUFFO0FBQ2pHLGtDQUFrQyxNQUFNLGlDQUFpQyxFQUFFLFlBQVksV0FBVyxFQUFFO0FBQ3BHLCtCQUErQixpRUFBaUUsdUJBQXVCLEVBQUUsNEJBQTRCO0FBQ3JKO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQSxhQUFhLDZCQUE2QiwwQkFBMEIsYUFBYSxFQUFFLHFCQUFxQjtBQUN4RyxnQkFBZ0IscURBQXFELG9FQUFvRSxhQUFhLEVBQUU7QUFDeEosc0JBQXNCLHNCQUFzQixxQkFBcUIsR0FBRztBQUNwRTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx1Q0FBdUM7QUFDdkMsa0NBQWtDLFNBQVM7QUFDM0Msa0NBQWtDLFdBQVcsVUFBVTtBQUN2RCx5Q0FBeUMsY0FBYztBQUN2RDtBQUNBLDZHQUE2RyxPQUFPLFVBQVU7QUFDOUgsZ0ZBQWdGLGlCQUFpQixPQUFPO0FBQ3hHLHdEQUF3RCxnQkFBZ0IsUUFBUSxPQUFPO0FBQ3ZGLDhDQUE4QyxnQkFBZ0IsZ0JBQWdCLE9BQU87QUFDckY7QUFDQSxpQ0FBaUM7QUFDakM7QUFDQTtBQUNBLFNBQVMsWUFBWSxhQUFhLE9BQU8sRUFBRSxVQUFVLFdBQVc7QUFDaEUsbUNBQW1DLFNBQVM7QUFDNUM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGtEQUFrRCxjQUFjO0FBQ2hFO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esc0NBQXNDO0FBQ3RDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQixhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw2QkFBNkI7QUFDN0I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakIsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDJCQUEyQixxQkFBcUI7QUFDaEQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUNBQWlDO0FBQ2pDO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsNkJBQTZCO0FBQzdCLHlCQUF5QjtBQUN6QixpQkFBaUI7QUFDakIsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDZDQUE2Qyx1Q0FBdUM7QUFDcEY7QUFDQSw2QkFBNkI7QUFDN0I7QUFDQSx5QkFBeUI7QUFDekIsaUJBQWlCO0FBQ2pCLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwyQkFBMkIsaUNBQWlDO0FBQzVEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EseURBQXlEO0FBQ3pEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHlEQUF5RDtBQUN6RDtBQUNBO0FBQ0E7QUFDQTtBQUNBLHlEQUF5RDtBQUN6RDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxxREFBcUQ7QUFDckQsaURBQWlEO0FBQ2pEO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUNBQWlDO0FBQ2pDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakIsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDBGQUEwRixtQ0FBbUM7QUFDN0g7QUFDQSx5QkFBeUI7QUFDekIsc0NBQXNDO0FBQ3RDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxtREFBbUQsc0JBQXNCO0FBQ3pFO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw2QkFBNkI7QUFDN0IseUJBQXlCLEVBQUUsRUFBRTtBQUM3QixxQkFBcUI7QUFDckI7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakIsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHFCQUFxQjtBQUNyQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxvREFBb0Q7QUFDcEQ7QUFDQTtBQUNBLG1DQUFtQztBQUNuQztBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0EsbUNBQW1DO0FBQ25DO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1QsS0FBSyxFQUFFLEVBQUU7QUFDVCxDQUFDO0FBQUE7QUFDRCIsImZpbGUiOiIxMS5qcyIsInNvdXJjZXNDb250ZW50IjpbInZhciBfX2F3YWl0ZXIgPSAodGhpcyAmJiB0aGlzLl9fYXdhaXRlcikgfHwgZnVuY3Rpb24gKHRoaXNBcmcsIF9hcmd1bWVudHMsIFAsIGdlbmVyYXRvcikge1xyXG4gICAgcmV0dXJuIG5ldyAoUCB8fCAoUCA9IFByb21pc2UpKShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7XHJcbiAgICAgICAgZnVuY3Rpb24gZnVsZmlsbGVkKHZhbHVlKSB7IHRyeSB7IHN0ZXAoZ2VuZXJhdG9yLm5leHQodmFsdWUpKTsgfSBjYXRjaCAoZSkgeyByZWplY3QoZSk7IH0gfVxyXG4gICAgICAgIGZ1bmN0aW9uIHJlamVjdGVkKHZhbHVlKSB7IHRyeSB7IHN0ZXAoZ2VuZXJhdG9yW1widGhyb3dcIl0odmFsdWUpKTsgfSBjYXRjaCAoZSkgeyByZWplY3QoZSk7IH0gfVxyXG4gICAgICAgIGZ1bmN0aW9uIHN0ZXAocmVzdWx0KSB7IHJlc3VsdC5kb25lID8gcmVzb2x2ZShyZXN1bHQudmFsdWUpIDogbmV3IFAoZnVuY3Rpb24gKHJlc29sdmUpIHsgcmVzb2x2ZShyZXN1bHQudmFsdWUpOyB9KS50aGVuKGZ1bGZpbGxlZCwgcmVqZWN0ZWQpOyB9XHJcbiAgICAgICAgc3RlcCgoZ2VuZXJhdG9yID0gZ2VuZXJhdG9yLmFwcGx5KHRoaXNBcmcsIF9hcmd1bWVudHMgfHwgW10pKS5uZXh0KCkpO1xyXG4gICAgfSk7XHJcbn07XHJcbnZhciBfX2dlbmVyYXRvciA9ICh0aGlzICYmIHRoaXMuX19nZW5lcmF0b3IpIHx8IGZ1bmN0aW9uICh0aGlzQXJnLCBib2R5KSB7XHJcbiAgICB2YXIgXyA9IHsgbGFiZWw6IDAsIHNlbnQ6IGZ1bmN0aW9uKCkgeyBpZiAodFswXSAmIDEpIHRocm93IHRbMV07IHJldHVybiB0WzFdOyB9LCB0cnlzOiBbXSwgb3BzOiBbXSB9LCBmLCB5LCB0LCBnO1xyXG4gICAgcmV0dXJuIGcgPSB7IG5leHQ6IHZlcmIoMCksIFwidGhyb3dcIjogdmVyYigxKSwgXCJyZXR1cm5cIjogdmVyYigyKSB9LCB0eXBlb2YgU3ltYm9sID09PSBcImZ1bmN0aW9uXCIgJiYgKGdbU3ltYm9sLml0ZXJhdG9yXSA9IGZ1bmN0aW9uKCkgeyByZXR1cm4gdGhpczsgfSksIGc7XHJcbiAgICBmdW5jdGlvbiB2ZXJiKG4pIHsgcmV0dXJuIGZ1bmN0aW9uICh2KSB7IHJldHVybiBzdGVwKFtuLCB2XSk7IH07IH1cclxuICAgIGZ1bmN0aW9uIHN0ZXAob3ApIHtcclxuICAgICAgICBpZiAoZikgdGhyb3cgbmV3IFR5cGVFcnJvcihcIkdlbmVyYXRvciBpcyBhbHJlYWR5IGV4ZWN1dGluZy5cIik7XHJcbiAgICAgICAgd2hpbGUgKF8pIHRyeSB7XHJcbiAgICAgICAgICAgIGlmIChmID0gMSwgeSAmJiAodCA9IHlbb3BbMF0gJiAyID8gXCJyZXR1cm5cIiA6IG9wWzBdID8gXCJ0aHJvd1wiIDogXCJuZXh0XCJdKSAmJiAhKHQgPSB0LmNhbGwoeSwgb3BbMV0pKS5kb25lKSByZXR1cm4gdDtcclxuICAgICAgICAgICAgaWYgKHkgPSAwLCB0KSBvcCA9IFswLCB0LnZhbHVlXTtcclxuICAgICAgICAgICAgc3dpdGNoIChvcFswXSkge1xyXG4gICAgICAgICAgICAgICAgY2FzZSAwOiBjYXNlIDE6IHQgPSBvcDsgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICBjYXNlIDQ6IF8ubGFiZWwrKzsgcmV0dXJuIHsgdmFsdWU6IG9wWzFdLCBkb25lOiBmYWxzZSB9O1xyXG4gICAgICAgICAgICAgICAgY2FzZSA1OiBfLmxhYmVsKys7IHkgPSBvcFsxXTsgb3AgPSBbMF07IGNvbnRpbnVlO1xyXG4gICAgICAgICAgICAgICAgY2FzZSA3OiBvcCA9IF8ub3BzLnBvcCgpOyBfLnRyeXMucG9wKCk7IGNvbnRpbnVlO1xyXG4gICAgICAgICAgICAgICAgZGVmYXVsdDpcclxuICAgICAgICAgICAgICAgICAgICBpZiAoISh0ID0gXy50cnlzLCB0ID0gdC5sZW5ndGggPiAwICYmIHRbdC5sZW5ndGggLSAxXSkgJiYgKG9wWzBdID09PSA2IHx8IG9wWzBdID09PSAyKSkgeyBfID0gMDsgY29udGludWU7IH1cclxuICAgICAgICAgICAgICAgICAgICBpZiAob3BbMF0gPT09IDMgJiYgKCF0IHx8IChvcFsxXSA+IHRbMF0gJiYgb3BbMV0gPCB0WzNdKSkpIHsgXy5sYWJlbCA9IG9wWzFdOyBicmVhazsgfVxyXG4gICAgICAgICAgICAgICAgICAgIGlmIChvcFswXSA9PT0gNiAmJiBfLmxhYmVsIDwgdFsxXSkgeyBfLmxhYmVsID0gdFsxXTsgdCA9IG9wOyBicmVhazsgfVxyXG4gICAgICAgICAgICAgICAgICAgIGlmICh0ICYmIF8ubGFiZWwgPCB0WzJdKSB7IF8ubGFiZWwgPSB0WzJdOyBfLm9wcy5wdXNoKG9wKTsgYnJlYWs7IH1cclxuICAgICAgICAgICAgICAgICAgICBpZiAodFsyXSkgXy5vcHMucG9wKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgXy50cnlzLnBvcCgpOyBjb250aW51ZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBvcCA9IGJvZHkuY2FsbCh0aGlzQXJnLCBfKTtcclxuICAgICAgICB9IGNhdGNoIChlKSB7IG9wID0gWzYsIGVdOyB5ID0gMDsgfSBmaW5hbGx5IHsgZiA9IHQgPSAwOyB9XHJcbiAgICAgICAgaWYgKG9wWzBdICYgNSkgdGhyb3cgb3BbMV07IHJldHVybiB7IHZhbHVlOiBvcFswXSA/IG9wWzFdIDogdm9pZCAwLCBkb25lOiB0cnVlIH07XHJcbiAgICB9XHJcbn07XHJcbmRlZmluZShbXCJyZXF1aXJlXCIsIFwiZXhwb3J0c1wiLCBcIi4vY29uZmlnXCIsIFwiLi9jYW52YXNcIiwgXCIuL3VwZGF0ZUNsaWVudFwiLCBcIi4vdXNlclwiXSwgZnVuY3Rpb24gKHJlcXVpcmUsIGV4cG9ydHMsIGNvbmZpZ18xLCBjYW52YXNfMSwgdXBkYXRlQ2xpZW50XzEsIHVzZXJfMSkge1xyXG4gICAgXCJ1c2Ugc3RyaWN0XCI7XHJcbiAgICB2YXIgX3RoaXMgPSB0aGlzO1xyXG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xyXG4gICAgdmFyIEJBVENIX1NJWkUgPSAzMDA7XHJcbiAgICB2YXIgTWFpbiA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHtcclxuICAgICAgICBmdW5jdGlvbiBNYWluKCkge1xyXG4gICAgICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xyXG4gICAgICAgICAgICB0aGlzLnJlY2VpdmVkVXBkYXRlcyA9IFtdOyAvLyBBc3N1bWUgZm9yIG5vdyB0aGV5IHNob3VsZCBiZSBvcmRlcmVkIGJ5IExTTiBhc2NcclxuICAgICAgICAgICAgdGhpcy5jYW52YXMgPSBuZXcgY2FudmFzXzEuQ2FudmFzKHtcclxuICAgICAgICAgICAgICAgIG9uUGl4ZWxVcGRhdGVzU3VibWl0dGVkOiB0aGlzLm9uUGl4ZWxVcGRhdGVzRnJvbVVJLmJpbmQodGhpcyksXHJcbiAgICAgICAgICAgICAgICBvbkRpc2FibGVkUGl4ZWxJbnNlcnQ6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoIV90aGlzLmlzTG9nZ2VkSW4oKSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBhbGVydChcIllvdSBtdXN0IGJlIGxvZ2dlZCBpbiB0byBpbnNlcnQgYSBwaXhlbC5cXG5DbGljayB0aGUgbG9naW4gYnV0dG9uIGluIHRoZSB0b3AgcmlnaHQgdG8gbG9naW4uXCIpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYWxlcnQoXCJZb3UgbXVzdCB3YWl0IFwiICsgX3RoaXMuZ2V0UmVtYWluaW5nTXNCZWZvcmVEcmF3KCkgLyAxMDAwICsgXCIgc2Vjb25kcyBiZWZvcmUgeW91ciBuZXh0IGluc2VydC5cIik7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIHRoaXMuaXNOb3cgPSBrby5vYnNlcnZhYmxlKGZhbHNlKTtcclxuICAgICAgICAgICAgdGhpcy5yZW1haW5pbmdUaW1lRGlzcGxheSA9IGtvLm9ic2VydmFibGUobnVsbCk7XHJcbiAgICAgICAgICAgIHRoaXMucmVtYWluaW5nVGltZURpc3BsYXkuc3Vic2NyaWJlKGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgIF90aGlzLmlzTm93KF90aGlzLmdldFJlbWFpbmluZ01zQmVmb3JlRHJhdygpIDw9IDApO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgdGhpcy5sb2dpblVybCA9IGtvLm9ic2VydmFibGUobnVsbCk7XHJcbiAgICAgICAgICAgIHRoaXMubG9nb3V0VXJsID0ga28ub2JzZXJ2YWJsZShudWxsKTtcclxuICAgICAgICAgICAgdGhpcy5pc0xvZ2dlZEluID0ga28ub2JzZXJ2YWJsZShmYWxzZSk7XHJcbiAgICAgICAgICAgIHRoaXMuaXNBZG1pbiA9IGtvLm9ic2VydmFibGUoZmFsc2UpO1xyXG4gICAgICAgICAgICB0aGlzLmlzRnJlZWhhbmREcmF3aW5nID0ga28ub2JzZXJ2YWJsZSh0aGlzLmNhbnZhcy5kcmF3TW9kZSgpID09PSBjYW52YXNfMS5EcmF3TW9kZXMuRnJlZWhhbmQpO1xyXG4gICAgICAgICAgICB0aGlzLmlzRnJlZWhhbmREcmF3aW5nLnN1YnNjcmliZShmdW5jdGlvbiAobmV3VmFsdWUpIHtcclxuICAgICAgICAgICAgICAgIF90aGlzLmNhbnZhcy5kcmF3TW9kZShuZXdWYWx1ZSA/IGNhbnZhc18xLkRyYXdNb2Rlcy5GcmVlaGFuZCA6IGNhbnZhc18xLkRyYXdNb2Rlcy5QaXhlbCk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB0aGlzLnRpbWVySWQgPSAwO1xyXG4gICAgICAgICAgICB0aGlzLmlzUHJlUmVsZWFzZU1vZGUgPSBrby5vYnNlcnZhYmxlKGZhbHNlKTtcclxuICAgICAgICAgICAgdGhpcy5pc1RyZW5kaW5nVHdlZXRzRW5hYmxlZCA9IGtvLm9ic2VydmFibGUoZmFsc2UpO1xyXG4gICAgICAgICAgICB0aGlzLmlzVHdlZXRQYW5lRXhwYW5kZWQgPSBrby5vYnNlcnZhYmxlKGZhbHNlKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgTWFpbi5wcm90b3R5cGUuaW5pdCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgdmFyIF9hLCBlXzE7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gX19nZW5lcmF0b3IodGhpcywgZnVuY3Rpb24gKF9iKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgc3dpdGNoIChfYi5sYWJlbCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDA6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnVwZGF0ZUNsaWVudCA9IG5ldyB1cGRhdGVDbGllbnRfMS5VcGRhdGVDbGllbnQoe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9uUmVjZWl2ZWQ6IHRoaXMub25QaXhlbFVwZGF0ZUZyb21SZW1vdGUuYmluZCh0aGlzKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gWzQgLyp5aWVsZCovLCB0aGlzLmZldGNoTWV0YWRhdGEoKV07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMTpcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9iLnNlbnQoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmlzUHJlUmVsZWFzZU1vZGUoKSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIERvbid0IGRvIGFueXRoaW5nIGVsc2UgaWYgd2UncmUgc3RpbGwgaW4gcHJlLXJlbGVhc2UgbW9kZS5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gWzIgLypyZXR1cm4qL107XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBUT0RPIFJlbW92ZSB0ZXN0IGNvZGVcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIHRoaXMuZ2V0Qm9hcmRFbmRwb2ludCA9ICdodHRwczovL3B4ZHJhd2J1aWxkMThkZXYuYmxvYi5jb3JlLndpbmRvd3MubmV0L2Rldi9ib2FyZDEnO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gdGhpcy53ZWJzb2NrZXRFbmRwb2ludCA9ICdodHRwczovL3B4ZHJhdy1idWlsZDE4LW5vdGlmY2F0aW9ucy5henVyZXdlYnNpdGVzLm5ldC9odWJzL25vdGlmaWNhdGlvbnMnO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gdGhpcy50b3BUd2VldHNFbmRwb2ludCA9ICdodHRwczovL3B4ZHJhd3dlc3R1cy1hcGkuYXp1cmV3ZWJzaXRlcy5uZXQvYXBpL3RvcC10d2VldHMnO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gdGhpcy51c2VyRW5kcG9pbnQgPSAnaHR0cDovL2JsYWgnO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gdGhpcy5sb2dpbkVuZHBvaW50ID0gJ2h0dHA6Ly9sb2dpbic7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyB0aGlzLmxvZ291dEVuZHBvaW50ID0gJ2h0dHA6Ly9sb2dvdXQnO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5sb2dpblVybCh0aGlzLmxvZ2luRW5kcG9pbnQpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5sb2dvdXRVcmwodGhpcy5sb2dvdXRFbmRwb2ludCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBfYi5sYWJlbCA9IDI7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMjpcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9iLnRyeXMucHVzaChbMiwgNCwgLCA1XSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBfYSA9IHRoaXM7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gWzQgLyp5aWVsZCovLCB1c2VyXzEuVXNlci5nZXRVc2VyKHRoaXMudXNlckVuZHBvaW50KV07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMzpcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9hLnVzZXIgPSBfYi5zZW50KCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBUT0RPIHJlbW92ZSB0ZXN0IGNvZGVcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIHRoaXMudXNlciA9IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vICAgICBpc0FkbWluOiB0cnVlLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gICAgIGxhc3RVcGRhdGU6IG5ldyBEYXRlKG5ldyBEYXRlKCkuZ2V0VGltZSgpIC0gMzAwMCksXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyAgICAgaWQ6ICd1c2VyaWQnXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyB9O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5pc0xvZ2dlZEluKHRydWUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5pc0FkbWluKHRoaXMudXNlci5pc0FkbWluKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZW5hYmxlRHJhdyh0cnVlKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuaXNGcmVlaGFuZERyYXdpbmcodGhpcy51c2VyLmlzQWRtaW4pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy51cGRhdGVOZXh0VXBkYXRlVGltZSh0aGlzLnVzZXIubGFzdFVwZGF0ZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gWzMgLypicmVhayovLCA1XTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSA0OlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZV8xID0gX2Iuc2VudCgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJVc2VyIGlzIG5vdCBsb2dnZWQgaW5cIik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gWzMgLypicmVhayovLCA1XTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSA1OlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFjb25maWdfMS5jb25maWcuaXNBdXRoUmVxdWlyZWQgfHwgdGhpcy5pc0xvZ2dlZEluKCkpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnVwZGF0ZUNsaWVudC5pbml0KHRoaXMud2Vic29ja2V0RW5kcG9pbnQpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gUGVyaW9kaWMgYm9hcmQgdXBkYXRlXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnVwZGF0ZUJvYXJkKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZXRJbnRlcnZhbCh0aGlzLnVwZGF0ZUJvYXJkLmJpbmQodGhpcyksIE1haW4uUkVGUkVTSF9CT0FSRF9ERUxBWV9NUyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmlzVHJlbmRpbmdUd2VldHNFbmFibGVkKGNvbmZpZ18xLmNvbmZpZy5pc1RyZW5kaW5nVHdlZXRzRW5hYmxlZCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5pc0xvZ2dlZEluKCkgJiYgIXRoaXMuaXNBZG1pbigpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5jYW52YXMuZXhlY3V0ZVpvb20oY2FudmFzXzEuQ2FudmFzLklOSVRJQUxfWk9PTSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gWzIgLypyZXR1cm4qL107XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH07XHJcbiAgICAgICAgTWFpbi5wcm90b3R5cGUucHJvY2Vzc0ZldGNoQm9hcmRSZXNwb25zZSA9IGZ1bmN0aW9uIChkYXRhKSB7XHJcbiAgICAgICAgICAgIHZhciBib2FyZDhVaW50ID0gTWFpbi51bnBhY2tCb2FyZEJsb2IobmV3IFVpbnQ4QXJyYXkoZGF0YSkpO1xyXG4gICAgICAgICAgICB0aGlzLmNhbnZhcy5xdWV1ZUJvYXJkVXBkYXRlKGJvYXJkOFVpbnQpO1xyXG4gICAgICAgIH07XHJcbiAgICAgICAgTWFpbi5wcm90b3R5cGUub25QaXhlbFVwZGF0ZUZyb21SZW1vdGUgPSBmdW5jdGlvbiAoZGF0YSkge1xyXG4gICAgICAgICAgICB0aGlzLnJlY2VpdmVkVXBkYXRlcy5wdXNoKGRhdGEpO1xyXG4gICAgICAgICAgICB0aGlzLmNhbnZhcy5xdWV1ZVBpeGVsVXBkYXRlKGRhdGEpO1xyXG4gICAgICAgIH07XHJcbiAgICAgICAgTWFpbi5wcm90b3R5cGUuZW5hYmxlRHJhdyA9IGZ1bmN0aW9uIChlbmFibGUpIHtcclxuICAgICAgICAgICAgaWYgKGVuYWJsZSkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5jYW52YXMuZHJhd01vZGUodGhpcy51c2VyLmlzQWRtaW4gPyBjYW52YXNfMS5EcmF3TW9kZXMuRnJlZWhhbmQgOiBjYW52YXNfMS5EcmF3TW9kZXMuUGl4ZWwpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgaWYgKCF0aGlzLnVzZXIuaXNBZG1pbikge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuY2FudmFzLmRyYXdNb2RlKGNhbnZhc18xLkRyYXdNb2Rlcy5EaXNhYmxlZCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG4gICAgICAgIC8qKlxyXG4gICAgICAgICAqIFVzZXIgc3VibWl0dGVkIHBpeGVsIHVwZGF0ZXMgdGhyb3VnaCBVSVxyXG4gICAgICAgICAqIEBwYXJhbSB1cGRhdGVzXHJcbiAgICAgICAgICovXHJcbiAgICAgICAgTWFpbi5wcm90b3R5cGUub25QaXhlbFVwZGF0ZXNGcm9tVUkgPSBmdW5jdGlvbiAodXBkYXRlcykge1xyXG4gICAgICAgICAgICB0aGlzLnN1Ym1pdFBpeGVsVXBkYXRlcyh1cGRhdGVzKS5jYXRjaChmdW5jdGlvbiAoZXJyKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKGVycik7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH07XHJcbiAgICAgICAgTWFpbi5wcm90b3R5cGUuc3RhcnRVcGRhdGVUaW1lciA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgY2xlYXJUaW1lb3V0KHRoaXMudGltZXJJZCk7XHJcbiAgICAgICAgICAgIHZhciByZW1haW5pbmdNcyA9IHRoaXMuZ2V0UmVtYWluaW5nTXNCZWZvcmVEcmF3KCk7XHJcbiAgICAgICAgICAgIGlmIChyZW1haW5pbmdNcyA8PSAwIHx8IHRoaXMuaXNBZG1pbigpKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmVuYWJsZURyYXcodHJ1ZSk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnJlbWFpbmluZ1RpbWVEaXNwbGF5KCdOb3chJyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmVuYWJsZURyYXcoZmFsc2UpO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5yZW1haW5pbmdUaW1lRGlzcGxheShNYXRoLmNlaWwocmVtYWluaW5nTXMgLyAxMDAwKSArIFwic1wiKTtcclxuICAgICAgICAgICAgICAgIHRoaXMudGltZXJJZCA9IHNldFRpbWVvdXQodGhpcy5zdGFydFVwZGF0ZVRpbWVyLmJpbmQodGhpcyksIE1haW4uVElNRV9VUERBVEVfTVMpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuICAgICAgICBNYWluLnByb3RvdHlwZS5nZXRSZW1haW5pbmdNc0JlZm9yZURyYXcgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIGlmICghdGhpcy5uZXh0VXBkYXRlVGltZSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIDA7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuIHRoaXMubmV4dFVwZGF0ZVRpbWUuZ2V0VGltZSgpIC0gbmV3IERhdGUoKS5nZXRUaW1lKCk7XHJcbiAgICAgICAgfTtcclxuICAgICAgICBNYWluLnByb3RvdHlwZS51cGRhdGVOZXh0VXBkYXRlVGltZSA9IGZ1bmN0aW9uIChsYXN0VXBkYXRlKSB7XHJcbiAgICAgICAgICAgIHRoaXMubmV4dFVwZGF0ZVRpbWUgPSBuZXcgRGF0ZSgpO1xyXG4gICAgICAgICAgICBpZiAobGFzdFVwZGF0ZSkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5uZXh0VXBkYXRlVGltZSA9IGxhc3RVcGRhdGU7XHJcbiAgICAgICAgICAgICAgICB0aGlzLm5leHRVcGRhdGVUaW1lLnNldFNlY29uZHModGhpcy5uZXh0VXBkYXRlVGltZS5nZXRTZWNvbmRzKCkgKyBNYWluLmRyYXdfZGVsYXlfcyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdGhpcy5zdGFydFVwZGF0ZVRpbWVyKCk7XHJcbiAgICAgICAgfTtcclxuICAgICAgICAvKipcclxuICAgICAgICAgKiBCb2FyZCBibG9iIGlzIGFuIGFycmF5IG9mIDQtYml0IGludGVnZXI6IDAtMTUgY29sb3IgaW5kZXggZm9yIGVhY2ggcGl4ZWwuXHJcbiAgICAgICAgICogQ29udmVydCB0aGlzIGludG8gYW4gZWFzaWVyIGFycmF5IHRvIHJlYWQuXHJcbiAgICAgICAgICpcclxuICAgICAgICAgKiBAcGFyYW0gYmxvYlxyXG4gICAgICAgICAqIEByZXR1cm4gcmVzdWx0IGlzIGEgW3dpZHRoICogaGVpZ2h0XSBhcnJheSBvZiAxLWJ5dGVcclxuICAgICAgICAgKi9cclxuICAgICAgICBNYWluLnVucGFja0JvYXJkQmxvYiA9IGZ1bmN0aW9uIChibG9iKSB7XHJcbiAgICAgICAgICAgIHZhciBzdGFydCA9IHBlcmZvcm1hbmNlLm5vdygpO1xyXG4gICAgICAgICAgICB2YXIgcmVzdWx0ID0gbmV3IFVpbnQ4QXJyYXkoY2FudmFzXzEuQ2FudmFzLkJPQVJEX1dJRFRIX1BYICogY2FudmFzXzEuQ2FudmFzLkJPQVJEX0hFSUdIVF9QWCk7XHJcbiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgYmxvYi5ieXRlTGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgICAgIHZhciBieXRlID0gYmxvYltpXTtcclxuICAgICAgICAgICAgICAgIHJlc3VsdFtpICogMl0gPSBieXRlID4+IDQ7XHJcbiAgICAgICAgICAgICAgICByZXN1bHRbaSAqIDIgKyAxXSA9IGJ5dGUgJiAweEY7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgY29uc29sZS5sb2coXCJ1bnBhY2tCb2FyZEJsb2I6IFwiICsgKHBlcmZvcm1hbmNlLm5vdygpIC0gc3RhcnQpICsgXCIgbXNcIik7XHJcbiAgICAgICAgICAgIHJldHVybiByZXN1bHQ7XHJcbiAgICAgICAgfTtcclxuICAgICAgICBNYWluLnByb3RvdHlwZS5mZXRjaE1ldGFkYXRhID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIF9fZ2VuZXJhdG9yKHRoaXMsIGZ1bmN0aW9uIChfYSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBbMiAvKnJldHVybiovLCBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkLmFqYXgoe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6ICdHRVQnLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVybDogY29uZmlnXzEuY29uZmlnLm1ldGFkYXRhRW5kcG9pbnQsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY3Jvc3NEb21haW46IHRydWUsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3VjY2VzczogZnVuY3Rpb24gKGRhdGEsIHRleHRTdGF0dXMsIGpxWEhSKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzLmxvZ2luRW5kcG9pbnQgPSBkYXRhLmxvZ2luRW5kcG9pbnQ7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzLmdldEJvYXJkRW5kcG9pbnQgPSBkYXRhLmdldEJvYXJkRW5kcG9pbnQ7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzLnVwZGF0ZVBpeGVsRW5kcG9pbnQgPSBkYXRhLnVwZGF0ZVBpeGVsRW5kcG9pbnQ7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzLndlYnNvY2tldEVuZHBvaW50ID0gZGF0YS53ZWJzb2NrZXRFbmRwb2ludDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXMudXNlckVuZHBvaW50ID0gZGF0YS51c2VyRW5kcG9pbnQ7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzLmxvZ291dEVuZHBvaW50ID0gZGF0YS5sb2dvdXRFbmRwb2ludDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXMudG9wVHdlZXRzRW5kcG9pbnQgPSBkYXRhLnRvcFR3ZWV0c0VuZHBvaW50O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBNYWluLmRyYXdfZGVsYXlfcyA9IGRhdGEudGhyb3R0bGVSYXRlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfdGhpcy5pc1ByZVJlbGVhc2VNb2RlKCEhKGRhdGEuaXNQcmVSZWxlYXNlKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVycm9yOiBmdW5jdGlvbiAoanFYSFIsIHRleHRTdGF0dXMsIGVycm9yVGhyb3duKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoXCJGYWlsZWQgdG8gZmV0Y2ggbWV0YWRhdGE6XCIgKyBlcnJvclRocm93bik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlamVjdChlcnJvclRocm93bik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pXTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9O1xyXG4gICAgICAgIE1haW4ucHJvdG90eXBlLmZldGNoQm9hcmQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XHJcbiAgICAgICAgICAgICAgICB2YXIgY3VycmVudExTTjtcclxuICAgICAgICAgICAgICAgIHJldHVybiBfX2dlbmVyYXRvcih0aGlzLCBmdW5jdGlvbiAoX2EpIHtcclxuICAgICAgICAgICAgICAgICAgICBjdXJyZW50TFNOID0gdGhpcy5yZWNlaXZlZFVwZGF0ZXMgJiYgdGhpcy5yZWNlaXZlZFVwZGF0ZXMubGVuZ3RoID4gMCA/XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucmVjZWl2ZWRVcGRhdGVzW3RoaXMucmVjZWl2ZWRVcGRhdGVzLmxlbmd0aCAtIDFdIDogMDtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gWzIgLypyZXR1cm4qLywgbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHhociA9IG5ldyBYTUxIdHRwUmVxdWVzdCgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIG5vbmNlID0gRGF0ZS5ub3coKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHhoci5vcGVuKCdHRVQnLCBfdGhpcy5nZXRCb2FyZEVuZHBvaW50ICsgXCI/dD1cIiArIG5vbmNlLCB0cnVlKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHhoci5yZXNwb25zZVR5cGUgPSAnYXJyYXlidWZmZXInO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgeGhyLmFkZEV2ZW50TGlzdGVuZXIoJ2xvYWQnLCBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHhoci5zdGF0dXMgPT09IDIwMCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIXhoci5yZXNwb25zZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcignRmV0Y2hpbmcgYm9hcmQgcmV0dXJuZWQgbm8gZGF0YScpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUoeyBib2FyZDogeGhyLnJlc3BvbnNlLCBsc246IGN1cnJlbnRMU04gfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB4aHIuc2VuZCgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KV07XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfTtcclxuICAgICAgICBNYWluLnByb3RvdHlwZS51cGRhdGVCb2FyZCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgdmFyIF90aGlzID0gdGhpcztcclxuICAgICAgICAgICAgdGhpcy5mZXRjaEJvYXJkKCkudGhlbihmdW5jdGlvbiAocmVzdWx0KSB7XHJcbiAgICAgICAgICAgICAgICBfdGhpcy5wcm9jZXNzRmV0Y2hCb2FyZFJlc3BvbnNlKHJlc3VsdC5ib2FyZCk7XHJcbiAgICAgICAgICAgICAgICBfdGhpcy5yZXBsYXlBbmRDbGVhbnVwVXBkYXRlcyhyZXN1bHQubHNuKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfTtcclxuICAgICAgICAvKipcclxuICAgICAgICAgKiBDdWxsIG9ic29sZXRlIGxzbidzXHJcbiAgICAgICAgICogQHBhcmFtIHN0YXJ0THNuXHJcbiAgICAgICAgICovXHJcbiAgICAgICAgTWFpbi5wcm90b3R5cGUucmVwbGF5QW5kQ2xlYW51cFVwZGF0ZXMgPSBmdW5jdGlvbiAoc3RhcnRMc24pIHtcclxuICAgICAgICAgICAgdmFyIHN0YXJ0ID0gcGVyZm9ybWFuY2Uubm93KCk7XHJcbiAgICAgICAgICAgIHZhciB2YWxpZFVwZGF0ZXMgPSBbXTtcclxuICAgICAgICAgICAgY29uc29sZS5sb2coXCJSZXBsYXlpbmcgXCIgKyB0aGlzLnJlY2VpdmVkVXBkYXRlcy5sZW5ndGggKyBcIiByZWNlaXZlZCB1cGRhdGVzXCIpO1xyXG4gICAgICAgICAgICB2YXIgY291bnQgPSAwO1xyXG4gICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMucmVjZWl2ZWRVcGRhdGVzLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgdXBkYXRlID0gdGhpcy5yZWNlaXZlZFVwZGF0ZXNbaV07XHJcbiAgICAgICAgICAgICAgICBpZiAoc3RhcnRMc24gPD0gdXBkYXRlLl9sc24pIHtcclxuICAgICAgICAgICAgICAgICAgICB2YWxpZFVwZGF0ZXMucHVzaCh1cGRhdGUpO1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuY2FudmFzLnF1ZXVlUGl4ZWxVcGRhdGUodXBkYXRlKTtcclxuICAgICAgICAgICAgICAgICAgICBjb3VudCsrO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHRoaXMucmVjZWl2ZWRVcGRhdGVzID0gdmFsaWRVcGRhdGVzO1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZyhcIlJlcGxheWVkIFwiICsgY291bnQgKyBcIiB1cGRhdGVzIHRvb2sgXCIgKyAocGVyZm9ybWFuY2Uubm93KCkgLSBzdGFydCkgKyBcIiBtc1wiKTtcclxuICAgICAgICB9O1xyXG4gICAgICAgIE1haW4ucHJvdG90eXBlLnN1Ym1pdFBpeGVsVXBkYXRlcyA9IGZ1bmN0aW9uICh1cGRhdGVzKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XHJcbiAgICAgICAgICAgICAgICB2YXIgcmVtYWluaW5nTXMsIGVycm9yLCBudW1iZXJPZkJhdGNoZXMsIF9sb29wXzEsIGk7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gX19nZW5lcmF0b3IodGhpcywgZnVuY3Rpb24gKF9hKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgc3dpdGNoIChfYS5sYWJlbCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDA6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZW1haW5pbmdNcyA9IHRoaXMuZ2V0UmVtYWluaW5nTXNCZWZvcmVEcmF3KCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocmVtYWluaW5nTXMgPiAwICYmICF0aGlzLnVzZXIuaXNBZG1pbikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVycm9yID0gXCJNdXN0IHdhaXQgYW5vdGhlciBcIiArIHJlbWFpbmluZ01zICsgXCJtc1wiO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBbMiAvKnJldHVybiovLCBQcm9taXNlLnJlamVjdChuZXcgRXJyb3IoZXJyb3IpKV07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcIlN1Ym1pdHRpbmcgXCIgKyB1cGRhdGVzLmxlbmd0aCArIFwiIHVwZGF0ZXNcIik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBudW1iZXJPZkJhdGNoZXMgPSB1cGRhdGVzLmxlbmd0aCAvIEJBVENIX1NJWkU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBfbG9vcF8xID0gZnVuY3Rpb24gKGkpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgZGF0YTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gX19nZW5lcmF0b3IodGhpcywgZnVuY3Rpb24gKF9hKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN3aXRjaCAoX2EubGFiZWwpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMDpcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhID0gSlNPTi5zdHJpbmdpZnkodXBkYXRlcy5zbGljZShpICogQkFUQ0hfU0laRSwgKGkgKyAxKSAqIEJBVENIX1NJWkUpKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gWzQgLyp5aWVsZCovLCBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkLmFqYXgoe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6ICdQT1NUJyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1cmw6IF90aGlzLnVwZGF0ZVBpeGVsRW5kcG9pbnQsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udGVudFR5cGU6IFwiYXBwbGljYXRpb24vanNvblwiLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHhockZpZWxkczoge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aXRoQ3JlZGVudGlhbHM6IHRydWVcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJlZm9yZVNlbmQ6IGZ1bmN0aW9uIChyZXF1ZXN0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjb25maWdfMS5jb25maWcuaXNMb2NhbCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gbG9jYWxseSwgd2Ugc3Bvb2YgdGhlIGhlYWRlclxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVxdWVzdC5zZXRSZXF1ZXN0SGVhZGVyKCd4LW1zLWNsaWVudC1wcmluY2lwYWwtaWQnLCBNYWluLkxPQ0FMSE9TVF9DTElFTlRfUFJJTkNJUEFMX0lEKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlcXVlc3Quc2V0UmVxdWVzdEhlYWRlcigneC1tcy1jbGllbnQtcHJpbmNpcGFsLWlkcCcsIE1haW4uTE9DQUxIT1NUX0NMSUVOVF9QUklOQ0lQQUxfSURQKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YTogZGF0YSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdWNjZXNzOiBmdW5jdGlvbiAoZGF0YSwgdGV4dFN0YXR1cywganFYSFIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJEYXRhOiBcIiArIGRhdGEgKyBcIlxcblN0YXR1czogXCIgKyB0ZXh0U3RhdHVzKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXMudXBkYXRlTmV4dFVwZGF0ZVRpbWUobmV3IERhdGUoKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlcnJvcjogZnVuY3Rpb24gKGpxWEhSLCB0ZXh0U3RhdHVzLCBlcnJvclRocm93bikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKFwiRmFpbGVkIHRvIHN1Ym1pdCBwaXhlbCB1cGRhdGU6XCIgKyBlcnJvclRocm93bik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIFRPRE8gUmVtb3ZlIHRlc3QgY29kZVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyB0aGlzLnVwZGF0ZU5leHRVcGRhdGVUaW1lKG5ldyBEYXRlKCkpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWplY3QoZXJyb3JUaHJvd24pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KV07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDE6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX2Euc2VudCgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBbMiAvKnJldHVybiovXTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGkgPSAwO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgX2EubGFiZWwgPSAxO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDE6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIShpIDwgbnVtYmVyT2ZCYXRjaGVzKSkgcmV0dXJuIFszIC8qYnJlYWsqLywgNF07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gWzUgLyp5aWVsZCoqLywgX2xvb3BfMShpKV07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMjpcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9hLnNlbnQoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9hLmxhYmVsID0gMztcclxuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAzOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaSsrO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFszIC8qYnJlYWsqLywgMV07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgNDogcmV0dXJuIFsyIC8qcmV0dXJuKi9dO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9O1xyXG4gICAgICAgIE1haW4ucHJvdG90eXBlLnVwZGF0ZVR3aXR0ZXJUcmVuZCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgdmFyIF90aGlzID0gdGhpcztcclxuICAgICAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcclxuICAgICAgICAgICAgICAgICQuYWpheCh7XHJcbiAgICAgICAgICAgICAgICAgICAgdHlwZTogJ0dFVCcsXHJcbiAgICAgICAgICAgICAgICAgICAgdXJsOiBfdGhpcy50b3BUd2VldHNFbmRwb2ludCxcclxuICAgICAgICAgICAgICAgICAgICBzdWNjZXNzOiBmdW5jdGlvbiAoZGF0YSwgdGV4dFN0YXR1cywganFYSFIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFBcnJheS5pc0FycmF5KGRhdGEpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKCdJbnZhbGlkIHR3aXR0ZXIgdHJlbmQgcmVjZWl2ZWQnKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlamVjdCgnUmVzdWx0cyBub3QgYW4gQXJyYXknKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgdHdlZXRzUGFyZW50RWx0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3R3ZWV0cycpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgb2xkQ2hpbGRyZW5Db3VudCA9IHR3ZWV0c1BhcmVudEVsdC5jaGlsZEVsZW1lbnRDb3VudDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHByb21pc2VzID0gW107XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICQuZWFjaChkYXRhLCBmdW5jdGlvbiAoaW5kZXgsIHRyZW5kKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBUaGlzIGFkZHMgY2hpbGRyZW4gdG8gdHdlZXRzUGFyZW50RWx0IGFzeW5jaHJvbm91c2x5XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgcCA9IHR3dHRyLndpZGdldHMuY3JlYXRlVHdlZXQodHJlbmQuaWQsIHR3ZWV0c1BhcmVudEVsdCwgeyBjb252ZXJzYXRpb246ICdub25lJywgd2lkdGg6IDQwMCB9KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByb21pc2VzLnB1c2gocCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAoZnVuY3Rpb24gKCkgeyByZXR1cm4gX19hd2FpdGVyKF90aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gX19nZW5lcmF0b3IodGhpcywgZnVuY3Rpb24gKF9hKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3dpdGNoIChfYS5sYWJlbCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDA6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfYS50cnlzLnB1c2goWzAsICwgMiwgM10pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFs0IC8qeWllbGQqLywgUHJvbWlzZS5hbGwocHJvbWlzZXMpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gTXVzdCBwYXJ0IHdpdGggdGhlIG9sZCBjaGlsZHJlbiA6KFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAxOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX2Euc2VudCgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gTXVzdCBwYXJ0IHdpdGggdGhlIG9sZCBjaGlsZHJlbiA6KFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChpID0gMDsgaSA8IG9sZENoaWxkcmVuQ291bnQ7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR3ZWV0c1BhcmVudEVsdC5yZW1vdmVDaGlsZCh0d2VldHNQYXJlbnRFbHQuZmlyc3RDaGlsZCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gWzMgLypicmVhayovLCAzXTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAyOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFs3IC8qZW5kZmluYWxseSovXTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAzOiByZXR1cm4gWzIgLypyZXR1cm4qL107XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pOyB9KSgpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgZXJyb3I6IGZ1bmN0aW9uIChqcVhIUiwgdGV4dFN0YXR1cywgZXJyb3JUaHJvd24pIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcihcIkZhaWxlZCB0byBnZXQgdHJlbmQ6XCIgKyBlcnJvclRocm93bik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlamVjdChlcnJvclRocm93bik7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH07XHJcbiAgICAgICAgTWFpbi5wcm90b3R5cGUudG9nZ2xlVHdlZXRQYW5lID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICB0aGlzLmlzVHdlZXRQYW5lRXhwYW5kZWQoIXRoaXMuaXNUd2VldFBhbmVFeHBhbmRlZCgpKTtcclxuICAgICAgICAgICAgaWYgKGNvbmZpZ18xLmNvbmZpZy5pc1RyZW5kaW5nVHdlZXRzRW5hYmxlZCAmJiB0aGlzLmlzVHdlZXRQYW5lRXhwYW5kZWQoKSkge1xyXG4gICAgICAgICAgICAgICAgdmFyIHBhcmVudEVsdCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwidHdlZXQtYXJlYTJcIik7XHJcbiAgICAgICAgICAgICAgICBpZiAocGFyZW50RWx0LmNoaWxkRWxlbWVudENvdW50ID09PSAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gQ3JlYXRlIHR3aXR0ZXIgYnV0dG9uIGF0IHJ1bi10aW1lLCBiZWNhdXNlIGJ1dHRvbiB3b24ndCBzaXplIHByb3Blcmx5IGlmIGluaXRpYWwgY29udGFpbmVyIHZpc2libGUgaXMgbm9uZVxyXG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdhZGRpbmcgYnV0dG9uJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgdHd0dHIud2lkZ2V0cy5jcmVhdGVIYXNodGFnQnV0dG9uKCdDb3Ntb3NEQicsIHBhcmVudEVsdCwge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBzaXplOiAnbGFyZ2UnLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICB0ZXh0OiAnRHJhd2luZyAjPHVzZSBhIGhhc2h0YWcgdG8gZGVzY3JpYmUgeW91ciBlZmZvcnQ+IHdpdGggbG92ZSBvbicsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGhhc2h0YWdzOiAnQXp1cmUsUHhEcmF3J1xyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgdGhpcy51cGRhdGVUd2l0dGVyVHJlbmQoKTtcclxuICAgICAgICAgICAgICAgIHRoaXMudHdpdHRlclVwZGF0ZUlkID0gc2V0SW50ZXJ2YWwodGhpcy51cGRhdGVUd2l0dGVyVHJlbmQuYmluZCh0aGlzKSwgTWFpbi5SRUZSRVNIX1RXSVRURVJfVFJFTkRTX01JTiAqIDYwICogMTAwMCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBjbGVhckludGVydmFsKHRoaXMudHdpdHRlclVwZGF0ZUlkKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcbiAgICAgICAgTWFpbi5MT0NBTEhPU1RfQ0xJRU5UX1BSSU5DSVBBTF9JRCA9ICdQcmluY2ljYWxJZCc7XHJcbiAgICAgICAgTWFpbi5MT0NBTEhPU1RfQ0xJRU5UX1BSSU5DSVBBTF9JRFAgPSAnYWFkJzsgLy8gdXNlIHR3aXR0ZXIgZm9yIG5vbi1hZG1pblxyXG4gICAgICAgIE1haW4uUkVGUkVTSF9CT0FSRF9ERUxBWV9NUyA9IDMwMDAwO1xyXG4gICAgICAgIE1haW4uZHJhd19kZWxheV9zID0gMzA7XHJcbiAgICAgICAgTWFpbi5USU1FX1VQREFURV9NUyA9IDEwMDA7IC8vIFVwZGF0ZSBldmVyeSBzZWNvbmRcclxuICAgICAgICBNYWluLlJFRlJFU0hfVFdJVFRFUl9UUkVORFNfTUlOID0gMTtcclxuICAgICAgICByZXR1cm4gTWFpbjtcclxuICAgIH0oKSk7XHJcbiAgICBleHBvcnRzLk1haW4gPSBNYWluO1xyXG4gICAgJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24gKCkgeyByZXR1cm4gX19hd2FpdGVyKF90aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHZhciBtYWluO1xyXG4gICAgICAgIHJldHVybiBfX2dlbmVyYXRvcih0aGlzLCBmdW5jdGlvbiAoX2EpIHtcclxuICAgICAgICAgICAgc3dpdGNoIChfYS5sYWJlbCkge1xyXG4gICAgICAgICAgICAgICAgY2FzZSAwOlxyXG4gICAgICAgICAgICAgICAgICAgIG1haW4gPSBuZXcgTWFpbigpO1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBbNCAvKnlpZWxkKi8sIG1haW4uaW5pdCgpXTtcclxuICAgICAgICAgICAgICAgIGNhc2UgMTpcclxuICAgICAgICAgICAgICAgICAgICBfYS5zZW50KCk7XHJcbiAgICAgICAgICAgICAgICAgICAga28uYXBwbHlCaW5kaW5ncyhtYWluKTtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gWzIgLypyZXR1cm4qL107XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgIH0pOyB9KTtcclxufSk7XHJcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPW1haW4uanMubWFwIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///11\n')},function(module,exports,__webpack_require__){eval('var __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n};\r\nvar __generator = (this && this.__generator) || function (thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), "throw": verb(1), "return": verb(2) }, typeof Symbol === "function" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError("Generator is already executing.");\r\n        while (_) try {\r\n            if (f = 1, y && (t = y[op[0] & 2 ? "return" : op[0] ? "throw" : "next"]) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [0, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n};\r\n!(__WEBPACK_AMD_DEFINE_ARRAY__ = [__webpack_require__, exports, __webpack_require__(10), __webpack_require__(11)], __WEBPACK_AMD_DEFINE_RESULT__ = (function (require, exports, config_1, main_1) {\r\n    "use strict";\r\n    Object.defineProperty(exports, "__esModule", { value: true });\r\n    var User = /** @class */ (function () {\r\n        function User(user) {\r\n            this.id = user.id;\r\n            this.lastUpdate = user.lastUpdate;\r\n            this.isAdmin = user.isAdmin;\r\n        }\r\n        User.getUser = function (userEndpoint) {\r\n            return __awaiter(this, void 0, void 0, function () {\r\n                return __generator(this, function (_a) {\r\n                    return [2 /*return*/, new Promise(function (resolve, reject) {\r\n                            $.ajax({\r\n                                type: \'GET\',\r\n                                url: userEndpoint,\r\n                                xhrFields: {\r\n                                    withCredentials: true\r\n                                },\r\n                                beforeSend: function (request) {\r\n                                    if (config_1.config.isLocal) {\r\n                                        // locally, we spoof the header\r\n                                        request.setRequestHeader(\'x-ms-client-principal-id\', main_1.Main.LOCALHOST_CLIENT_PRINCIPAL_ID);\r\n                                        request.setRequestHeader(\'x-ms-client-principal-idp\', main_1.Main.LOCALHOST_CLIENT_PRINCIPAL_IDP);\r\n                                    }\r\n                                },\r\n                                success: function (data, textStatus, jqXHR) {\r\n                                    resolve(new User(data));\r\n                                },\r\n                                error: function (jqXHR, textStatus, errorThrown) {\r\n                                    console.error("Failed to fetch user:" + errorThrown);\r\n                                    reject(errorThrown);\r\n                                }\r\n                            });\r\n                        })];\r\n                });\r\n            });\r\n        };\r\n        return User;\r\n    }());\r\n    exports.User = User;\r\n}).apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__),\n\t\t\t\t__WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\r\n//# sourceMappingURL=user.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9idWlsdC91c2VyLmpzPzAyNjAiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBLG1DQUFtQyxNQUFNLDZCQUE2QixFQUFFLFlBQVksV0FBVyxFQUFFO0FBQ2pHLGtDQUFrQyxNQUFNLGlDQUFpQyxFQUFFLFlBQVksV0FBVyxFQUFFO0FBQ3BHLCtCQUErQixpRUFBaUUsdUJBQXVCLEVBQUUsNEJBQTRCO0FBQ3JKO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQSxhQUFhLDZCQUE2QiwwQkFBMEIsYUFBYSxFQUFFLHFCQUFxQjtBQUN4RyxnQkFBZ0IscURBQXFELG9FQUFvRSxhQUFhLEVBQUU7QUFDeEosc0JBQXNCLHNCQUFzQixxQkFBcUIsR0FBRztBQUNwRTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx1Q0FBdUM7QUFDdkMsa0NBQWtDLFNBQVM7QUFDM0Msa0NBQWtDLFdBQVcsVUFBVTtBQUN2RCx5Q0FBeUMsY0FBYztBQUN2RDtBQUNBLDZHQUE2RyxPQUFPLFVBQVU7QUFDOUgsZ0ZBQWdGLGlCQUFpQixPQUFPO0FBQ3hHLHdEQUF3RCxnQkFBZ0IsUUFBUSxPQUFPO0FBQ3ZGLDhDQUE4QyxnQkFBZ0IsZ0JBQWdCLE9BQU87QUFDckY7QUFDQSxpQ0FBaUM7QUFDakM7QUFDQTtBQUNBLFNBQVMsWUFBWSxhQUFhLE9BQU8sRUFBRSxVQUFVLFdBQVc7QUFDaEUsbUNBQW1DLFNBQVM7QUFDNUM7QUFDQTtBQUNBO0FBQ0E7QUFDQSxrREFBa0QsY0FBYztBQUNoRTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQ0FBaUM7QUFDakM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUNBQWlDO0FBQ2pDO0FBQ0E7QUFDQSxpQ0FBaUM7QUFDakM7QUFDQTtBQUNBO0FBQ0E7QUFDQSw2QkFBNkI7QUFDN0IseUJBQXlCO0FBQ3pCLGlCQUFpQjtBQUNqQixhQUFhO0FBQ2I7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBLENBQUM7QUFBQTtBQUNEIiwiZmlsZSI6IjEyLmpzIiwic291cmNlc0NvbnRlbnQiOlsidmFyIF9fYXdhaXRlciA9ICh0aGlzICYmIHRoaXMuX19hd2FpdGVyKSB8fCBmdW5jdGlvbiAodGhpc0FyZywgX2FyZ3VtZW50cywgUCwgZ2VuZXJhdG9yKSB7XHJcbiAgICByZXR1cm4gbmV3IChQIHx8IChQID0gUHJvbWlzZSkpKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcclxuICAgICAgICBmdW5jdGlvbiBmdWxmaWxsZWQodmFsdWUpIHsgdHJ5IHsgc3RlcChnZW5lcmF0b3IubmV4dCh2YWx1ZSkpOyB9IGNhdGNoIChlKSB7IHJlamVjdChlKTsgfSB9XHJcbiAgICAgICAgZnVuY3Rpb24gcmVqZWN0ZWQodmFsdWUpIHsgdHJ5IHsgc3RlcChnZW5lcmF0b3JbXCJ0aHJvd1wiXSh2YWx1ZSkpOyB9IGNhdGNoIChlKSB7IHJlamVjdChlKTsgfSB9XHJcbiAgICAgICAgZnVuY3Rpb24gc3RlcChyZXN1bHQpIHsgcmVzdWx0LmRvbmUgPyByZXNvbHZlKHJlc3VsdC52YWx1ZSkgOiBuZXcgUChmdW5jdGlvbiAocmVzb2x2ZSkgeyByZXNvbHZlKHJlc3VsdC52YWx1ZSk7IH0pLnRoZW4oZnVsZmlsbGVkLCByZWplY3RlZCk7IH1cclxuICAgICAgICBzdGVwKChnZW5lcmF0b3IgPSBnZW5lcmF0b3IuYXBwbHkodGhpc0FyZywgX2FyZ3VtZW50cyB8fCBbXSkpLm5leHQoKSk7XHJcbiAgICB9KTtcclxufTtcclxudmFyIF9fZ2VuZXJhdG9yID0gKHRoaXMgJiYgdGhpcy5fX2dlbmVyYXRvcikgfHwgZnVuY3Rpb24gKHRoaXNBcmcsIGJvZHkpIHtcclxuICAgIHZhciBfID0geyBsYWJlbDogMCwgc2VudDogZnVuY3Rpb24oKSB7IGlmICh0WzBdICYgMSkgdGhyb3cgdFsxXTsgcmV0dXJuIHRbMV07IH0sIHRyeXM6IFtdLCBvcHM6IFtdIH0sIGYsIHksIHQsIGc7XHJcbiAgICByZXR1cm4gZyA9IHsgbmV4dDogdmVyYigwKSwgXCJ0aHJvd1wiOiB2ZXJiKDEpLCBcInJldHVyblwiOiB2ZXJiKDIpIH0sIHR5cGVvZiBTeW1ib2wgPT09IFwiZnVuY3Rpb25cIiAmJiAoZ1tTeW1ib2wuaXRlcmF0b3JdID0gZnVuY3Rpb24oKSB7IHJldHVybiB0aGlzOyB9KSwgZztcclxuICAgIGZ1bmN0aW9uIHZlcmIobikgeyByZXR1cm4gZnVuY3Rpb24gKHYpIHsgcmV0dXJuIHN0ZXAoW24sIHZdKTsgfTsgfVxyXG4gICAgZnVuY3Rpb24gc3RlcChvcCkge1xyXG4gICAgICAgIGlmIChmKSB0aHJvdyBuZXcgVHlwZUVycm9yKFwiR2VuZXJhdG9yIGlzIGFscmVhZHkgZXhlY3V0aW5nLlwiKTtcclxuICAgICAgICB3aGlsZSAoXykgdHJ5IHtcclxuICAgICAgICAgICAgaWYgKGYgPSAxLCB5ICYmICh0ID0geVtvcFswXSAmIDIgPyBcInJldHVyblwiIDogb3BbMF0gPyBcInRocm93XCIgOiBcIm5leHRcIl0pICYmICEodCA9IHQuY2FsbCh5LCBvcFsxXSkpLmRvbmUpIHJldHVybiB0O1xyXG4gICAgICAgICAgICBpZiAoeSA9IDAsIHQpIG9wID0gWzAsIHQudmFsdWVdO1xyXG4gICAgICAgICAgICBzd2l0Y2ggKG9wWzBdKSB7XHJcbiAgICAgICAgICAgICAgICBjYXNlIDA6IGNhc2UgMTogdCA9IG9wOyBicmVhaztcclxuICAgICAgICAgICAgICAgIGNhc2UgNDogXy5sYWJlbCsrOyByZXR1cm4geyB2YWx1ZTogb3BbMV0sIGRvbmU6IGZhbHNlIH07XHJcbiAgICAgICAgICAgICAgICBjYXNlIDU6IF8ubGFiZWwrKzsgeSA9IG9wWzFdOyBvcCA9IFswXTsgY29udGludWU7XHJcbiAgICAgICAgICAgICAgICBjYXNlIDc6IG9wID0gXy5vcHMucG9wKCk7IF8udHJ5cy5wb3AoKTsgY29udGludWU7XHJcbiAgICAgICAgICAgICAgICBkZWZhdWx0OlxyXG4gICAgICAgICAgICAgICAgICAgIGlmICghKHQgPSBfLnRyeXMsIHQgPSB0Lmxlbmd0aCA+IDAgJiYgdFt0Lmxlbmd0aCAtIDFdKSAmJiAob3BbMF0gPT09IDYgfHwgb3BbMF0gPT09IDIpKSB7IF8gPSAwOyBjb250aW51ZTsgfVxyXG4gICAgICAgICAgICAgICAgICAgIGlmIChvcFswXSA9PT0gMyAmJiAoIXQgfHwgKG9wWzFdID4gdFswXSAmJiBvcFsxXSA8IHRbM10pKSkgeyBfLmxhYmVsID0gb3BbMV07IGJyZWFrOyB9XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKG9wWzBdID09PSA2ICYmIF8ubGFiZWwgPCB0WzFdKSB7IF8ubGFiZWwgPSB0WzFdOyB0ID0gb3A7IGJyZWFrOyB9XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHQgJiYgXy5sYWJlbCA8IHRbMl0pIHsgXy5sYWJlbCA9IHRbMl07IF8ub3BzLnB1c2gob3ApOyBicmVhazsgfVxyXG4gICAgICAgICAgICAgICAgICAgIGlmICh0WzJdKSBfLm9wcy5wb3AoKTtcclxuICAgICAgICAgICAgICAgICAgICBfLnRyeXMucG9wKCk7IGNvbnRpbnVlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIG9wID0gYm9keS5jYWxsKHRoaXNBcmcsIF8pO1xyXG4gICAgICAgIH0gY2F0Y2ggKGUpIHsgb3AgPSBbNiwgZV07IHkgPSAwOyB9IGZpbmFsbHkgeyBmID0gdCA9IDA7IH1cclxuICAgICAgICBpZiAob3BbMF0gJiA1KSB0aHJvdyBvcFsxXTsgcmV0dXJuIHsgdmFsdWU6IG9wWzBdID8gb3BbMV0gOiB2b2lkIDAsIGRvbmU6IHRydWUgfTtcclxuICAgIH1cclxufTtcclxuZGVmaW5lKFtcInJlcXVpcmVcIiwgXCJleHBvcnRzXCIsIFwiLi9jb25maWdcIiwgXCIuL21haW5cIl0sIGZ1bmN0aW9uIChyZXF1aXJlLCBleHBvcnRzLCBjb25maWdfMSwgbWFpbl8xKSB7XHJcbiAgICBcInVzZSBzdHJpY3RcIjtcclxuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcclxuICAgIHZhciBVc2VyID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIGZ1bmN0aW9uIFVzZXIodXNlcikge1xyXG4gICAgICAgICAgICB0aGlzLmlkID0gdXNlci5pZDtcclxuICAgICAgICAgICAgdGhpcy5sYXN0VXBkYXRlID0gdXNlci5sYXN0VXBkYXRlO1xyXG4gICAgICAgICAgICB0aGlzLmlzQWRtaW4gPSB1c2VyLmlzQWRtaW47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIFVzZXIuZ2V0VXNlciA9IGZ1bmN0aW9uICh1c2VyRW5kcG9pbnQpIHtcclxuICAgICAgICAgICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIF9fZ2VuZXJhdG9yKHRoaXMsIGZ1bmN0aW9uIChfYSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBbMiAvKnJldHVybiovLCBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkLmFqYXgoe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6ICdHRVQnLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVybDogdXNlckVuZHBvaW50LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHhockZpZWxkczoge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aXRoQ3JlZGVudGlhbHM6IHRydWVcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJlZm9yZVNlbmQ6IGZ1bmN0aW9uIChyZXF1ZXN0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjb25maWdfMS5jb25maWcuaXNMb2NhbCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gbG9jYWxseSwgd2Ugc3Bvb2YgdGhlIGhlYWRlclxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVxdWVzdC5zZXRSZXF1ZXN0SGVhZGVyKCd4LW1zLWNsaWVudC1wcmluY2lwYWwtaWQnLCBtYWluXzEuTWFpbi5MT0NBTEhPU1RfQ0xJRU5UX1BSSU5DSVBBTF9JRCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXF1ZXN0LnNldFJlcXVlc3RIZWFkZXIoJ3gtbXMtY2xpZW50LXByaW5jaXBhbC1pZHAnLCBtYWluXzEuTWFpbi5MT0NBTEhPU1RfQ0xJRU5UX1BSSU5DSVBBTF9JRFApO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdWNjZXNzOiBmdW5jdGlvbiAoZGF0YSwgdGV4dFN0YXR1cywganFYSFIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShuZXcgVXNlcihkYXRhKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlcnJvcjogZnVuY3Rpb24gKGpxWEhSLCB0ZXh0U3RhdHVzLCBlcnJvclRocm93bikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKFwiRmFpbGVkIHRvIGZldGNoIHVzZXI6XCIgKyBlcnJvclRocm93bik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlamVjdChlcnJvclRocm93bik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pXTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9O1xyXG4gICAgICAgIHJldHVybiBVc2VyO1xyXG4gICAgfSgpKTtcclxuICAgIGV4cG9ydHMuVXNlciA9IFVzZXI7XHJcbn0pO1xyXG4vLyMgc291cmNlTWFwcGluZ1VSTD11c2VyLmpzLm1hcCJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///12\n')},function(module,__webpack_exports__,__webpack_require__){"use strict";eval('__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var _Errors__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(3);\n/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "HttpError", function() { return _Errors__WEBPACK_IMPORTED_MODULE_0__["a"]; });\n\n/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "TimeoutError", function() { return _Errors__WEBPACK_IMPORTED_MODULE_0__["b"]; });\n\n/* harmony import */ var _HttpClient__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(7);\n/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "HttpResponse", function() { return _HttpClient__WEBPACK_IMPORTED_MODULE_1__["c"]; });\n\n/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "HttpClient", function() { return _HttpClient__WEBPACK_IMPORTED_MODULE_1__["b"]; });\n\n/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "DefaultHttpClient", function() { return _HttpClient__WEBPACK_IMPORTED_MODULE_1__["a"]; });\n\n/* harmony import */ var _HttpConnection__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(6);\n/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "HttpConnection", function() { return _HttpConnection__WEBPACK_IMPORTED_MODULE_2__["a"]; });\n\n/* harmony import */ var _HubConnection__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(8);\n/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "JsonHubProtocol", function() { return _HubConnection__WEBPACK_IMPORTED_MODULE_3__["b"]; });\n\n/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "HubConnection", function() { return _HubConnection__WEBPACK_IMPORTED_MODULE_3__["a"]; });\n\n/* harmony import */ var _IHubProtocol__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(9);\n/* harmony import */ var _IHubProtocol__WEBPACK_IMPORTED_MODULE_4___default = /*#__PURE__*/__webpack_require__.n(_IHubProtocol__WEBPACK_IMPORTED_MODULE_4__);\n/* harmony reexport (unknown) */ for(var __WEBPACK_IMPORT_KEY__ in _IHubProtocol__WEBPACK_IMPORTED_MODULE_4__) if(["HttpError","TimeoutError","HttpResponse","HttpClient","DefaultHttpClient","HttpConnection","JsonHubProtocol","HubConnection","default"].indexOf(__WEBPACK_IMPORT_KEY__) < 0) (function(key) { __webpack_require__.d(__webpack_exports__, key, function() { return _IHubProtocol__WEBPACK_IMPORTED_MODULE_4__[key]; }) }(__WEBPACK_IMPORT_KEY__));\n/* harmony import */ var _ILogger__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(0);\n/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "LogLevel", function() { return _ILogger__WEBPACK_IMPORTED_MODULE_5__["a"]; });\n\n/* harmony import */ var _Loggers__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(4);\n/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "NullLogger", function() { return _Loggers__WEBPACK_IMPORTED_MODULE_6__["c"]; });\n\n/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "ConsoleLogger", function() { return _Loggers__WEBPACK_IMPORTED_MODULE_6__["a"]; });\n\n/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "LoggerFactory", function() { return _Loggers__WEBPACK_IMPORTED_MODULE_6__["b"]; });\n\n/* harmony import */ var _Transports__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(1);\n/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "TransportType", function() { return _Transports__WEBPACK_IMPORTED_MODULE_7__["d"]; });\n\n/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "TransferFormat", function() { return _Transports__WEBPACK_IMPORTED_MODULE_7__["c"]; });\n\n/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "WebSocketTransport", function() { return _Transports__WEBPACK_IMPORTED_MODULE_7__["e"]; });\n\n/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "ServerSentEventsTransport", function() { return _Transports__WEBPACK_IMPORTED_MODULE_7__["b"]; });\n\n/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "LongPollingTransport", function() { return _Transports__WEBPACK_IMPORTED_MODULE_7__["a"]; });\n\n/* harmony import */ var _Observable__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(5);\n/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "Subscription", function() { return _Observable__WEBPACK_IMPORTED_MODULE_8__["b"]; });\n\n/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "Subject", function() { return _Observable__WEBPACK_IMPORTED_MODULE_8__["a"]; });\n\n// Copyright (c) .NET Foundation. All rights reserved.\r\n// Licensed under the Apache License, Version 2.0. See License.txt in the project root for license information.\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n//# sourceMappingURL=index.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9ub2RlX21vZHVsZXMvQGFzcG5ldC9zaWduYWxyL2Rpc3QvZXNtL2luZGV4LmpzPzFhOWEiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBIiwiZmlsZSI6IjEzLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLy8gQ29weXJpZ2h0IChjKSAuTkVUIEZvdW5kYXRpb24uIEFsbCByaWdodHMgcmVzZXJ2ZWQuXHJcbi8vIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAuIFNlZSBMaWNlbnNlLnR4dCBpbiB0aGUgcHJvamVjdCByb290IGZvciBsaWNlbnNlIGluZm9ybWF0aW9uLlxyXG5leHBvcnQgKiBmcm9tIFwiLi9FcnJvcnNcIjtcclxuZXhwb3J0ICogZnJvbSBcIi4vSHR0cENsaWVudFwiO1xyXG5leHBvcnQgKiBmcm9tIFwiLi9IdHRwQ29ubmVjdGlvblwiO1xyXG5leHBvcnQgKiBmcm9tIFwiLi9IdWJDb25uZWN0aW9uXCI7XHJcbmV4cG9ydCAqIGZyb20gXCIuL0lIdWJQcm90b2NvbFwiO1xyXG5leHBvcnQgKiBmcm9tIFwiLi9JTG9nZ2VyXCI7XHJcbmV4cG9ydCAqIGZyb20gXCIuL0xvZ2dlcnNcIjtcclxuZXhwb3J0ICogZnJvbSBcIi4vVHJhbnNwb3J0c1wiO1xyXG5leHBvcnQgKiBmcm9tIFwiLi9PYnNlcnZhYmxlXCI7XHJcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWluZGV4LmpzLm1hcCJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///13\n')},function(module,exports,__webpack_require__){eval('var __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;!(__WEBPACK_AMD_DEFINE_ARRAY__ = [__webpack_require__, exports, __webpack_require__(13)], __WEBPACK_AMD_DEFINE_RESULT__ = (function (require, exports, signalR) {\r\n    "use strict";\r\n    Object.defineProperty(exports, "__esModule", { value: true });\r\n    var UpdateClient = /** @class */ (function () {\r\n        function UpdateClient(params) {\r\n            this.params = params;\r\n        }\r\n        /**\r\n         * Initialize\r\n         * @param url\r\n         */\r\n        UpdateClient.prototype.init = function (url) {\r\n            var _this = this;\r\n            var options = {\r\n                logger: new signalR.ConsoleLogger(signalR.LogLevel.Trace)\r\n            };\r\n            this.connection = new signalR.HubConnection(url, options);\r\n            this.connection.on(\'Changes\', function (data) {\r\n                if (!data) {\r\n                    return;\r\n                }\r\n                try {\r\n                    var docs = UpdateClient.smoosh(JSON.parse(data));\r\n                    if (!Array.isArray(docs)) {\r\n                        console.error("Change data not an array " + docs);\r\n                        return;\r\n                    }\r\n                    if (docs.length < 1) {\r\n                        console.error("Change data is empty");\r\n                        return;\r\n                    }\r\n                    console.log("Received " + docs.length + " updates");\r\n                    for (var _i = 0, docs_1 = docs; _i < docs_1.length; _i++) {\r\n                        var doc = docs_1[_i];\r\n                        _this.params.onReceived(doc);\r\n                    }\r\n                }\r\n                catch (e) {\r\n                    console.error("Failed to parse change data: " + e);\r\n                    return;\r\n                }\r\n            });\r\n            return this.connection.start();\r\n        };\r\n        /**\r\n         * Check if object is instance of OnPixelUpdateData\r\n         * @param object\r\n         */\r\n        UpdateClient.isOnPixelUpdateData = function (object) {\r\n            return \'x\' in object && \'y\' in object && \'color\' in object && \'_lsn\' in object;\r\n        };\r\n        UpdateClient.smoosh = function (docs) {\r\n            var updates = [];\r\n            if (!Array.isArray(docs)) {\r\n                throw new Error("Not an array");\r\n            }\r\n            for (var _i = 0, docs_2 = docs; _i < docs_2.length; _i++) {\r\n                var doc = docs_2[_i];\r\n                if (doc.items !== undefined) {\r\n                    for (var _a = 0, _b = doc.items; _a < _b.length; _a++) {\r\n                        var pixel = _b[_a];\r\n                        updates.push(pixel);\r\n                    }\r\n                }\r\n                else {\r\n                    updates.push(doc);\r\n                }\r\n            }\r\n            return updates;\r\n        };\r\n        return UpdateClient;\r\n    }());\r\n    exports.UpdateClient = UpdateClient;\r\n}).apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__),\n\t\t\t\t__WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\r\n//# sourceMappingURL=updateClient.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9idWlsdC91cGRhdGVDbGllbnQuanM/MWE2ZSJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiZ0VBQUE7QUFDQTtBQUNBLGtEQUFrRCxjQUFjO0FBQ2hFO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxtREFBbUQsb0JBQW9CO0FBQ3ZFO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDJDQUEyQyxvQkFBb0I7QUFDL0Q7QUFDQTtBQUNBLG9EQUFvRCxnQkFBZ0I7QUFDcEU7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBLENBQUM7QUFBQTtBQUNEIiwiZmlsZSI6IjE0LmpzIiwic291cmNlc0NvbnRlbnQiOlsiZGVmaW5lKFtcInJlcXVpcmVcIiwgXCJleHBvcnRzXCIsIFwiQGFzcG5ldC9zaWduYWxyXCJdLCBmdW5jdGlvbiAocmVxdWlyZSwgZXhwb3J0cywgc2lnbmFsUikge1xyXG4gICAgXCJ1c2Ugc3RyaWN0XCI7XHJcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XHJcbiAgICB2YXIgVXBkYXRlQ2xpZW50ID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIGZ1bmN0aW9uIFVwZGF0ZUNsaWVudChwYXJhbXMpIHtcclxuICAgICAgICAgICAgdGhpcy5wYXJhbXMgPSBwYXJhbXM7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIC8qKlxyXG4gICAgICAgICAqIEluaXRpYWxpemVcclxuICAgICAgICAgKiBAcGFyYW0gdXJsXHJcbiAgICAgICAgICovXHJcbiAgICAgICAgVXBkYXRlQ2xpZW50LnByb3RvdHlwZS5pbml0ID0gZnVuY3Rpb24gKHVybCkge1xyXG4gICAgICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xyXG4gICAgICAgICAgICB2YXIgb3B0aW9ucyA9IHtcclxuICAgICAgICAgICAgICAgIGxvZ2dlcjogbmV3IHNpZ25hbFIuQ29uc29sZUxvZ2dlcihzaWduYWxSLkxvZ0xldmVsLlRyYWNlKVxyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICB0aGlzLmNvbm5lY3Rpb24gPSBuZXcgc2lnbmFsUi5IdWJDb25uZWN0aW9uKHVybCwgb3B0aW9ucyk7XHJcbiAgICAgICAgICAgIHRoaXMuY29ubmVjdGlvbi5vbignQ2hhbmdlcycsIGZ1bmN0aW9uIChkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoIWRhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBkb2NzID0gVXBkYXRlQ2xpZW50LnNtb29zaChKU09OLnBhcnNlKGRhdGEpKTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoIUFycmF5LmlzQXJyYXkoZG9jcykpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcihcIkNoYW5nZSBkYXRhIG5vdCBhbiBhcnJheSBcIiArIGRvY3MpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGlmIChkb2NzLmxlbmd0aCA8IDEpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcihcIkNoYW5nZSBkYXRhIGlzIGVtcHR5XCIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiUmVjZWl2ZWQgXCIgKyBkb2NzLmxlbmd0aCArIFwiIHVwZGF0ZXNcIik7XHJcbiAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgX2kgPSAwLCBkb2NzXzEgPSBkb2NzOyBfaSA8IGRvY3NfMS5sZW5ndGg7IF9pKyspIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGRvYyA9IGRvY3NfMVtfaV07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzLnBhcmFtcy5vblJlY2VpdmVkKGRvYyk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgY2F0Y2ggKGUpIHtcclxuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKFwiRmFpbGVkIHRvIHBhcnNlIGNoYW5nZSBkYXRhOiBcIiArIGUpO1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmNvbm5lY3Rpb24uc3RhcnQoKTtcclxuICAgICAgICB9O1xyXG4gICAgICAgIC8qKlxyXG4gICAgICAgICAqIENoZWNrIGlmIG9iamVjdCBpcyBpbnN0YW5jZSBvZiBPblBpeGVsVXBkYXRlRGF0YVxyXG4gICAgICAgICAqIEBwYXJhbSBvYmplY3RcclxuICAgICAgICAgKi9cclxuICAgICAgICBVcGRhdGVDbGllbnQuaXNPblBpeGVsVXBkYXRlRGF0YSA9IGZ1bmN0aW9uIChvYmplY3QpIHtcclxuICAgICAgICAgICAgcmV0dXJuICd4JyBpbiBvYmplY3QgJiYgJ3knIGluIG9iamVjdCAmJiAnY29sb3InIGluIG9iamVjdCAmJiAnX2xzbicgaW4gb2JqZWN0O1xyXG4gICAgICAgIH07XHJcbiAgICAgICAgVXBkYXRlQ2xpZW50LnNtb29zaCA9IGZ1bmN0aW9uIChkb2NzKSB7XHJcbiAgICAgICAgICAgIHZhciB1cGRhdGVzID0gW107XHJcbiAgICAgICAgICAgIGlmICghQXJyYXkuaXNBcnJheShkb2NzKSkge1xyXG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiTm90IGFuIGFycmF5XCIpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGZvciAodmFyIF9pID0gMCwgZG9jc18yID0gZG9jczsgX2kgPCBkb2NzXzIubGVuZ3RoOyBfaSsrKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgZG9jID0gZG9jc18yW19pXTtcclxuICAgICAgICAgICAgICAgIGlmIChkb2MuaXRlbXMgIT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGZvciAodmFyIF9hID0gMCwgX2IgPSBkb2MuaXRlbXM7IF9hIDwgX2IubGVuZ3RoOyBfYSsrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBwaXhlbCA9IF9iW19hXTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdXBkYXRlcy5wdXNoKHBpeGVsKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICB1cGRhdGVzLnB1c2goZG9jKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gdXBkYXRlcztcclxuICAgICAgICB9O1xyXG4gICAgICAgIHJldHVybiBVcGRhdGVDbGllbnQ7XHJcbiAgICB9KCkpO1xyXG4gICAgZXhwb3J0cy5VcGRhdGVDbGllbnQgPSBVcGRhdGVDbGllbnQ7XHJcbn0pO1xyXG4vLyMgc291cmNlTWFwcGluZ1VSTD11cGRhdGVDbGllbnQuanMubWFwIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///14\n')},function(module,exports,__webpack_require__){eval('var __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;!(__WEBPACK_AMD_DEFINE_ARRAY__ = [__webpack_require__, exports], __WEBPACK_AMD_DEFINE_RESULT__ = (function (require, exports) {\r\n    "use strict";\r\n    Object.defineProperty(exports, "__esModule", { value: true });\r\n    var DrawingBuffer = /** @class */ (function () {\r\n        function DrawingBuffer(isFreehand) {\r\n            this.isPenDown = false;\r\n            this.lastPosition = null;\r\n            this.isFreehand = isFreehand;\r\n            this.updateAggregator = new PixelUpdateAggregator();\r\n            this.reset();\r\n        }\r\n        /**\r\n         * Move pen down\r\n         * @param position\r\n         * @param color\r\n         * @return individual pixel updates for this operation\r\n         */\r\n        DrawingBuffer.prototype.penDown = function (position, color) {\r\n            this.isPenDown = true;\r\n            this.lastPosition = position;\r\n            // const updates = this.drawSpot(position, color);\r\n            // this.updateAggregator.addUpdates(updates);\r\n            // return updates;\r\n            return [];\r\n        };\r\n        /**\r\n         * Move pen\r\n         * @param position\r\n         * @param color\r\n         * @return individual pixel updates for this operation\r\n         */\r\n        DrawingBuffer.prototype.penMove = function (position, color) {\r\n            if (!this.isPenDown || !this.isFreehand) {\r\n                return [];\r\n            }\r\n            // Draw spot\r\n            var updateAgg = new PixelUpdateAggregator();\r\n            var updates = this.drawSpot(position, color);\r\n            updateAgg.addUpdates(updates);\r\n            // Interpolate from last position\r\n            if (this.lastPosition) {\r\n                var deltaX = position.x - this.lastPosition.x;\r\n                var deltaY = position.y - this.lastPosition.y;\r\n                var incr = Math.max(Math.abs(deltaX), Math.abs(deltaY)); // maximize resolution\r\n                for (var i = 0; i < incr; i++) {\r\n                    var xi = this.lastPosition.x + Math.round(i * deltaX / incr);\r\n                    var yi = this.lastPosition.y + Math.round(i * deltaY / incr);\r\n                    var updatesi = this.drawSpot({ x: xi, y: yi }, color);\r\n                    updateAgg.addUpdates(updatesi);\r\n                }\r\n            }\r\n            this.lastPosition = position;\r\n            this.updateAggregator.addUpdates(updateAgg.getAllUpdates());\r\n            return updateAgg.getAllUpdates();\r\n        };\r\n        /**\r\n         * Move pen up\r\n         */\r\n        DrawingBuffer.prototype.penUp = function (position, color) {\r\n            this.isPenDown = false;\r\n            var updates = [];\r\n            if (!position) {\r\n                // Touch up doesn\'t provide position\r\n                position = this.lastPosition;\r\n            }\r\n            if (position) {\r\n                updates = this.drawSpot(position, color);\r\n                this.updateAggregator.addUpdates(updates);\r\n            }\r\n            return updates;\r\n        };\r\n        DrawingBuffer.prototype.getAllUpdates = function () {\r\n            return this.updateAggregator.getAllUpdates();\r\n        };\r\n        /**\r\n         * Draw single point: for freehand, draw neighboring points\r\n         * @param position\r\n         * @param color\r\n         */\r\n        DrawingBuffer.prototype.drawSpot = function (position, color) {\r\n            var updates = [];\r\n            if (!this.isFreehand) {\r\n                updates.push({\r\n                    x: position.x,\r\n                    y: position.y,\r\n                    color: color\r\n                });\r\n            }\r\n            else {\r\n                var maxX = position.x + DrawingBuffer.FREEHAND_PEN_SIZE_PX + 1;\r\n                var maxY = position.y + DrawingBuffer.FREEHAND_PEN_SIZE_PX + 1;\r\n                for (var x = position.x - DrawingBuffer.FREEHAND_PEN_SIZE_PX; x < maxX; x++) {\r\n                    for (var y = position.y - DrawingBuffer.FREEHAND_PEN_SIZE_PX; y < maxY; y++) {\r\n                        updates.push({\r\n                            x: x,\r\n                            y: y,\r\n                            color: color\r\n                        });\r\n                    }\r\n                }\r\n            }\r\n            return updates;\r\n        };\r\n        DrawingBuffer.prototype.reset = function () {\r\n            this.updateAggregator.clear();\r\n        };\r\n        DrawingBuffer.FREEHAND_PEN_SIZE_PX = 1; // Freehand drawing uses thicker pen\r\n        return DrawingBuffer;\r\n    }());\r\n    exports.DrawingBuffer = DrawingBuffer;\r\n    /**\r\n     * Utility class to accumulate updates and return de-duped updates\r\n     */\r\n    var PixelUpdateAggregator = /** @class */ (function () {\r\n        function PixelUpdateAggregator() {\r\n            this.clear();\r\n        }\r\n        PixelUpdateAggregator.prototype.addUpdates = function (updates) {\r\n            var _this = this;\r\n            $.each(updates, function (index, update) {\r\n                _this.pixelUpdates[update.x + "-" + update.y] = update;\r\n            });\r\n        };\r\n        PixelUpdateAggregator.prototype.getAllUpdates = function () {\r\n            var result = [];\r\n            for (var xy in this.pixelUpdates) {\r\n                result.push(this.pixelUpdates[xy]);\r\n            }\r\n            return result;\r\n        };\r\n        PixelUpdateAggregator.prototype.clear = function () {\r\n            this.pixelUpdates = {};\r\n        };\r\n        return PixelUpdateAggregator;\r\n    }());\r\n}).apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__),\n\t\t\t\t__WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\r\n//# sourceMappingURL=drawingBuffer.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9idWlsdC9kcmF3aW5nQnVmZmVyLmpzPzhmYTciXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6ImdFQUFBO0FBQ0E7QUFDQSxrREFBa0QsY0FBYztBQUNoRTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHdFQUF3RTtBQUN4RSwrQkFBK0IsVUFBVTtBQUN6QztBQUNBO0FBQ0Esa0RBQWtELGVBQWU7QUFDakU7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0E7QUFDQTtBQUNBLDZFQUE2RSxVQUFVO0FBQ3ZGLGlGQUFpRixVQUFVO0FBQzNGO0FBQ0E7QUFDQTtBQUNBO0FBQ0EseUJBQXlCO0FBQ3pCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwrQ0FBK0M7QUFDL0M7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTCxDQUFDO0FBQUE7QUFDRCIsImZpbGUiOiIxNS5qcyIsInNvdXJjZXNDb250ZW50IjpbImRlZmluZShbXCJyZXF1aXJlXCIsIFwiZXhwb3J0c1wiXSwgZnVuY3Rpb24gKHJlcXVpcmUsIGV4cG9ydHMpIHtcclxuICAgIFwidXNlIHN0cmljdFwiO1xyXG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xyXG4gICAgdmFyIERyYXdpbmdCdWZmZXIgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgZnVuY3Rpb24gRHJhd2luZ0J1ZmZlcihpc0ZyZWVoYW5kKSB7XHJcbiAgICAgICAgICAgIHRoaXMuaXNQZW5Eb3duID0gZmFsc2U7XHJcbiAgICAgICAgICAgIHRoaXMubGFzdFBvc2l0aW9uID0gbnVsbDtcclxuICAgICAgICAgICAgdGhpcy5pc0ZyZWVoYW5kID0gaXNGcmVlaGFuZDtcclxuICAgICAgICAgICAgdGhpcy51cGRhdGVBZ2dyZWdhdG9yID0gbmV3IFBpeGVsVXBkYXRlQWdncmVnYXRvcigpO1xyXG4gICAgICAgICAgICB0aGlzLnJlc2V0KCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIC8qKlxyXG4gICAgICAgICAqIE1vdmUgcGVuIGRvd25cclxuICAgICAgICAgKiBAcGFyYW0gcG9zaXRpb25cclxuICAgICAgICAgKiBAcGFyYW0gY29sb3JcclxuICAgICAgICAgKiBAcmV0dXJuIGluZGl2aWR1YWwgcGl4ZWwgdXBkYXRlcyBmb3IgdGhpcyBvcGVyYXRpb25cclxuICAgICAgICAgKi9cclxuICAgICAgICBEcmF3aW5nQnVmZmVyLnByb3RvdHlwZS5wZW5Eb3duID0gZnVuY3Rpb24gKHBvc2l0aW9uLCBjb2xvcikge1xyXG4gICAgICAgICAgICB0aGlzLmlzUGVuRG93biA9IHRydWU7XHJcbiAgICAgICAgICAgIHRoaXMubGFzdFBvc2l0aW9uID0gcG9zaXRpb247XHJcbiAgICAgICAgICAgIC8vIGNvbnN0IHVwZGF0ZXMgPSB0aGlzLmRyYXdTcG90KHBvc2l0aW9uLCBjb2xvcik7XHJcbiAgICAgICAgICAgIC8vIHRoaXMudXBkYXRlQWdncmVnYXRvci5hZGRVcGRhdGVzKHVwZGF0ZXMpO1xyXG4gICAgICAgICAgICAvLyByZXR1cm4gdXBkYXRlcztcclxuICAgICAgICAgICAgcmV0dXJuIFtdO1xyXG4gICAgICAgIH07XHJcbiAgICAgICAgLyoqXHJcbiAgICAgICAgICogTW92ZSBwZW5cclxuICAgICAgICAgKiBAcGFyYW0gcG9zaXRpb25cclxuICAgICAgICAgKiBAcGFyYW0gY29sb3JcclxuICAgICAgICAgKiBAcmV0dXJuIGluZGl2aWR1YWwgcGl4ZWwgdXBkYXRlcyBmb3IgdGhpcyBvcGVyYXRpb25cclxuICAgICAgICAgKi9cclxuICAgICAgICBEcmF3aW5nQnVmZmVyLnByb3RvdHlwZS5wZW5Nb3ZlID0gZnVuY3Rpb24gKHBvc2l0aW9uLCBjb2xvcikge1xyXG4gICAgICAgICAgICBpZiAoIXRoaXMuaXNQZW5Eb3duIHx8ICF0aGlzLmlzRnJlZWhhbmQpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBbXTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAvLyBEcmF3IHNwb3RcclxuICAgICAgICAgICAgdmFyIHVwZGF0ZUFnZyA9IG5ldyBQaXhlbFVwZGF0ZUFnZ3JlZ2F0b3IoKTtcclxuICAgICAgICAgICAgdmFyIHVwZGF0ZXMgPSB0aGlzLmRyYXdTcG90KHBvc2l0aW9uLCBjb2xvcik7XHJcbiAgICAgICAgICAgIHVwZGF0ZUFnZy5hZGRVcGRhdGVzKHVwZGF0ZXMpO1xyXG4gICAgICAgICAgICAvLyBJbnRlcnBvbGF0ZSBmcm9tIGxhc3QgcG9zaXRpb25cclxuICAgICAgICAgICAgaWYgKHRoaXMubGFzdFBvc2l0aW9uKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgZGVsdGFYID0gcG9zaXRpb24ueCAtIHRoaXMubGFzdFBvc2l0aW9uLng7XHJcbiAgICAgICAgICAgICAgICB2YXIgZGVsdGFZID0gcG9zaXRpb24ueSAtIHRoaXMubGFzdFBvc2l0aW9uLnk7XHJcbiAgICAgICAgICAgICAgICB2YXIgaW5jciA9IE1hdGgubWF4KE1hdGguYWJzKGRlbHRhWCksIE1hdGguYWJzKGRlbHRhWSkpOyAvLyBtYXhpbWl6ZSByZXNvbHV0aW9uXHJcbiAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGluY3I7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciB4aSA9IHRoaXMubGFzdFBvc2l0aW9uLnggKyBNYXRoLnJvdW5kKGkgKiBkZWx0YVggLyBpbmNyKTtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgeWkgPSB0aGlzLmxhc3RQb3NpdGlvbi55ICsgTWF0aC5yb3VuZChpICogZGVsdGFZIC8gaW5jcik7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHVwZGF0ZXNpID0gdGhpcy5kcmF3U3BvdCh7IHg6IHhpLCB5OiB5aSB9LCBjb2xvcik7XHJcbiAgICAgICAgICAgICAgICAgICAgdXBkYXRlQWdnLmFkZFVwZGF0ZXModXBkYXRlc2kpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHRoaXMubGFzdFBvc2l0aW9uID0gcG9zaXRpb247XHJcbiAgICAgICAgICAgIHRoaXMudXBkYXRlQWdncmVnYXRvci5hZGRVcGRhdGVzKHVwZGF0ZUFnZy5nZXRBbGxVcGRhdGVzKCkpO1xyXG4gICAgICAgICAgICByZXR1cm4gdXBkYXRlQWdnLmdldEFsbFVwZGF0ZXMoKTtcclxuICAgICAgICB9O1xyXG4gICAgICAgIC8qKlxyXG4gICAgICAgICAqIE1vdmUgcGVuIHVwXHJcbiAgICAgICAgICovXHJcbiAgICAgICAgRHJhd2luZ0J1ZmZlci5wcm90b3R5cGUucGVuVXAgPSBmdW5jdGlvbiAocG9zaXRpb24sIGNvbG9yKSB7XHJcbiAgICAgICAgICAgIHRoaXMuaXNQZW5Eb3duID0gZmFsc2U7XHJcbiAgICAgICAgICAgIHZhciB1cGRhdGVzID0gW107XHJcbiAgICAgICAgICAgIGlmICghcG9zaXRpb24pIHtcclxuICAgICAgICAgICAgICAgIC8vIFRvdWNoIHVwIGRvZXNuJ3QgcHJvdmlkZSBwb3NpdGlvblxyXG4gICAgICAgICAgICAgICAgcG9zaXRpb24gPSB0aGlzLmxhc3RQb3NpdGlvbjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAocG9zaXRpb24pIHtcclxuICAgICAgICAgICAgICAgIHVwZGF0ZXMgPSB0aGlzLmRyYXdTcG90KHBvc2l0aW9uLCBjb2xvcik7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnVwZGF0ZUFnZ3JlZ2F0b3IuYWRkVXBkYXRlcyh1cGRhdGVzKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gdXBkYXRlcztcclxuICAgICAgICB9O1xyXG4gICAgICAgIERyYXdpbmdCdWZmZXIucHJvdG90eXBlLmdldEFsbFVwZGF0ZXMgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLnVwZGF0ZUFnZ3JlZ2F0b3IuZ2V0QWxsVXBkYXRlcygpO1xyXG4gICAgICAgIH07XHJcbiAgICAgICAgLyoqXHJcbiAgICAgICAgICogRHJhdyBzaW5nbGUgcG9pbnQ6IGZvciBmcmVlaGFuZCwgZHJhdyBuZWlnaGJvcmluZyBwb2ludHNcclxuICAgICAgICAgKiBAcGFyYW0gcG9zaXRpb25cclxuICAgICAgICAgKiBAcGFyYW0gY29sb3JcclxuICAgICAgICAgKi9cclxuICAgICAgICBEcmF3aW5nQnVmZmVyLnByb3RvdHlwZS5kcmF3U3BvdCA9IGZ1bmN0aW9uIChwb3NpdGlvbiwgY29sb3IpIHtcclxuICAgICAgICAgICAgdmFyIHVwZGF0ZXMgPSBbXTtcclxuICAgICAgICAgICAgaWYgKCF0aGlzLmlzRnJlZWhhbmQpIHtcclxuICAgICAgICAgICAgICAgIHVwZGF0ZXMucHVzaCh7XHJcbiAgICAgICAgICAgICAgICAgICAgeDogcG9zaXRpb24ueCxcclxuICAgICAgICAgICAgICAgICAgICB5OiBwb3NpdGlvbi55LFxyXG4gICAgICAgICAgICAgICAgICAgIGNvbG9yOiBjb2xvclxyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgbWF4WCA9IHBvc2l0aW9uLnggKyBEcmF3aW5nQnVmZmVyLkZSRUVIQU5EX1BFTl9TSVpFX1BYICsgMTtcclxuICAgICAgICAgICAgICAgIHZhciBtYXhZID0gcG9zaXRpb24ueSArIERyYXdpbmdCdWZmZXIuRlJFRUhBTkRfUEVOX1NJWkVfUFggKyAxO1xyXG4gICAgICAgICAgICAgICAgZm9yICh2YXIgeCA9IHBvc2l0aW9uLnggLSBEcmF3aW5nQnVmZmVyLkZSRUVIQU5EX1BFTl9TSVpFX1BYOyB4IDwgbWF4WDsgeCsrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgeSA9IHBvc2l0aW9uLnkgLSBEcmF3aW5nQnVmZmVyLkZSRUVIQU5EX1BFTl9TSVpFX1BYOyB5IDwgbWF4WTsgeSsrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHVwZGF0ZXMucHVzaCh7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB4OiB4LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgeTogeSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbG9yOiBjb2xvclxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuIHVwZGF0ZXM7XHJcbiAgICAgICAgfTtcclxuICAgICAgICBEcmF3aW5nQnVmZmVyLnByb3RvdHlwZS5yZXNldCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgdGhpcy51cGRhdGVBZ2dyZWdhdG9yLmNsZWFyKCk7XHJcbiAgICAgICAgfTtcclxuICAgICAgICBEcmF3aW5nQnVmZmVyLkZSRUVIQU5EX1BFTl9TSVpFX1BYID0gMTsgLy8gRnJlZWhhbmQgZHJhd2luZyB1c2VzIHRoaWNrZXIgcGVuXHJcbiAgICAgICAgcmV0dXJuIERyYXdpbmdCdWZmZXI7XHJcbiAgICB9KCkpO1xyXG4gICAgZXhwb3J0cy5EcmF3aW5nQnVmZmVyID0gRHJhd2luZ0J1ZmZlcjtcclxuICAgIC8qKlxyXG4gICAgICogVXRpbGl0eSBjbGFzcyB0byBhY2N1bXVsYXRlIHVwZGF0ZXMgYW5kIHJldHVybiBkZS1kdXBlZCB1cGRhdGVzXHJcbiAgICAgKi9cclxuICAgIHZhciBQaXhlbFVwZGF0ZUFnZ3JlZ2F0b3IgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgZnVuY3Rpb24gUGl4ZWxVcGRhdGVBZ2dyZWdhdG9yKCkge1xyXG4gICAgICAgICAgICB0aGlzLmNsZWFyKCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIFBpeGVsVXBkYXRlQWdncmVnYXRvci5wcm90b3R5cGUuYWRkVXBkYXRlcyA9IGZ1bmN0aW9uICh1cGRhdGVzKSB7XHJcbiAgICAgICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XHJcbiAgICAgICAgICAgICQuZWFjaCh1cGRhdGVzLCBmdW5jdGlvbiAoaW5kZXgsIHVwZGF0ZSkge1xyXG4gICAgICAgICAgICAgICAgX3RoaXMucGl4ZWxVcGRhdGVzW3VwZGF0ZS54ICsgXCItXCIgKyB1cGRhdGUueV0gPSB1cGRhdGU7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH07XHJcbiAgICAgICAgUGl4ZWxVcGRhdGVBZ2dyZWdhdG9yLnByb3RvdHlwZS5nZXRBbGxVcGRhdGVzID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICB2YXIgcmVzdWx0ID0gW107XHJcbiAgICAgICAgICAgIGZvciAodmFyIHh5IGluIHRoaXMucGl4ZWxVcGRhdGVzKSB7XHJcbiAgICAgICAgICAgICAgICByZXN1bHQucHVzaCh0aGlzLnBpeGVsVXBkYXRlc1t4eV0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiByZXN1bHQ7XHJcbiAgICAgICAgfTtcclxuICAgICAgICBQaXhlbFVwZGF0ZUFnZ3JlZ2F0b3IucHJvdG90eXBlLmNsZWFyID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICB0aGlzLnBpeGVsVXBkYXRlcyA9IHt9O1xyXG4gICAgICAgIH07XHJcbiAgICAgICAgcmV0dXJuIFBpeGVsVXBkYXRlQWdncmVnYXRvcjtcclxuICAgIH0oKSk7XHJcbn0pO1xyXG4vLyMgc291cmNlTWFwcGluZ1VSTD1kcmF3aW5nQnVmZmVyLmpzLm1hcCJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///15\n')},function(module,exports,__webpack_require__){eval("var __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;!(__WEBPACK_AMD_DEFINE_ARRAY__ = [__webpack_require__, exports, __webpack_require__(15)], __WEBPACK_AMD_DEFINE_RESULT__ = (function (require, exports, drawingBuffer_1) {\r\n    \"use strict\";\r\n    Object.defineProperty(exports, \"__esModule\", { value: true });\r\n    var TouchStates;\r\n    (function (TouchStates) {\r\n        TouchStates[TouchStates[\"SingleDown\"] = 0] = \"SingleDown\";\r\n        TouchStates[TouchStates[\"MultiDown\"] = 1] = \"MultiDown\";\r\n        TouchStates[TouchStates[\"Up\"] = 2] = \"Up\";\r\n    })(TouchStates || (TouchStates = {}));\r\n    var DrawModes;\r\n    (function (DrawModes) {\r\n        DrawModes[DrawModes[\"Freehand\"] = 0] = \"Freehand\";\r\n        DrawModes[DrawModes[\"Pixel\"] = 1] = \"Pixel\";\r\n        DrawModes[DrawModes[\"Disabled\"] = 2] = \"Disabled\";\r\n    })(DrawModes = exports.DrawModes || (exports.DrawModes = {}));\r\n    var Canvas = /** @class */ (function () {\r\n        function Canvas(params) {\r\n            var _this = this;\r\n            this.zoomScale = 1;\r\n            // TODO: Remove this once LSN supported\r\n            this.historyBuffer = [];\r\n            this.drawingQueue = [];\r\n            this.pendingBoard = null;\r\n            this.MIN_BATCH_SIZE = 10;\r\n            this.MAX_BATCH_SIZE = 300;\r\n            this.STEP_SIZE = 50;\r\n            this.currentBatchSize = this.MIN_BATCH_SIZE;\r\n            // Pre-calculate palette values to speed up renderBoard()\r\n            // The internal color palette structure stores colors as AGBR (reversed RGBA) to make writing to the color buffer easier.\r\n            $.each(Canvas.COLOR_PALETTE_16, function (index, color) {\r\n                color.v32 = (color.a << 24) + (color.b << 16) + (color.g << 8) + color.r;\r\n            });\r\n            this.drawMode = ko.observable(DrawModes.Disabled);\r\n            this.drawMode.subscribe(function (newValue) {\r\n                _this.drawingBuffer.isFreehand = newValue === DrawModes.Freehand;\r\n            });\r\n            this.params = params;\r\n            this.canvas = document.getElementById('canvas');\r\n            this.context = this.canvas.getContext('2d');\r\n            this.viewportCanvas = document.getElementById('viewport-canvas');\r\n            this.viewportContext = this.viewportCanvas.getContext('2d');\r\n            this.thumbnailCanvas = document.getElementById('thumbnail-canvas');\r\n            this.thumbnailContext = this.thumbnailCanvas.getContext('2d');\r\n            this.thumbnailFactor = this.thumbnailCanvas.getBoundingClientRect().width / Canvas.BOARD_WIDTH_PX;\r\n            this.canvas.addEventListener('mousedown', this.onMouseDown.bind(this), false);\r\n            this.canvas.addEventListener('touchstart', this.onMouseDown.bind(this), false);\r\n            this.canvas.addEventListener('mouseup', this.onMouseUp.bind(this), false);\r\n            this.canvas.addEventListener('touchend', this.onMouseUp.bind(this), false);\r\n            this.canvas.addEventListener('mousemove', this.onMouseMove.bind(this), false);\r\n            this.canvas.addEventListener('touchmove', this.onMouseMove.bind(this), false);\r\n            this.canvasContainerElement = $('#canvas-container');\r\n            this.panZoomElement = this.canvasContainerElement.find('#canvas').panzoom({\r\n                cursor: 'default',\r\n                which: 3,\r\n                // panOnlyWhenZoomed: true,\r\n                // disablePan: false,\r\n                minScale: Canvas.ZOOM_MIN_SCALE,\r\n                maxScale: Canvas.ZOOM_MAX_SCALE,\r\n            });\r\n            this.panZoomElement.parent().on('mousewheel.focal', function (e) {\r\n                e.preventDefault();\r\n                var delta = e.delta || e.originalEvent.wheelDelta;\r\n                var zoomOut = delta ? delta < 0 : e.originalEvent.deltaY > 0;\r\n                _this.panZoomElement.panzoom('zoom', zoomOut, {\r\n                    animate: false,\r\n                    focal: e\r\n                });\r\n            });\r\n            this.panZoomElement.on('panzoomchange', function (e, panzoom, transform) {\r\n                _this.zoomScale = transform[0];\r\n                _this.updateViewportCanvas();\r\n            });\r\n            $('#coordinates-container').draggable({ axis: 'y', containment: \"#canvas-container\", scroll: false });\r\n            window.onresize = this.onWindowResize.bind(this);\r\n            this.currentPositionStr = ko.observable('');\r\n            this.availableColors = ko.observableArray(Canvas.COLOR_PALETTE_16);\r\n            this.selectedColorIndex = ko.observable(0);\r\n            this.buffer = new ArrayBuffer(Canvas.BOARD_WIDTH_PX * Canvas.BOARD_HEIGHT_PX * 4);\r\n            this.readBuffer = new Uint8ClampedArray(this.buffer);\r\n            this.writeBuffer = new Uint32Array(this.buffer);\r\n            this.drawingBuffer = new drawingBuffer_1.DrawingBuffer(this.drawMode() === DrawModes.Freehand);\r\n            this.touchState = TouchStates.Up;\r\n            this.lastMouseDownPosition = null;\r\n            this.totalDragDistance = 0;\r\n            this.onWindowResize();\r\n            this.startRenderingLoop(this.flushDrawingQueue.bind(this));\r\n        }\r\n        Canvas.prototype.onWindowResize = function () {\r\n            // Viewport canvas size matches canvas container size\r\n            this.viewportCanvas.width = this.canvasContainerElement.width();\r\n            this.viewportCanvas.height = this.canvasContainerElement.height();\r\n            this.centerCanvas();\r\n        };\r\n        Canvas.prototype.centerCanvas = function () {\r\n            var BORDER_PX = 1;\r\n            var containerWidth = this.canvasContainerElement.width();\r\n            var containerHeight = this.canvasContainerElement.height();\r\n            var zoomX = (containerWidth - BORDER_PX) / Canvas.BOARD_WIDTH_PX;\r\n            var zoomY = (containerHeight - BORDER_PX) / Canvas.BOARD_HEIGHT_PX;\r\n            var zoom = Math.min(zoomX, zoomY);\r\n            var panX = containerWidth / 2 - (Canvas.BOARD_WIDTH_PX / 2);\r\n            var panY = containerHeight / 2 - (Canvas.BOARD_HEIGHT_PX / 2);\r\n            var canvasRect = this.canvas.getBoundingClientRect();\r\n            this.panZoomElement.panzoom('zoom', zoom, {\r\n                animate: false,\r\n                focal: { clientX: canvasRect.left, clientY: canvasRect.top }\r\n            });\r\n            this.panZoomElement.panzoom('pan', panX, panY, { relative: false });\r\n            this.panZoomElement.panzoom('option', 'minScale', zoom);\r\n        };\r\n        Canvas.prototype.flushDrawingQueue = function () {\r\n            var _this = this;\r\n            var xmin = Canvas.BOARD_WIDTH_PX;\r\n            var xmax = 0;\r\n            var ymin = Canvas.BOARD_HEIGHT_PX;\r\n            var ymax = 0;\r\n            if (this.pendingBoard) {\r\n                this.renderBoard(this.pendingBoard);\r\n                xmin = 0;\r\n                ymin = 0;\r\n                xmax = Canvas.BOARD_WIDTH_PX;\r\n                ymax = Canvas.BOARD_HEIGHT_PX;\r\n            }\r\n            $.each(this.drawingQueue, function (index, update) {\r\n                _this.paintToCanvas(update);\r\n                xmin = Math.min(xmin, update.x);\r\n                ymin = Math.min(ymin, update.y);\r\n                xmax = Math.max(xmax, update.x + 1);\r\n                ymax = Math.max(ymax, update.y + 1);\r\n            });\r\n            if (this.drawingQueue.length > 0 || this.pendingBoard) {\r\n                this.updateViewportCanvas({ x1: xmin, y1: ymin, x2: xmax, y2: ymax });\r\n            }\r\n            this.drawingQueue = [];\r\n            this.pendingBoard = null;\r\n        };\r\n        /**\r\n         *\r\n         * @param fn\r\n         * @return canceling function\r\n         */\r\n        Canvas.prototype.startRenderingLoop = function (fn) {\r\n            var executeFn = function (ts) {\r\n                fn();\r\n                requestId = window.requestAnimationFrame(executeFn);\r\n            };\r\n            var requestId = window.requestAnimationFrame(executeFn);\r\n            return function () {\r\n                window.cancelAnimationFrame(requestId);\r\n            };\r\n        };\r\n        Canvas.prototype.selectColorIndex = function (index) {\r\n            this.selectedColorIndex(index);\r\n        };\r\n        Canvas.prototype.toRGBA = function (index) {\r\n            var color = this.availableColors()[index];\r\n            return \"rgba(\" + color.r + \",\" + color.g + \",\" + color.b + \",\" + color.a + \")\";\r\n        };\r\n        Canvas.prototype.getIntermediateBatchSize = function () {\r\n            var batchSize = this.currentBatchSize;\r\n            this.currentBatchSize = (this.currentBatchSize + this.STEP_SIZE) % this.MAX_BATCH_SIZE;\r\n            return this.currentBatchSize;\r\n        };\r\n        Canvas.prototype.onMouseMove = function (e) {\r\n            var _this = this;\r\n            var position;\r\n            if (e instanceof MouseEvent) {\r\n                if (e.button !== 0) {\r\n                    // Ignore all but left button down\r\n                    return;\r\n                }\r\n                position = this.getCanvasCoordinates(e.clientX, e.clientY);\r\n            }\r\n            else if (e instanceof TouchEvent) {\r\n                if (e.touches.length > 1 || this.touchState === TouchStates.MultiDown) {\r\n                    this.touchState = TouchStates.MultiDown;\r\n                    // Multitouching (pinching)\r\n                    return;\r\n                }\r\n                var t = e.touches[0];\r\n                position = this.getCanvasCoordinates(t.clientX, t.clientY);\r\n                e.stopImmediatePropagation();\r\n            }\r\n            else {\r\n                console.error('Unknown event', e);\r\n                return;\r\n            }\r\n            this.currentPositionStr(position.x + 1 + \", \" + (position.y + 1));\r\n            if (this.drawMode() === DrawModes.Freehand && this.touchState === TouchStates.SingleDown) {\r\n                var updates = this.drawingBuffer.penMove(position, this.selectedColorIndex());\r\n                $.each(updates, function (index, update) {\r\n                    _this.queuePixelUpdate(update);\r\n                });\r\n                var pendingUpdates = this.drawingBuffer.getAllUpdates();\r\n                if (pendingUpdates.length > this.getIntermediateBatchSize()) {\r\n                    this.params.onPixelUpdatesSubmitted(pendingUpdates);\r\n                    this.drawingBuffer.reset();\r\n                }\r\n            }\r\n            else {\r\n                if (this.touchState === TouchStates.SingleDown) {\r\n                    if (this.zoomScale < Canvas.UNSTABLE_ZOOM) {\r\n                        // Zoom too low, panning to jittery and position diverges. Disable panning.\r\n                        return;\r\n                    }\r\n                    var dx = position.x - this.lastMouseDownPosition.x;\r\n                    var dy = position.y - this.lastMouseDownPosition.y;\r\n                    this.panZoomElement.panzoom('pan', dx, dy, { relative: true });\r\n                    this.totalDragDistance += Math.hypot(dx, dy);\r\n                }\r\n            }\r\n        };\r\n        Canvas.prototype.onMouseDown = function (e) {\r\n            var _this = this;\r\n            this.totalDragDistance = 0;\r\n            this.currentBatchSize = this.MIN_BATCH_SIZE;\r\n            var position;\r\n            if (e instanceof MouseEvent) {\r\n                if (e.button !== 0) {\r\n                    // Ignore all but left button down\r\n                    return;\r\n                }\r\n                this.touchState = TouchStates.SingleDown;\r\n                position = this.getCanvasCoordinates(e.clientX, e.clientY);\r\n            }\r\n            else if (e instanceof TouchEvent) {\r\n                var t = e.touches[0];\r\n                position = this.getCanvasCoordinates(t.clientX, t.clientY);\r\n                switch (this.touchState) {\r\n                    case TouchStates.Up:\r\n                        this.touchState = TouchStates.SingleDown;\r\n                        break;\r\n                    case TouchStates.SingleDown:\r\n                    case TouchStates.MultiDown:\r\n                        this.touchState = TouchStates.MultiDown;\r\n                        break;\r\n                    default: break;\r\n                }\r\n            }\r\n            else {\r\n                console.error('Unknown event', e);\r\n                return;\r\n            }\r\n            this.lastMouseDownPosition = position;\r\n            if (this.drawMode() === DrawModes.Freehand || this.drawMode() === DrawModes.Pixel) {\r\n                var updates = this.drawingBuffer.penDown(position, this.selectedColorIndex());\r\n                $.each(updates, function (index, update) {\r\n                    _this.queuePixelUpdate(update);\r\n                });\r\n            }\r\n        };\r\n        Canvas.prototype.onMouseUp = function (e) {\r\n            var _this = this;\r\n            if (this.touchState === TouchStates.SingleDown) {\r\n                var position = null;\r\n                if (e instanceof MouseEvent) {\r\n                    if (e.button !== 0) {\r\n                        // Ignore all but left button down\r\n                        return;\r\n                    }\r\n                    position = this.getCanvasCoordinates(e.clientX, e.clientY);\r\n                }\r\n                else if (e instanceof TouchEvent) {\r\n                    if (e.touches.length > 1) {\r\n                        var t = e.touches[0];\r\n                        position = this.getCanvasCoordinates(t.clientX, t.clientY);\r\n                    }\r\n                }\r\n                else {\r\n                    console.error('Unknown event', e);\r\n                    return;\r\n                }\r\n                var hasMouseMoved = this.totalDragDistance > Canvas.MIN_MOUSE_MOVE_PX;\r\n                if ((this.drawMode() === DrawModes.Pixel && !hasMouseMoved) || this.drawMode() === DrawModes.Freehand) {\r\n                    var updates = this.drawingBuffer.penUp(position, this.selectedColorIndex());\r\n                    $.each(updates, function (index, update) {\r\n                        _this.queuePixelUpdate(update);\r\n                    });\r\n                    this.params.onPixelUpdatesSubmitted(this.drawingBuffer.getAllUpdates());\r\n                }\r\n                else if (this.drawMode() === DrawModes.Disabled && !hasMouseMoved) {\r\n                    this.params.onDisabledPixelInsert();\r\n                }\r\n                this.drawingBuffer.reset();\r\n            }\r\n            this.touchState = TouchStates.Up;\r\n        };\r\n        Canvas.prototype.paintToCanvas = function (update) {\r\n            var color = this.availableColors()[update.color];\r\n            if (!color) {\r\n                console.error('Unknown color', update.color);\r\n                return;\r\n            }\r\n            var imgData = this.context.createImageData(1, 1);\r\n            var d = imgData.data;\r\n            d[0] = color.r;\r\n            d[1] = color.g;\r\n            d[2] = color.b;\r\n            d[3] = color.a;\r\n            this.context.putImageData(imgData, update.x, update.y);\r\n        };\r\n        /**\r\n         * Convert mouse x,y to canvas x,y\r\n         * @param x\r\n         * @param y\r\n         */\r\n        Canvas.prototype.getCanvasCoordinates = function (x, y) {\r\n            var r = this.canvas.getBoundingClientRect();\r\n            return {\r\n                x: Math.floor((x - r.left) / this.zoomScale),\r\n                y: Math.floor((y - r.top) / this.zoomScale)\r\n            };\r\n        };\r\n        Canvas.prototype.queuePixelUpdate = function (data) {\r\n            this.historyBuffer.push(data);\r\n            this.drawingQueue.push(data);\r\n        };\r\n        Canvas.prototype.queueBoardUpdate = function (board) {\r\n            this.pendingBoard = board;\r\n        };\r\n        Canvas.prototype.renderBoard = function (board) {\r\n            var start = performance.now();\r\n            // For now, just draw it directly onto canvas\r\n            var x = 0;\r\n            var y = 0;\r\n            for (var i = 0; i < board.byteLength; i++) {\r\n                var color = Canvas.COLOR_PALETTE_16[board[i]];\r\n                this.writeBuffer[y * Canvas.BOARD_WIDTH_PX + x] = color.v32;\r\n                if (++x >= Canvas.BOARD_WIDTH_PX) {\r\n                    x = 0;\r\n                    y++;\r\n                }\r\n            }\r\n            while (this.historyBuffer.length > 0) {\r\n                var px = this.historyBuffer.pop();\r\n                var color = Canvas.COLOR_PALETTE_16[px.color];\r\n                this.writeBuffer[px.y * Canvas.BOARD_WIDTH_PX + px.x] = color.v32;\r\n            }\r\n            // Now paint over canvas\r\n            var imageData = new ImageData(this.readBuffer, Canvas.BOARD_WIDTH_PX, Canvas.BOARD_HEIGHT_PX);\r\n            this.context.putImageData(imageData, 0, 0);\r\n            console.log(\"renderBoard(): \" + (performance.now() - start) + \" ms\");\r\n        };\r\n        /**\r\n         * Copy canvas onto viewport canvas (this addresses blurred Edge pixel issue)\r\n         * @param updateRect if specified: only copy this rectangle (in source coordinates)\r\n         */\r\n        Canvas.prototype.updateViewportCanvas = function (updateRect) {\r\n            var c = this.canvas.getBoundingClientRect();\r\n            var v = this.viewportCanvas.getBoundingClientRect();\r\n            var cx = c.left - v.left;\r\n            var cy = c.top - v.top;\r\n            // More precise and self-contained than using this.zoomScale\r\n            var zoomScale = c.width / Canvas.BOARD_WIDTH_PX;\r\n            if (!updateRect) {\r\n                this.viewportContext.clearRect(0, 0, v.width, v.height);\r\n            }\r\n            var sx = 0;\r\n            var sy = 0;\r\n            var sw = Canvas.BOARD_WIDTH_PX;\r\n            var sh = Canvas.BOARD_HEIGHT_PX;\r\n            var dx = cx;\r\n            var dy = cy;\r\n            var dw = Canvas.BOARD_WIDTH_PX * zoomScale;\r\n            var dh = Canvas.BOARD_HEIGHT_PX * zoomScale;\r\n            if (updateRect) {\r\n                sx = updateRect.x1;\r\n                sy = updateRect.y1;\r\n                sw = updateRect.x2 - updateRect.x1;\r\n                sh = updateRect.y2 - updateRect.y1;\r\n                dx = cx + updateRect.x1 * zoomScale;\r\n                dy = cy + updateRect.y1 * zoomScale;\r\n                dw = sw * zoomScale;\r\n                dh = sh * zoomScale;\r\n            }\r\n            this.viewportContext.mozImageSmoothingEnabled = false;\r\n            this.viewportContext.webkitImageSmoothingEnabled = false;\r\n            this.viewportContext.msImageSmoothingEnabled = false;\r\n            this.viewportContext.imageSmoothingEnabled = false;\r\n            this.viewportContext.drawImage(this.canvas, sx, sy, sw, sh, dx, dy, dw, dh);\r\n            this.updateThumbnailCanvas();\r\n        };\r\n        Canvas.prototype.updateThumbnailCanvas = function () {\r\n            var c = this.canvas.getBoundingClientRect();\r\n            var v = this.viewportCanvas.getBoundingClientRect();\r\n            var cx = c.left - v.left;\r\n            var cy = c.top - v.top;\r\n            var tWidth = (v.width / c.width) * Canvas.BOARD_WIDTH_PX * this.thumbnailFactor;\r\n            var tHeight = (v.height / c.height) * Canvas.BOARD_HEIGHT_PX * this.thumbnailFactor;\r\n            var sx = 0;\r\n            var sy = 0;\r\n            var sw = Canvas.BOARD_WIDTH_PX;\r\n            var sh = Canvas.BOARD_HEIGHT_PX;\r\n            var dx = 0;\r\n            var dy = 0;\r\n            var dw = Canvas.BOARD_WIDTH_PX * this.thumbnailFactor;\r\n            var dh = Canvas.BOARD_HEIGHT_PX * this.thumbnailFactor;\r\n            // Draw rectangle that represents the viewport\r\n            // More precise and self-contained than using this.zoomScale\r\n            var zoomScale = c.width / Canvas.BOARD_WIDTH_PX;\r\n            var topLeft = {\r\n                x: -cx * this.thumbnailFactor / zoomScale,\r\n                y: -cy * this.thumbnailFactor / zoomScale\r\n            };\r\n            this.thumbnailContext.mozImageSmoothingEnabled = false;\r\n            this.thumbnailContext.webkitImageSmoothingEnabled = false;\r\n            this.thumbnailContext.msImageSmoothingEnabled = false;\r\n            this.thumbnailContext.imageSmoothingEnabled = false;\r\n            // Background darker\r\n            this.thumbnailContext.clearRect(0, 0, dw, dh);\r\n            this.thumbnailContext.fillStyle = 'rgba(0, 0, 0, 0.4)';\r\n            this.thumbnailContext.fillRect(0, 0, dw, dh);\r\n            // Draw mask\r\n            this.thumbnailContext.clearRect(topLeft.x, topLeft.y, tWidth, tHeight);\r\n            // Draw image\r\n            this.thumbnailContext.globalCompositeOperation = 'destination-over';\r\n            this.thumbnailContext.drawImage(this.canvas, sx, sy, sw, sh, dx, dy, dw, dh);\r\n        };\r\n        /**\r\n         *\r\n         * @param value true: zoom in, false: zoom out, or number for zoom value\r\n         */\r\n        Canvas.prototype.executeZoom = function (value) {\r\n            var containerPos = this.canvasContainerElement.position();\r\n            var center = {\r\n                x: containerPos.left + this.canvasContainerElement.width() / 2,\r\n                y: containerPos.top + this.canvasContainerElement.height() / 2\r\n            };\r\n            this.panZoomElement.panzoom('zoom', value, {\r\n                animate: false,\r\n                focal: {\r\n                    clientX: center.x,\r\n                    clientY: center.y\r\n                }\r\n            });\r\n        };\r\n        Canvas.prototype.zoomIn = function (data, e) {\r\n            this.executeZoom(false);\r\n        };\r\n        Canvas.prototype.zoomOut = function (data, e) {\r\n            this.executeZoom(true);\r\n        };\r\n        Canvas.BOARD_WIDTH_PX = 1000;\r\n        Canvas.BOARD_HEIGHT_PX = 1000;\r\n        Canvas.ZOOM_MIN_SCALE = 0.1;\r\n        Canvas.ZOOM_MAX_SCALE = 40;\r\n        Canvas.UNSTABLE_ZOOM = 0.5;\r\n        Canvas.MIN_MOUSE_MOVE_PX = 5; // minimum mouse move that qualifies as a drag\r\n        Canvas.INITIAL_ZOOM = 20;\r\n        // 16 colors according to this: http://www.december.com/html/spec/color16codes.html\r\n        Canvas.COLOR_PALETTE_16 = [\r\n            { r: 0, g: 0, b: 0, a: 255, v32: 0 },\r\n            { r: 128, g: 128, b: 128, a: 255, v32: 0 },\r\n            { r: 192, g: 192, b: 192, a: 255, v32: 0 },\r\n            { r: 255, g: 255, b: 255, a: 255, v32: 0 },\r\n            { r: 128, g: 0, b: 0, a: 255, v32: 0 },\r\n            { r: 255, g: 0, b: 0, a: 255, v32: 0 },\r\n            { r: 128, g: 128, b: 0, a: 255, v32: 0 },\r\n            { r: 255, g: 255, b: 0, a: 255, v32: 0 },\r\n            { r: 0, g: 255, b: 0, a: 255, v32: 0 },\r\n            { r: 0, g: 128, b: 0, a: 255, v32: 0 },\r\n            { r: 0, g: 128, b: 128, a: 255, v32: 0 },\r\n            { r: 0, g: 255, b: 255, a: 255, v32: 0 },\r\n            { r: 0, g: 0, b: 128, a: 255, v32: 0 },\r\n            { r: 0, g: 0, b: 255, a: 255, v32: 0 },\r\n            { r: 128, g: 0, b: 128, a: 255, v32: 0 },\r\n            { r: 255, g: 0, b: 255, a: 255, v32: 0 } // fuchsia\r\n        ];\r\n        return Canvas;\r\n    }());\r\n    exports.Canvas = Canvas;\r\n}).apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__),\n\t\t\t\t__WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\r\n//# sourceMappingURL=canvas.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9idWlsdC9jYW52YXMuanM/ODUxOCJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiZ0VBQUE7QUFDQTtBQUNBLGtEQUFrRCxjQUFjO0FBQ2hFO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLLGtDQUFrQztBQUN2QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSywwREFBMEQ7QUFDL0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsbURBQW1ELDZEQUE2RDtBQUNoSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esd0JBQXdCO0FBQ3hCLGFBQWE7QUFDYiw0REFBNEQsa0JBQWtCO0FBQzlFO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBLDJDQUEyQyx5Q0FBeUM7QUFDcEY7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxnRUFBZ0UsaUJBQWlCO0FBQ2pGO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EscUJBQXFCO0FBQ3JCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwyQkFBMkIsc0JBQXNCO0FBQ2pEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxxQ0FBcUM7QUFDckM7QUFDQTtBQUNBO0FBQ0EsYUFBYSxtQ0FBbUM7QUFDaEQsYUFBYSx5Q0FBeUM7QUFDdEQsYUFBYSx5Q0FBeUM7QUFDdEQsYUFBYSx5Q0FBeUM7QUFDdEQsYUFBYSxxQ0FBcUM7QUFDbEQsYUFBYSxxQ0FBcUM7QUFDbEQsYUFBYSx1Q0FBdUM7QUFDcEQsYUFBYSx1Q0FBdUM7QUFDcEQsYUFBYSxxQ0FBcUM7QUFDbEQsYUFBYSxxQ0FBcUM7QUFDbEQsYUFBYSx1Q0FBdUM7QUFDcEQsYUFBYSx1Q0FBdUM7QUFDcEQsYUFBYSxxQ0FBcUM7QUFDbEQsYUFBYSxxQ0FBcUM7QUFDbEQsYUFBYSx1Q0FBdUM7QUFDcEQsYUFBYSx1Q0FBdUM7QUFDcEQ7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBLENBQUM7QUFBQTtBQUNEIiwiZmlsZSI6IjE2LmpzIiwic291cmNlc0NvbnRlbnQiOlsiZGVmaW5lKFtcInJlcXVpcmVcIiwgXCJleHBvcnRzXCIsIFwiLi9kcmF3aW5nQnVmZmVyXCJdLCBmdW5jdGlvbiAocmVxdWlyZSwgZXhwb3J0cywgZHJhd2luZ0J1ZmZlcl8xKSB7XHJcbiAgICBcInVzZSBzdHJpY3RcIjtcclxuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcclxuICAgIHZhciBUb3VjaFN0YXRlcztcclxuICAgIChmdW5jdGlvbiAoVG91Y2hTdGF0ZXMpIHtcclxuICAgICAgICBUb3VjaFN0YXRlc1tUb3VjaFN0YXRlc1tcIlNpbmdsZURvd25cIl0gPSAwXSA9IFwiU2luZ2xlRG93blwiO1xyXG4gICAgICAgIFRvdWNoU3RhdGVzW1RvdWNoU3RhdGVzW1wiTXVsdGlEb3duXCJdID0gMV0gPSBcIk11bHRpRG93blwiO1xyXG4gICAgICAgIFRvdWNoU3RhdGVzW1RvdWNoU3RhdGVzW1wiVXBcIl0gPSAyXSA9IFwiVXBcIjtcclxuICAgIH0pKFRvdWNoU3RhdGVzIHx8IChUb3VjaFN0YXRlcyA9IHt9KSk7XHJcbiAgICB2YXIgRHJhd01vZGVzO1xyXG4gICAgKGZ1bmN0aW9uIChEcmF3TW9kZXMpIHtcclxuICAgICAgICBEcmF3TW9kZXNbRHJhd01vZGVzW1wiRnJlZWhhbmRcIl0gPSAwXSA9IFwiRnJlZWhhbmRcIjtcclxuICAgICAgICBEcmF3TW9kZXNbRHJhd01vZGVzW1wiUGl4ZWxcIl0gPSAxXSA9IFwiUGl4ZWxcIjtcclxuICAgICAgICBEcmF3TW9kZXNbRHJhd01vZGVzW1wiRGlzYWJsZWRcIl0gPSAyXSA9IFwiRGlzYWJsZWRcIjtcclxuICAgIH0pKERyYXdNb2RlcyA9IGV4cG9ydHMuRHJhd01vZGVzIHx8IChleHBvcnRzLkRyYXdNb2RlcyA9IHt9KSk7XHJcbiAgICB2YXIgQ2FudmFzID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIGZ1bmN0aW9uIENhbnZhcyhwYXJhbXMpIHtcclxuICAgICAgICAgICAgdmFyIF90aGlzID0gdGhpcztcclxuICAgICAgICAgICAgdGhpcy56b29tU2NhbGUgPSAxO1xyXG4gICAgICAgICAgICAvLyBUT0RPOiBSZW1vdmUgdGhpcyBvbmNlIExTTiBzdXBwb3J0ZWRcclxuICAgICAgICAgICAgdGhpcy5oaXN0b3J5QnVmZmVyID0gW107XHJcbiAgICAgICAgICAgIHRoaXMuZHJhd2luZ1F1ZXVlID0gW107XHJcbiAgICAgICAgICAgIHRoaXMucGVuZGluZ0JvYXJkID0gbnVsbDtcclxuICAgICAgICAgICAgdGhpcy5NSU5fQkFUQ0hfU0laRSA9IDEwO1xyXG4gICAgICAgICAgICB0aGlzLk1BWF9CQVRDSF9TSVpFID0gMzAwO1xyXG4gICAgICAgICAgICB0aGlzLlNURVBfU0laRSA9IDUwO1xyXG4gICAgICAgICAgICB0aGlzLmN1cnJlbnRCYXRjaFNpemUgPSB0aGlzLk1JTl9CQVRDSF9TSVpFO1xyXG4gICAgICAgICAgICAvLyBQcmUtY2FsY3VsYXRlIHBhbGV0dGUgdmFsdWVzIHRvIHNwZWVkIHVwIHJlbmRlckJvYXJkKClcclxuICAgICAgICAgICAgLy8gVGhlIGludGVybmFsIGNvbG9yIHBhbGV0dGUgc3RydWN0dXJlIHN0b3JlcyBjb2xvcnMgYXMgQUdCUiAocmV2ZXJzZWQgUkdCQSkgdG8gbWFrZSB3cml0aW5nIHRvIHRoZSBjb2xvciBidWZmZXIgZWFzaWVyLlxyXG4gICAgICAgICAgICAkLmVhY2goQ2FudmFzLkNPTE9SX1BBTEVUVEVfMTYsIGZ1bmN0aW9uIChpbmRleCwgY29sb3IpIHtcclxuICAgICAgICAgICAgICAgIGNvbG9yLnYzMiA9IChjb2xvci5hIDw8IDI0KSArIChjb2xvci5iIDw8IDE2KSArIChjb2xvci5nIDw8IDgpICsgY29sb3IucjtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIHRoaXMuZHJhd01vZGUgPSBrby5vYnNlcnZhYmxlKERyYXdNb2Rlcy5EaXNhYmxlZCk7XHJcbiAgICAgICAgICAgIHRoaXMuZHJhd01vZGUuc3Vic2NyaWJlKGZ1bmN0aW9uIChuZXdWYWx1ZSkge1xyXG4gICAgICAgICAgICAgICAgX3RoaXMuZHJhd2luZ0J1ZmZlci5pc0ZyZWVoYW5kID0gbmV3VmFsdWUgPT09IERyYXdNb2Rlcy5GcmVlaGFuZDtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIHRoaXMucGFyYW1zID0gcGFyYW1zO1xyXG4gICAgICAgICAgICB0aGlzLmNhbnZhcyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjYW52YXMnKTtcclxuICAgICAgICAgICAgdGhpcy5jb250ZXh0ID0gdGhpcy5jYW52YXMuZ2V0Q29udGV4dCgnMmQnKTtcclxuICAgICAgICAgICAgdGhpcy52aWV3cG9ydENhbnZhcyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd2aWV3cG9ydC1jYW52YXMnKTtcclxuICAgICAgICAgICAgdGhpcy52aWV3cG9ydENvbnRleHQgPSB0aGlzLnZpZXdwb3J0Q2FudmFzLmdldENvbnRleHQoJzJkJyk7XHJcbiAgICAgICAgICAgIHRoaXMudGh1bWJuYWlsQ2FudmFzID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3RodW1ibmFpbC1jYW52YXMnKTtcclxuICAgICAgICAgICAgdGhpcy50aHVtYm5haWxDb250ZXh0ID0gdGhpcy50aHVtYm5haWxDYW52YXMuZ2V0Q29udGV4dCgnMmQnKTtcclxuICAgICAgICAgICAgdGhpcy50aHVtYm5haWxGYWN0b3IgPSB0aGlzLnRodW1ibmFpbENhbnZhcy5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKS53aWR0aCAvIENhbnZhcy5CT0FSRF9XSURUSF9QWDtcclxuICAgICAgICAgICAgdGhpcy5jYW52YXMuYWRkRXZlbnRMaXN0ZW5lcignbW91c2Vkb3duJywgdGhpcy5vbk1vdXNlRG93bi5iaW5kKHRoaXMpLCBmYWxzZSk7XHJcbiAgICAgICAgICAgIHRoaXMuY2FudmFzLmFkZEV2ZW50TGlzdGVuZXIoJ3RvdWNoc3RhcnQnLCB0aGlzLm9uTW91c2VEb3duLmJpbmQodGhpcyksIGZhbHNlKTtcclxuICAgICAgICAgICAgdGhpcy5jYW52YXMuYWRkRXZlbnRMaXN0ZW5lcignbW91c2V1cCcsIHRoaXMub25Nb3VzZVVwLmJpbmQodGhpcyksIGZhbHNlKTtcclxuICAgICAgICAgICAgdGhpcy5jYW52YXMuYWRkRXZlbnRMaXN0ZW5lcigndG91Y2hlbmQnLCB0aGlzLm9uTW91c2VVcC5iaW5kKHRoaXMpLCBmYWxzZSk7XHJcbiAgICAgICAgICAgIHRoaXMuY2FudmFzLmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNlbW92ZScsIHRoaXMub25Nb3VzZU1vdmUuYmluZCh0aGlzKSwgZmFsc2UpO1xyXG4gICAgICAgICAgICB0aGlzLmNhbnZhcy5hZGRFdmVudExpc3RlbmVyKCd0b3VjaG1vdmUnLCB0aGlzLm9uTW91c2VNb3ZlLmJpbmQodGhpcyksIGZhbHNlKTtcclxuICAgICAgICAgICAgdGhpcy5jYW52YXNDb250YWluZXJFbGVtZW50ID0gJCgnI2NhbnZhcy1jb250YWluZXInKTtcclxuICAgICAgICAgICAgdGhpcy5wYW5ab29tRWxlbWVudCA9IHRoaXMuY2FudmFzQ29udGFpbmVyRWxlbWVudC5maW5kKCcjY2FudmFzJykucGFuem9vbSh7XHJcbiAgICAgICAgICAgICAgICBjdXJzb3I6ICdkZWZhdWx0JyxcclxuICAgICAgICAgICAgICAgIHdoaWNoOiAzLFxyXG4gICAgICAgICAgICAgICAgLy8gcGFuT25seVdoZW5ab29tZWQ6IHRydWUsXHJcbiAgICAgICAgICAgICAgICAvLyBkaXNhYmxlUGFuOiBmYWxzZSxcclxuICAgICAgICAgICAgICAgIG1pblNjYWxlOiBDYW52YXMuWk9PTV9NSU5fU0NBTEUsXHJcbiAgICAgICAgICAgICAgICBtYXhTY2FsZTogQ2FudmFzLlpPT01fTUFYX1NDQUxFLFxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgdGhpcy5wYW5ab29tRWxlbWVudC5wYXJlbnQoKS5vbignbW91c2V3aGVlbC5mb2NhbCcsIGZ1bmN0aW9uIChlKSB7XHJcbiAgICAgICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICAgICAgICAgICAgICB2YXIgZGVsdGEgPSBlLmRlbHRhIHx8IGUub3JpZ2luYWxFdmVudC53aGVlbERlbHRhO1xyXG4gICAgICAgICAgICAgICAgdmFyIHpvb21PdXQgPSBkZWx0YSA/IGRlbHRhIDwgMCA6IGUub3JpZ2luYWxFdmVudC5kZWx0YVkgPiAwO1xyXG4gICAgICAgICAgICAgICAgX3RoaXMucGFuWm9vbUVsZW1lbnQucGFuem9vbSgnem9vbScsIHpvb21PdXQsIHtcclxuICAgICAgICAgICAgICAgICAgICBhbmltYXRlOiBmYWxzZSxcclxuICAgICAgICAgICAgICAgICAgICBmb2NhbDogZVxyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB0aGlzLnBhblpvb21FbGVtZW50Lm9uKCdwYW56b29tY2hhbmdlJywgZnVuY3Rpb24gKGUsIHBhbnpvb20sIHRyYW5zZm9ybSkge1xyXG4gICAgICAgICAgICAgICAgX3RoaXMuem9vbVNjYWxlID0gdHJhbnNmb3JtWzBdO1xyXG4gICAgICAgICAgICAgICAgX3RoaXMudXBkYXRlVmlld3BvcnRDYW52YXMoKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICQoJyNjb29yZGluYXRlcy1jb250YWluZXInKS5kcmFnZ2FibGUoeyBheGlzOiAneScsIGNvbnRhaW5tZW50OiBcIiNjYW52YXMtY29udGFpbmVyXCIsIHNjcm9sbDogZmFsc2UgfSk7XHJcbiAgICAgICAgICAgIHdpbmRvdy5vbnJlc2l6ZSA9IHRoaXMub25XaW5kb3dSZXNpemUuYmluZCh0aGlzKTtcclxuICAgICAgICAgICAgdGhpcy5jdXJyZW50UG9zaXRpb25TdHIgPSBrby5vYnNlcnZhYmxlKCcnKTtcclxuICAgICAgICAgICAgdGhpcy5hdmFpbGFibGVDb2xvcnMgPSBrby5vYnNlcnZhYmxlQXJyYXkoQ2FudmFzLkNPTE9SX1BBTEVUVEVfMTYpO1xyXG4gICAgICAgICAgICB0aGlzLnNlbGVjdGVkQ29sb3JJbmRleCA9IGtvLm9ic2VydmFibGUoMCk7XHJcbiAgICAgICAgICAgIHRoaXMuYnVmZmVyID0gbmV3IEFycmF5QnVmZmVyKENhbnZhcy5CT0FSRF9XSURUSF9QWCAqIENhbnZhcy5CT0FSRF9IRUlHSFRfUFggKiA0KTtcclxuICAgICAgICAgICAgdGhpcy5yZWFkQnVmZmVyID0gbmV3IFVpbnQ4Q2xhbXBlZEFycmF5KHRoaXMuYnVmZmVyKTtcclxuICAgICAgICAgICAgdGhpcy53cml0ZUJ1ZmZlciA9IG5ldyBVaW50MzJBcnJheSh0aGlzLmJ1ZmZlcik7XHJcbiAgICAgICAgICAgIHRoaXMuZHJhd2luZ0J1ZmZlciA9IG5ldyBkcmF3aW5nQnVmZmVyXzEuRHJhd2luZ0J1ZmZlcih0aGlzLmRyYXdNb2RlKCkgPT09IERyYXdNb2Rlcy5GcmVlaGFuZCk7XHJcbiAgICAgICAgICAgIHRoaXMudG91Y2hTdGF0ZSA9IFRvdWNoU3RhdGVzLlVwO1xyXG4gICAgICAgICAgICB0aGlzLmxhc3RNb3VzZURvd25Qb3NpdGlvbiA9IG51bGw7XHJcbiAgICAgICAgICAgIHRoaXMudG90YWxEcmFnRGlzdGFuY2UgPSAwO1xyXG4gICAgICAgICAgICB0aGlzLm9uV2luZG93UmVzaXplKCk7XHJcbiAgICAgICAgICAgIHRoaXMuc3RhcnRSZW5kZXJpbmdMb29wKHRoaXMuZmx1c2hEcmF3aW5nUXVldWUuYmluZCh0aGlzKSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIENhbnZhcy5wcm90b3R5cGUub25XaW5kb3dSZXNpemUgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIC8vIFZpZXdwb3J0IGNhbnZhcyBzaXplIG1hdGNoZXMgY2FudmFzIGNvbnRhaW5lciBzaXplXHJcbiAgICAgICAgICAgIHRoaXMudmlld3BvcnRDYW52YXMud2lkdGggPSB0aGlzLmNhbnZhc0NvbnRhaW5lckVsZW1lbnQud2lkdGgoKTtcclxuICAgICAgICAgICAgdGhpcy52aWV3cG9ydENhbnZhcy5oZWlnaHQgPSB0aGlzLmNhbnZhc0NvbnRhaW5lckVsZW1lbnQuaGVpZ2h0KCk7XHJcbiAgICAgICAgICAgIHRoaXMuY2VudGVyQ2FudmFzKCk7XHJcbiAgICAgICAgfTtcclxuICAgICAgICBDYW52YXMucHJvdG90eXBlLmNlbnRlckNhbnZhcyA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgdmFyIEJPUkRFUl9QWCA9IDE7XHJcbiAgICAgICAgICAgIHZhciBjb250YWluZXJXaWR0aCA9IHRoaXMuY2FudmFzQ29udGFpbmVyRWxlbWVudC53aWR0aCgpO1xyXG4gICAgICAgICAgICB2YXIgY29udGFpbmVySGVpZ2h0ID0gdGhpcy5jYW52YXNDb250YWluZXJFbGVtZW50LmhlaWdodCgpO1xyXG4gICAgICAgICAgICB2YXIgem9vbVggPSAoY29udGFpbmVyV2lkdGggLSBCT1JERVJfUFgpIC8gQ2FudmFzLkJPQVJEX1dJRFRIX1BYO1xyXG4gICAgICAgICAgICB2YXIgem9vbVkgPSAoY29udGFpbmVySGVpZ2h0IC0gQk9SREVSX1BYKSAvIENhbnZhcy5CT0FSRF9IRUlHSFRfUFg7XHJcbiAgICAgICAgICAgIHZhciB6b29tID0gTWF0aC5taW4oem9vbVgsIHpvb21ZKTtcclxuICAgICAgICAgICAgdmFyIHBhblggPSBjb250YWluZXJXaWR0aCAvIDIgLSAoQ2FudmFzLkJPQVJEX1dJRFRIX1BYIC8gMik7XHJcbiAgICAgICAgICAgIHZhciBwYW5ZID0gY29udGFpbmVySGVpZ2h0IC8gMiAtIChDYW52YXMuQk9BUkRfSEVJR0hUX1BYIC8gMik7XHJcbiAgICAgICAgICAgIHZhciBjYW52YXNSZWN0ID0gdGhpcy5jYW52YXMuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7XHJcbiAgICAgICAgICAgIHRoaXMucGFuWm9vbUVsZW1lbnQucGFuem9vbSgnem9vbScsIHpvb20sIHtcclxuICAgICAgICAgICAgICAgIGFuaW1hdGU6IGZhbHNlLFxyXG4gICAgICAgICAgICAgICAgZm9jYWw6IHsgY2xpZW50WDogY2FudmFzUmVjdC5sZWZ0LCBjbGllbnRZOiBjYW52YXNSZWN0LnRvcCB9XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB0aGlzLnBhblpvb21FbGVtZW50LnBhbnpvb20oJ3BhbicsIHBhblgsIHBhblksIHsgcmVsYXRpdmU6IGZhbHNlIH0pO1xyXG4gICAgICAgICAgICB0aGlzLnBhblpvb21FbGVtZW50LnBhbnpvb20oJ29wdGlvbicsICdtaW5TY2FsZScsIHpvb20pO1xyXG4gICAgICAgIH07XHJcbiAgICAgICAgQ2FudmFzLnByb3RvdHlwZS5mbHVzaERyYXdpbmdRdWV1ZSA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgdmFyIF90aGlzID0gdGhpcztcclxuICAgICAgICAgICAgdmFyIHhtaW4gPSBDYW52YXMuQk9BUkRfV0lEVEhfUFg7XHJcbiAgICAgICAgICAgIHZhciB4bWF4ID0gMDtcclxuICAgICAgICAgICAgdmFyIHltaW4gPSBDYW52YXMuQk9BUkRfSEVJR0hUX1BYO1xyXG4gICAgICAgICAgICB2YXIgeW1heCA9IDA7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLnBlbmRpbmdCb2FyZCkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5yZW5kZXJCb2FyZCh0aGlzLnBlbmRpbmdCb2FyZCk7XHJcbiAgICAgICAgICAgICAgICB4bWluID0gMDtcclxuICAgICAgICAgICAgICAgIHltaW4gPSAwO1xyXG4gICAgICAgICAgICAgICAgeG1heCA9IENhbnZhcy5CT0FSRF9XSURUSF9QWDtcclxuICAgICAgICAgICAgICAgIHltYXggPSBDYW52YXMuQk9BUkRfSEVJR0hUX1BYO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICQuZWFjaCh0aGlzLmRyYXdpbmdRdWV1ZSwgZnVuY3Rpb24gKGluZGV4LCB1cGRhdGUpIHtcclxuICAgICAgICAgICAgICAgIF90aGlzLnBhaW50VG9DYW52YXModXBkYXRlKTtcclxuICAgICAgICAgICAgICAgIHhtaW4gPSBNYXRoLm1pbih4bWluLCB1cGRhdGUueCk7XHJcbiAgICAgICAgICAgICAgICB5bWluID0gTWF0aC5taW4oeW1pbiwgdXBkYXRlLnkpO1xyXG4gICAgICAgICAgICAgICAgeG1heCA9IE1hdGgubWF4KHhtYXgsIHVwZGF0ZS54ICsgMSk7XHJcbiAgICAgICAgICAgICAgICB5bWF4ID0gTWF0aC5tYXgoeW1heCwgdXBkYXRlLnkgKyAxKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLmRyYXdpbmdRdWV1ZS5sZW5ndGggPiAwIHx8IHRoaXMucGVuZGluZ0JvYXJkKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnVwZGF0ZVZpZXdwb3J0Q2FudmFzKHsgeDE6IHhtaW4sIHkxOiB5bWluLCB4MjogeG1heCwgeTI6IHltYXggfSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdGhpcy5kcmF3aW5nUXVldWUgPSBbXTtcclxuICAgICAgICAgICAgdGhpcy5wZW5kaW5nQm9hcmQgPSBudWxsO1xyXG4gICAgICAgIH07XHJcbiAgICAgICAgLyoqXHJcbiAgICAgICAgICpcclxuICAgICAgICAgKiBAcGFyYW0gZm5cclxuICAgICAgICAgKiBAcmV0dXJuIGNhbmNlbGluZyBmdW5jdGlvblxyXG4gICAgICAgICAqL1xyXG4gICAgICAgIENhbnZhcy5wcm90b3R5cGUuc3RhcnRSZW5kZXJpbmdMb29wID0gZnVuY3Rpb24gKGZuKSB7XHJcbiAgICAgICAgICAgIHZhciBleGVjdXRlRm4gPSBmdW5jdGlvbiAodHMpIHtcclxuICAgICAgICAgICAgICAgIGZuKCk7XHJcbiAgICAgICAgICAgICAgICByZXF1ZXN0SWQgPSB3aW5kb3cucmVxdWVzdEFuaW1hdGlvbkZyYW1lKGV4ZWN1dGVGbik7XHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIHZhciByZXF1ZXN0SWQgPSB3aW5kb3cucmVxdWVzdEFuaW1hdGlvbkZyYW1lKGV4ZWN1dGVGbik7XHJcbiAgICAgICAgICAgIHJldHVybiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICB3aW5kb3cuY2FuY2VsQW5pbWF0aW9uRnJhbWUocmVxdWVzdElkKTtcclxuICAgICAgICAgICAgfTtcclxuICAgICAgICB9O1xyXG4gICAgICAgIENhbnZhcy5wcm90b3R5cGUuc2VsZWN0Q29sb3JJbmRleCA9IGZ1bmN0aW9uIChpbmRleCkge1xyXG4gICAgICAgICAgICB0aGlzLnNlbGVjdGVkQ29sb3JJbmRleChpbmRleCk7XHJcbiAgICAgICAgfTtcclxuICAgICAgICBDYW52YXMucHJvdG90eXBlLnRvUkdCQSA9IGZ1bmN0aW9uIChpbmRleCkge1xyXG4gICAgICAgICAgICB2YXIgY29sb3IgPSB0aGlzLmF2YWlsYWJsZUNvbG9ycygpW2luZGV4XTtcclxuICAgICAgICAgICAgcmV0dXJuIFwicmdiYShcIiArIGNvbG9yLnIgKyBcIixcIiArIGNvbG9yLmcgKyBcIixcIiArIGNvbG9yLmIgKyBcIixcIiArIGNvbG9yLmEgKyBcIilcIjtcclxuICAgICAgICB9O1xyXG4gICAgICAgIENhbnZhcy5wcm90b3R5cGUuZ2V0SW50ZXJtZWRpYXRlQmF0Y2hTaXplID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICB2YXIgYmF0Y2hTaXplID0gdGhpcy5jdXJyZW50QmF0Y2hTaXplO1xyXG4gICAgICAgICAgICB0aGlzLmN1cnJlbnRCYXRjaFNpemUgPSAodGhpcy5jdXJyZW50QmF0Y2hTaXplICsgdGhpcy5TVEVQX1NJWkUpICUgdGhpcy5NQVhfQkFUQ0hfU0laRTtcclxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuY3VycmVudEJhdGNoU2l6ZTtcclxuICAgICAgICB9O1xyXG4gICAgICAgIENhbnZhcy5wcm90b3R5cGUub25Nb3VzZU1vdmUgPSBmdW5jdGlvbiAoZSkge1xyXG4gICAgICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xyXG4gICAgICAgICAgICB2YXIgcG9zaXRpb247XHJcbiAgICAgICAgICAgIGlmIChlIGluc3RhbmNlb2YgTW91c2VFdmVudCkge1xyXG4gICAgICAgICAgICAgICAgaWYgKGUuYnV0dG9uICE9PSAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gSWdub3JlIGFsbCBidXQgbGVmdCBidXR0b24gZG93blxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIHBvc2l0aW9uID0gdGhpcy5nZXRDYW52YXNDb29yZGluYXRlcyhlLmNsaWVudFgsIGUuY2xpZW50WSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSBpZiAoZSBpbnN0YW5jZW9mIFRvdWNoRXZlbnQpIHtcclxuICAgICAgICAgICAgICAgIGlmIChlLnRvdWNoZXMubGVuZ3RoID4gMSB8fCB0aGlzLnRvdWNoU3RhdGUgPT09IFRvdWNoU3RhdGVzLk11bHRpRG93bikge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMudG91Y2hTdGF0ZSA9IFRvdWNoU3RhdGVzLk11bHRpRG93bjtcclxuICAgICAgICAgICAgICAgICAgICAvLyBNdWx0aXRvdWNoaW5nIChwaW5jaGluZylcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB2YXIgdCA9IGUudG91Y2hlc1swXTtcclxuICAgICAgICAgICAgICAgIHBvc2l0aW9uID0gdGhpcy5nZXRDYW52YXNDb29yZGluYXRlcyh0LmNsaWVudFgsIHQuY2xpZW50WSk7XHJcbiAgICAgICAgICAgICAgICBlLnN0b3BJbW1lZGlhdGVQcm9wYWdhdGlvbigpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcignVW5rbm93biBldmVudCcsIGUpO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHRoaXMuY3VycmVudFBvc2l0aW9uU3RyKHBvc2l0aW9uLnggKyAxICsgXCIsIFwiICsgKHBvc2l0aW9uLnkgKyAxKSk7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLmRyYXdNb2RlKCkgPT09IERyYXdNb2Rlcy5GcmVlaGFuZCAmJiB0aGlzLnRvdWNoU3RhdGUgPT09IFRvdWNoU3RhdGVzLlNpbmdsZURvd24pIHtcclxuICAgICAgICAgICAgICAgIHZhciB1cGRhdGVzID0gdGhpcy5kcmF3aW5nQnVmZmVyLnBlbk1vdmUocG9zaXRpb24sIHRoaXMuc2VsZWN0ZWRDb2xvckluZGV4KCkpO1xyXG4gICAgICAgICAgICAgICAgJC5lYWNoKHVwZGF0ZXMsIGZ1bmN0aW9uIChpbmRleCwgdXBkYXRlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgX3RoaXMucXVldWVQaXhlbFVwZGF0ZSh1cGRhdGUpO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICB2YXIgcGVuZGluZ1VwZGF0ZXMgPSB0aGlzLmRyYXdpbmdCdWZmZXIuZ2V0QWxsVXBkYXRlcygpO1xyXG4gICAgICAgICAgICAgICAgaWYgKHBlbmRpbmdVcGRhdGVzLmxlbmd0aCA+IHRoaXMuZ2V0SW50ZXJtZWRpYXRlQmF0Y2hTaXplKCkpIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLnBhcmFtcy5vblBpeGVsVXBkYXRlc1N1Ym1pdHRlZChwZW5kaW5nVXBkYXRlcyk7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5kcmF3aW5nQnVmZmVyLnJlc2V0KCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBpZiAodGhpcy50b3VjaFN0YXRlID09PSBUb3VjaFN0YXRlcy5TaW5nbGVEb3duKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuem9vbVNjYWxlIDwgQ2FudmFzLlVOU1RBQkxFX1pPT00pIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gWm9vbSB0b28gbG93LCBwYW5uaW5nIHRvIGppdHRlcnkgYW5kIHBvc2l0aW9uIGRpdmVyZ2VzLiBEaXNhYmxlIHBhbm5pbmcuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGR4ID0gcG9zaXRpb24ueCAtIHRoaXMubGFzdE1vdXNlRG93blBvc2l0aW9uLng7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGR5ID0gcG9zaXRpb24ueSAtIHRoaXMubGFzdE1vdXNlRG93blBvc2l0aW9uLnk7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5wYW5ab29tRWxlbWVudC5wYW56b29tKCdwYW4nLCBkeCwgZHksIHsgcmVsYXRpdmU6IHRydWUgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy50b3RhbERyYWdEaXN0YW5jZSArPSBNYXRoLmh5cG90KGR4LCBkeSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG4gICAgICAgIENhbnZhcy5wcm90b3R5cGUub25Nb3VzZURvd24gPSBmdW5jdGlvbiAoZSkge1xyXG4gICAgICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xyXG4gICAgICAgICAgICB0aGlzLnRvdGFsRHJhZ0Rpc3RhbmNlID0gMDtcclxuICAgICAgICAgICAgdGhpcy5jdXJyZW50QmF0Y2hTaXplID0gdGhpcy5NSU5fQkFUQ0hfU0laRTtcclxuICAgICAgICAgICAgdmFyIHBvc2l0aW9uO1xyXG4gICAgICAgICAgICBpZiAoZSBpbnN0YW5jZW9mIE1vdXNlRXZlbnQpIHtcclxuICAgICAgICAgICAgICAgIGlmIChlLmJ1dHRvbiAhPT0gMCkge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIElnbm9yZSBhbGwgYnV0IGxlZnQgYnV0dG9uIGRvd25cclxuICAgICAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB0aGlzLnRvdWNoU3RhdGUgPSBUb3VjaFN0YXRlcy5TaW5nbGVEb3duO1xyXG4gICAgICAgICAgICAgICAgcG9zaXRpb24gPSB0aGlzLmdldENhbnZhc0Nvb3JkaW5hdGVzKGUuY2xpZW50WCwgZS5jbGllbnRZKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlIGlmIChlIGluc3RhbmNlb2YgVG91Y2hFdmVudCkge1xyXG4gICAgICAgICAgICAgICAgdmFyIHQgPSBlLnRvdWNoZXNbMF07XHJcbiAgICAgICAgICAgICAgICBwb3NpdGlvbiA9IHRoaXMuZ2V0Q2FudmFzQ29vcmRpbmF0ZXModC5jbGllbnRYLCB0LmNsaWVudFkpO1xyXG4gICAgICAgICAgICAgICAgc3dpdGNoICh0aGlzLnRvdWNoU3RhdGUpIHtcclxuICAgICAgICAgICAgICAgICAgICBjYXNlIFRvdWNoU3RhdGVzLlVwOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnRvdWNoU3RhdGUgPSBUb3VjaFN0YXRlcy5TaW5nbGVEb3duO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICBjYXNlIFRvdWNoU3RhdGVzLlNpbmdsZURvd246XHJcbiAgICAgICAgICAgICAgICAgICAgY2FzZSBUb3VjaFN0YXRlcy5NdWx0aURvd246XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudG91Y2hTdGF0ZSA9IFRvdWNoU3RhdGVzLk11bHRpRG93bjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDogYnJlYWs7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKCdVbmtub3duIGV2ZW50JywgZSk7XHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdGhpcy5sYXN0TW91c2VEb3duUG9zaXRpb24gPSBwb3NpdGlvbjtcclxuICAgICAgICAgICAgaWYgKHRoaXMuZHJhd01vZGUoKSA9PT0gRHJhd01vZGVzLkZyZWVoYW5kIHx8IHRoaXMuZHJhd01vZGUoKSA9PT0gRHJhd01vZGVzLlBpeGVsKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgdXBkYXRlcyA9IHRoaXMuZHJhd2luZ0J1ZmZlci5wZW5Eb3duKHBvc2l0aW9uLCB0aGlzLnNlbGVjdGVkQ29sb3JJbmRleCgpKTtcclxuICAgICAgICAgICAgICAgICQuZWFjaCh1cGRhdGVzLCBmdW5jdGlvbiAoaW5kZXgsIHVwZGF0ZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIF90aGlzLnF1ZXVlUGl4ZWxVcGRhdGUodXBkYXRlKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuICAgICAgICBDYW52YXMucHJvdG90eXBlLm9uTW91c2VVcCA9IGZ1bmN0aW9uIChlKSB7XHJcbiAgICAgICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLnRvdWNoU3RhdGUgPT09IFRvdWNoU3RhdGVzLlNpbmdsZURvd24pIHtcclxuICAgICAgICAgICAgICAgIHZhciBwb3NpdGlvbiA9IG51bGw7XHJcbiAgICAgICAgICAgICAgICBpZiAoZSBpbnN0YW5jZW9mIE1vdXNlRXZlbnQpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoZS5idXR0b24gIT09IDApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gSWdub3JlIGFsbCBidXQgbGVmdCBidXR0b24gZG93blxyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIHBvc2l0aW9uID0gdGhpcy5nZXRDYW52YXNDb29yZGluYXRlcyhlLmNsaWVudFgsIGUuY2xpZW50WSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBlbHNlIGlmIChlIGluc3RhbmNlb2YgVG91Y2hFdmVudCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChlLnRvdWNoZXMubGVuZ3RoID4gMSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgdCA9IGUudG91Y2hlc1swXTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcG9zaXRpb24gPSB0aGlzLmdldENhbnZhc0Nvb3JkaW5hdGVzKHQuY2xpZW50WCwgdC5jbGllbnRZKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKCdVbmtub3duIGV2ZW50JywgZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgdmFyIGhhc01vdXNlTW92ZWQgPSB0aGlzLnRvdGFsRHJhZ0Rpc3RhbmNlID4gQ2FudmFzLk1JTl9NT1VTRV9NT1ZFX1BYO1xyXG4gICAgICAgICAgICAgICAgaWYgKCh0aGlzLmRyYXdNb2RlKCkgPT09IERyYXdNb2Rlcy5QaXhlbCAmJiAhaGFzTW91c2VNb3ZlZCkgfHwgdGhpcy5kcmF3TW9kZSgpID09PSBEcmF3TW9kZXMuRnJlZWhhbmQpIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgdXBkYXRlcyA9IHRoaXMuZHJhd2luZ0J1ZmZlci5wZW5VcChwb3NpdGlvbiwgdGhpcy5zZWxlY3RlZENvbG9ySW5kZXgoKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgJC5lYWNoKHVwZGF0ZXMsIGZ1bmN0aW9uIChpbmRleCwgdXBkYXRlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzLnF1ZXVlUGl4ZWxVcGRhdGUodXBkYXRlKTtcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLnBhcmFtcy5vblBpeGVsVXBkYXRlc1N1Ym1pdHRlZCh0aGlzLmRyYXdpbmdCdWZmZXIuZ2V0QWxsVXBkYXRlcygpKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGVsc2UgaWYgKHRoaXMuZHJhd01vZGUoKSA9PT0gRHJhd01vZGVzLkRpc2FibGVkICYmICFoYXNNb3VzZU1vdmVkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5wYXJhbXMub25EaXNhYmxlZFBpeGVsSW5zZXJ0KCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB0aGlzLmRyYXdpbmdCdWZmZXIucmVzZXQoKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB0aGlzLnRvdWNoU3RhdGUgPSBUb3VjaFN0YXRlcy5VcDtcclxuICAgICAgICB9O1xyXG4gICAgICAgIENhbnZhcy5wcm90b3R5cGUucGFpbnRUb0NhbnZhcyA9IGZ1bmN0aW9uICh1cGRhdGUpIHtcclxuICAgICAgICAgICAgdmFyIGNvbG9yID0gdGhpcy5hdmFpbGFibGVDb2xvcnMoKVt1cGRhdGUuY29sb3JdO1xyXG4gICAgICAgICAgICBpZiAoIWNvbG9yKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKCdVbmtub3duIGNvbG9yJywgdXBkYXRlLmNvbG9yKTtcclxuICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB2YXIgaW1nRGF0YSA9IHRoaXMuY29udGV4dC5jcmVhdGVJbWFnZURhdGEoMSwgMSk7XHJcbiAgICAgICAgICAgIHZhciBkID0gaW1nRGF0YS5kYXRhO1xyXG4gICAgICAgICAgICBkWzBdID0gY29sb3IucjtcclxuICAgICAgICAgICAgZFsxXSA9IGNvbG9yLmc7XHJcbiAgICAgICAgICAgIGRbMl0gPSBjb2xvci5iO1xyXG4gICAgICAgICAgICBkWzNdID0gY29sb3IuYTtcclxuICAgICAgICAgICAgdGhpcy5jb250ZXh0LnB1dEltYWdlRGF0YShpbWdEYXRhLCB1cGRhdGUueCwgdXBkYXRlLnkpO1xyXG4gICAgICAgIH07XHJcbiAgICAgICAgLyoqXHJcbiAgICAgICAgICogQ29udmVydCBtb3VzZSB4LHkgdG8gY2FudmFzIHgseVxyXG4gICAgICAgICAqIEBwYXJhbSB4XHJcbiAgICAgICAgICogQHBhcmFtIHlcclxuICAgICAgICAgKi9cclxuICAgICAgICBDYW52YXMucHJvdG90eXBlLmdldENhbnZhc0Nvb3JkaW5hdGVzID0gZnVuY3Rpb24gKHgsIHkpIHtcclxuICAgICAgICAgICAgdmFyIHIgPSB0aGlzLmNhbnZhcy5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTtcclxuICAgICAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgICAgIHg6IE1hdGguZmxvb3IoKHggLSByLmxlZnQpIC8gdGhpcy56b29tU2NhbGUpLFxyXG4gICAgICAgICAgICAgICAgeTogTWF0aC5mbG9vcigoeSAtIHIudG9wKSAvIHRoaXMuem9vbVNjYWxlKVxyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgIH07XHJcbiAgICAgICAgQ2FudmFzLnByb3RvdHlwZS5xdWV1ZVBpeGVsVXBkYXRlID0gZnVuY3Rpb24gKGRhdGEpIHtcclxuICAgICAgICAgICAgdGhpcy5oaXN0b3J5QnVmZmVyLnB1c2goZGF0YSk7XHJcbiAgICAgICAgICAgIHRoaXMuZHJhd2luZ1F1ZXVlLnB1c2goZGF0YSk7XHJcbiAgICAgICAgfTtcclxuICAgICAgICBDYW52YXMucHJvdG90eXBlLnF1ZXVlQm9hcmRVcGRhdGUgPSBmdW5jdGlvbiAoYm9hcmQpIHtcclxuICAgICAgICAgICAgdGhpcy5wZW5kaW5nQm9hcmQgPSBib2FyZDtcclxuICAgICAgICB9O1xyXG4gICAgICAgIENhbnZhcy5wcm90b3R5cGUucmVuZGVyQm9hcmQgPSBmdW5jdGlvbiAoYm9hcmQpIHtcclxuICAgICAgICAgICAgdmFyIHN0YXJ0ID0gcGVyZm9ybWFuY2Uubm93KCk7XHJcbiAgICAgICAgICAgIC8vIEZvciBub3csIGp1c3QgZHJhdyBpdCBkaXJlY3RseSBvbnRvIGNhbnZhc1xyXG4gICAgICAgICAgICB2YXIgeCA9IDA7XHJcbiAgICAgICAgICAgIHZhciB5ID0gMDtcclxuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBib2FyZC5ieXRlTGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgICAgIHZhciBjb2xvciA9IENhbnZhcy5DT0xPUl9QQUxFVFRFXzE2W2JvYXJkW2ldXTtcclxuICAgICAgICAgICAgICAgIHRoaXMud3JpdGVCdWZmZXJbeSAqIENhbnZhcy5CT0FSRF9XSURUSF9QWCArIHhdID0gY29sb3IudjMyO1xyXG4gICAgICAgICAgICAgICAgaWYgKCsreCA+PSBDYW52YXMuQk9BUkRfV0lEVEhfUFgpIHtcclxuICAgICAgICAgICAgICAgICAgICB4ID0gMDtcclxuICAgICAgICAgICAgICAgICAgICB5Kys7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgd2hpbGUgKHRoaXMuaGlzdG9yeUJ1ZmZlci5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgcHggPSB0aGlzLmhpc3RvcnlCdWZmZXIucG9wKCk7XHJcbiAgICAgICAgICAgICAgICB2YXIgY29sb3IgPSBDYW52YXMuQ09MT1JfUEFMRVRURV8xNltweC5jb2xvcl07XHJcbiAgICAgICAgICAgICAgICB0aGlzLndyaXRlQnVmZmVyW3B4LnkgKiBDYW52YXMuQk9BUkRfV0lEVEhfUFggKyBweC54XSA9IGNvbG9yLnYzMjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAvLyBOb3cgcGFpbnQgb3ZlciBjYW52YXNcclxuICAgICAgICAgICAgdmFyIGltYWdlRGF0YSA9IG5ldyBJbWFnZURhdGEodGhpcy5yZWFkQnVmZmVyLCBDYW52YXMuQk9BUkRfV0lEVEhfUFgsIENhbnZhcy5CT0FSRF9IRUlHSFRfUFgpO1xyXG4gICAgICAgICAgICB0aGlzLmNvbnRleHQucHV0SW1hZ2VEYXRhKGltYWdlRGF0YSwgMCwgMCk7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKFwicmVuZGVyQm9hcmQoKTogXCIgKyAocGVyZm9ybWFuY2Uubm93KCkgLSBzdGFydCkgKyBcIiBtc1wiKTtcclxuICAgICAgICB9O1xyXG4gICAgICAgIC8qKlxyXG4gICAgICAgICAqIENvcHkgY2FudmFzIG9udG8gdmlld3BvcnQgY2FudmFzICh0aGlzIGFkZHJlc3NlcyBibHVycmVkIEVkZ2UgcGl4ZWwgaXNzdWUpXHJcbiAgICAgICAgICogQHBhcmFtIHVwZGF0ZVJlY3QgaWYgc3BlY2lmaWVkOiBvbmx5IGNvcHkgdGhpcyByZWN0YW5nbGUgKGluIHNvdXJjZSBjb29yZGluYXRlcylcclxuICAgICAgICAgKi9cclxuICAgICAgICBDYW52YXMucHJvdG90eXBlLnVwZGF0ZVZpZXdwb3J0Q2FudmFzID0gZnVuY3Rpb24gKHVwZGF0ZVJlY3QpIHtcclxuICAgICAgICAgICAgdmFyIGMgPSB0aGlzLmNhbnZhcy5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTtcclxuICAgICAgICAgICAgdmFyIHYgPSB0aGlzLnZpZXdwb3J0Q2FudmFzLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xyXG4gICAgICAgICAgICB2YXIgY3ggPSBjLmxlZnQgLSB2LmxlZnQ7XHJcbiAgICAgICAgICAgIHZhciBjeSA9IGMudG9wIC0gdi50b3A7XHJcbiAgICAgICAgICAgIC8vIE1vcmUgcHJlY2lzZSBhbmQgc2VsZi1jb250YWluZWQgdGhhbiB1c2luZyB0aGlzLnpvb21TY2FsZVxyXG4gICAgICAgICAgICB2YXIgem9vbVNjYWxlID0gYy53aWR0aCAvIENhbnZhcy5CT0FSRF9XSURUSF9QWDtcclxuICAgICAgICAgICAgaWYgKCF1cGRhdGVSZWN0KSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnZpZXdwb3J0Q29udGV4dC5jbGVhclJlY3QoMCwgMCwgdi53aWR0aCwgdi5oZWlnaHQpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHZhciBzeCA9IDA7XHJcbiAgICAgICAgICAgIHZhciBzeSA9IDA7XHJcbiAgICAgICAgICAgIHZhciBzdyA9IENhbnZhcy5CT0FSRF9XSURUSF9QWDtcclxuICAgICAgICAgICAgdmFyIHNoID0gQ2FudmFzLkJPQVJEX0hFSUdIVF9QWDtcclxuICAgICAgICAgICAgdmFyIGR4ID0gY3g7XHJcbiAgICAgICAgICAgIHZhciBkeSA9IGN5O1xyXG4gICAgICAgICAgICB2YXIgZHcgPSBDYW52YXMuQk9BUkRfV0lEVEhfUFggKiB6b29tU2NhbGU7XHJcbiAgICAgICAgICAgIHZhciBkaCA9IENhbnZhcy5CT0FSRF9IRUlHSFRfUFggKiB6b29tU2NhbGU7XHJcbiAgICAgICAgICAgIGlmICh1cGRhdGVSZWN0KSB7XHJcbiAgICAgICAgICAgICAgICBzeCA9IHVwZGF0ZVJlY3QueDE7XHJcbiAgICAgICAgICAgICAgICBzeSA9IHVwZGF0ZVJlY3QueTE7XHJcbiAgICAgICAgICAgICAgICBzdyA9IHVwZGF0ZVJlY3QueDIgLSB1cGRhdGVSZWN0LngxO1xyXG4gICAgICAgICAgICAgICAgc2ggPSB1cGRhdGVSZWN0LnkyIC0gdXBkYXRlUmVjdC55MTtcclxuICAgICAgICAgICAgICAgIGR4ID0gY3ggKyB1cGRhdGVSZWN0LngxICogem9vbVNjYWxlO1xyXG4gICAgICAgICAgICAgICAgZHkgPSBjeSArIHVwZGF0ZVJlY3QueTEgKiB6b29tU2NhbGU7XHJcbiAgICAgICAgICAgICAgICBkdyA9IHN3ICogem9vbVNjYWxlO1xyXG4gICAgICAgICAgICAgICAgZGggPSBzaCAqIHpvb21TY2FsZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB0aGlzLnZpZXdwb3J0Q29udGV4dC5tb3pJbWFnZVNtb290aGluZ0VuYWJsZWQgPSBmYWxzZTtcclxuICAgICAgICAgICAgdGhpcy52aWV3cG9ydENvbnRleHQud2Via2l0SW1hZ2VTbW9vdGhpbmdFbmFibGVkID0gZmFsc2U7XHJcbiAgICAgICAgICAgIHRoaXMudmlld3BvcnRDb250ZXh0Lm1zSW1hZ2VTbW9vdGhpbmdFbmFibGVkID0gZmFsc2U7XHJcbiAgICAgICAgICAgIHRoaXMudmlld3BvcnRDb250ZXh0LmltYWdlU21vb3RoaW5nRW5hYmxlZCA9IGZhbHNlO1xyXG4gICAgICAgICAgICB0aGlzLnZpZXdwb3J0Q29udGV4dC5kcmF3SW1hZ2UodGhpcy5jYW52YXMsIHN4LCBzeSwgc3csIHNoLCBkeCwgZHksIGR3LCBkaCk7XHJcbiAgICAgICAgICAgIHRoaXMudXBkYXRlVGh1bWJuYWlsQ2FudmFzKCk7XHJcbiAgICAgICAgfTtcclxuICAgICAgICBDYW52YXMucHJvdG90eXBlLnVwZGF0ZVRodW1ibmFpbENhbnZhcyA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgdmFyIGMgPSB0aGlzLmNhbnZhcy5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTtcclxuICAgICAgICAgICAgdmFyIHYgPSB0aGlzLnZpZXdwb3J0Q2FudmFzLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xyXG4gICAgICAgICAgICB2YXIgY3ggPSBjLmxlZnQgLSB2LmxlZnQ7XHJcbiAgICAgICAgICAgIHZhciBjeSA9IGMudG9wIC0gdi50b3A7XHJcbiAgICAgICAgICAgIHZhciB0V2lkdGggPSAodi53aWR0aCAvIGMud2lkdGgpICogQ2FudmFzLkJPQVJEX1dJRFRIX1BYICogdGhpcy50aHVtYm5haWxGYWN0b3I7XHJcbiAgICAgICAgICAgIHZhciB0SGVpZ2h0ID0gKHYuaGVpZ2h0IC8gYy5oZWlnaHQpICogQ2FudmFzLkJPQVJEX0hFSUdIVF9QWCAqIHRoaXMudGh1bWJuYWlsRmFjdG9yO1xyXG4gICAgICAgICAgICB2YXIgc3ggPSAwO1xyXG4gICAgICAgICAgICB2YXIgc3kgPSAwO1xyXG4gICAgICAgICAgICB2YXIgc3cgPSBDYW52YXMuQk9BUkRfV0lEVEhfUFg7XHJcbiAgICAgICAgICAgIHZhciBzaCA9IENhbnZhcy5CT0FSRF9IRUlHSFRfUFg7XHJcbiAgICAgICAgICAgIHZhciBkeCA9IDA7XHJcbiAgICAgICAgICAgIHZhciBkeSA9IDA7XHJcbiAgICAgICAgICAgIHZhciBkdyA9IENhbnZhcy5CT0FSRF9XSURUSF9QWCAqIHRoaXMudGh1bWJuYWlsRmFjdG9yO1xyXG4gICAgICAgICAgICB2YXIgZGggPSBDYW52YXMuQk9BUkRfSEVJR0hUX1BYICogdGhpcy50aHVtYm5haWxGYWN0b3I7XHJcbiAgICAgICAgICAgIC8vIERyYXcgcmVjdGFuZ2xlIHRoYXQgcmVwcmVzZW50cyB0aGUgdmlld3BvcnRcclxuICAgICAgICAgICAgLy8gTW9yZSBwcmVjaXNlIGFuZCBzZWxmLWNvbnRhaW5lZCB0aGFuIHVzaW5nIHRoaXMuem9vbVNjYWxlXHJcbiAgICAgICAgICAgIHZhciB6b29tU2NhbGUgPSBjLndpZHRoIC8gQ2FudmFzLkJPQVJEX1dJRFRIX1BYO1xyXG4gICAgICAgICAgICB2YXIgdG9wTGVmdCA9IHtcclxuICAgICAgICAgICAgICAgIHg6IC1jeCAqIHRoaXMudGh1bWJuYWlsRmFjdG9yIC8gem9vbVNjYWxlLFxyXG4gICAgICAgICAgICAgICAgeTogLWN5ICogdGhpcy50aHVtYm5haWxGYWN0b3IgLyB6b29tU2NhbGVcclxuICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgdGhpcy50aHVtYm5haWxDb250ZXh0Lm1vekltYWdlU21vb3RoaW5nRW5hYmxlZCA9IGZhbHNlO1xyXG4gICAgICAgICAgICB0aGlzLnRodW1ibmFpbENvbnRleHQud2Via2l0SW1hZ2VTbW9vdGhpbmdFbmFibGVkID0gZmFsc2U7XHJcbiAgICAgICAgICAgIHRoaXMudGh1bWJuYWlsQ29udGV4dC5tc0ltYWdlU21vb3RoaW5nRW5hYmxlZCA9IGZhbHNlO1xyXG4gICAgICAgICAgICB0aGlzLnRodW1ibmFpbENvbnRleHQuaW1hZ2VTbW9vdGhpbmdFbmFibGVkID0gZmFsc2U7XHJcbiAgICAgICAgICAgIC8vIEJhY2tncm91bmQgZGFya2VyXHJcbiAgICAgICAgICAgIHRoaXMudGh1bWJuYWlsQ29udGV4dC5jbGVhclJlY3QoMCwgMCwgZHcsIGRoKTtcclxuICAgICAgICAgICAgdGhpcy50aHVtYm5haWxDb250ZXh0LmZpbGxTdHlsZSA9ICdyZ2JhKDAsIDAsIDAsIDAuNCknO1xyXG4gICAgICAgICAgICB0aGlzLnRodW1ibmFpbENvbnRleHQuZmlsbFJlY3QoMCwgMCwgZHcsIGRoKTtcclxuICAgICAgICAgICAgLy8gRHJhdyBtYXNrXHJcbiAgICAgICAgICAgIHRoaXMudGh1bWJuYWlsQ29udGV4dC5jbGVhclJlY3QodG9wTGVmdC54LCB0b3BMZWZ0LnksIHRXaWR0aCwgdEhlaWdodCk7XHJcbiAgICAgICAgICAgIC8vIERyYXcgaW1hZ2VcclxuICAgICAgICAgICAgdGhpcy50aHVtYm5haWxDb250ZXh0Lmdsb2JhbENvbXBvc2l0ZU9wZXJhdGlvbiA9ICdkZXN0aW5hdGlvbi1vdmVyJztcclxuICAgICAgICAgICAgdGhpcy50aHVtYm5haWxDb250ZXh0LmRyYXdJbWFnZSh0aGlzLmNhbnZhcywgc3gsIHN5LCBzdywgc2gsIGR4LCBkeSwgZHcsIGRoKTtcclxuICAgICAgICB9O1xyXG4gICAgICAgIC8qKlxyXG4gICAgICAgICAqXHJcbiAgICAgICAgICogQHBhcmFtIHZhbHVlIHRydWU6IHpvb20gaW4sIGZhbHNlOiB6b29tIG91dCwgb3IgbnVtYmVyIGZvciB6b29tIHZhbHVlXHJcbiAgICAgICAgICovXHJcbiAgICAgICAgQ2FudmFzLnByb3RvdHlwZS5leGVjdXRlWm9vbSA9IGZ1bmN0aW9uICh2YWx1ZSkge1xyXG4gICAgICAgICAgICB2YXIgY29udGFpbmVyUG9zID0gdGhpcy5jYW52YXNDb250YWluZXJFbGVtZW50LnBvc2l0aW9uKCk7XHJcbiAgICAgICAgICAgIHZhciBjZW50ZXIgPSB7XHJcbiAgICAgICAgICAgICAgICB4OiBjb250YWluZXJQb3MubGVmdCArIHRoaXMuY2FudmFzQ29udGFpbmVyRWxlbWVudC53aWR0aCgpIC8gMixcclxuICAgICAgICAgICAgICAgIHk6IGNvbnRhaW5lclBvcy50b3AgKyB0aGlzLmNhbnZhc0NvbnRhaW5lckVsZW1lbnQuaGVpZ2h0KCkgLyAyXHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIHRoaXMucGFuWm9vbUVsZW1lbnQucGFuem9vbSgnem9vbScsIHZhbHVlLCB7XHJcbiAgICAgICAgICAgICAgICBhbmltYXRlOiBmYWxzZSxcclxuICAgICAgICAgICAgICAgIGZvY2FsOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgY2xpZW50WDogY2VudGVyLngsXHJcbiAgICAgICAgICAgICAgICAgICAgY2xpZW50WTogY2VudGVyLnlcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfTtcclxuICAgICAgICBDYW52YXMucHJvdG90eXBlLnpvb21JbiA9IGZ1bmN0aW9uIChkYXRhLCBlKSB7XHJcbiAgICAgICAgICAgIHRoaXMuZXhlY3V0ZVpvb20oZmFsc2UpO1xyXG4gICAgICAgIH07XHJcbiAgICAgICAgQ2FudmFzLnByb3RvdHlwZS56b29tT3V0ID0gZnVuY3Rpb24gKGRhdGEsIGUpIHtcclxuICAgICAgICAgICAgdGhpcy5leGVjdXRlWm9vbSh0cnVlKTtcclxuICAgICAgICB9O1xyXG4gICAgICAgIENhbnZhcy5CT0FSRF9XSURUSF9QWCA9IDEwMDA7XHJcbiAgICAgICAgQ2FudmFzLkJPQVJEX0hFSUdIVF9QWCA9IDEwMDA7XHJcbiAgICAgICAgQ2FudmFzLlpPT01fTUlOX1NDQUxFID0gMC4xO1xyXG4gICAgICAgIENhbnZhcy5aT09NX01BWF9TQ0FMRSA9IDQwO1xyXG4gICAgICAgIENhbnZhcy5VTlNUQUJMRV9aT09NID0gMC41O1xyXG4gICAgICAgIENhbnZhcy5NSU5fTU9VU0VfTU9WRV9QWCA9IDU7IC8vIG1pbmltdW0gbW91c2UgbW92ZSB0aGF0IHF1YWxpZmllcyBhcyBhIGRyYWdcclxuICAgICAgICBDYW52YXMuSU5JVElBTF9aT09NID0gMjA7XHJcbiAgICAgICAgLy8gMTYgY29sb3JzIGFjY29yZGluZyB0byB0aGlzOiBodHRwOi8vd3d3LmRlY2VtYmVyLmNvbS9odG1sL3NwZWMvY29sb3IxNmNvZGVzLmh0bWxcclxuICAgICAgICBDYW52YXMuQ09MT1JfUEFMRVRURV8xNiA9IFtcclxuICAgICAgICAgICAgeyByOiAwLCBnOiAwLCBiOiAwLCBhOiAyNTUsIHYzMjogMCB9LFxyXG4gICAgICAgICAgICB7IHI6IDEyOCwgZzogMTI4LCBiOiAxMjgsIGE6IDI1NSwgdjMyOiAwIH0sXHJcbiAgICAgICAgICAgIHsgcjogMTkyLCBnOiAxOTIsIGI6IDE5MiwgYTogMjU1LCB2MzI6IDAgfSxcclxuICAgICAgICAgICAgeyByOiAyNTUsIGc6IDI1NSwgYjogMjU1LCBhOiAyNTUsIHYzMjogMCB9LFxyXG4gICAgICAgICAgICB7IHI6IDEyOCwgZzogMCwgYjogMCwgYTogMjU1LCB2MzI6IDAgfSxcclxuICAgICAgICAgICAgeyByOiAyNTUsIGc6IDAsIGI6IDAsIGE6IDI1NSwgdjMyOiAwIH0sXHJcbiAgICAgICAgICAgIHsgcjogMTI4LCBnOiAxMjgsIGI6IDAsIGE6IDI1NSwgdjMyOiAwIH0sXHJcbiAgICAgICAgICAgIHsgcjogMjU1LCBnOiAyNTUsIGI6IDAsIGE6IDI1NSwgdjMyOiAwIH0sXHJcbiAgICAgICAgICAgIHsgcjogMCwgZzogMjU1LCBiOiAwLCBhOiAyNTUsIHYzMjogMCB9LFxyXG4gICAgICAgICAgICB7IHI6IDAsIGc6IDEyOCwgYjogMCwgYTogMjU1LCB2MzI6IDAgfSxcclxuICAgICAgICAgICAgeyByOiAwLCBnOiAxMjgsIGI6IDEyOCwgYTogMjU1LCB2MzI6IDAgfSxcclxuICAgICAgICAgICAgeyByOiAwLCBnOiAyNTUsIGI6IDI1NSwgYTogMjU1LCB2MzI6IDAgfSxcclxuICAgICAgICAgICAgeyByOiAwLCBnOiAwLCBiOiAxMjgsIGE6IDI1NSwgdjMyOiAwIH0sXHJcbiAgICAgICAgICAgIHsgcjogMCwgZzogMCwgYjogMjU1LCBhOiAyNTUsIHYzMjogMCB9LFxyXG4gICAgICAgICAgICB7IHI6IDEyOCwgZzogMCwgYjogMTI4LCBhOiAyNTUsIHYzMjogMCB9LFxyXG4gICAgICAgICAgICB7IHI6IDI1NSwgZzogMCwgYjogMjU1LCBhOiAyNTUsIHYzMjogMCB9IC8vIGZ1Y2hzaWFcclxuICAgICAgICBdO1xyXG4gICAgICAgIHJldHVybiBDYW52YXM7XHJcbiAgICB9KCkpO1xyXG4gICAgZXhwb3J0cy5DYW52YXMgPSBDYW52YXM7XHJcbn0pO1xyXG4vLyMgc291cmNlTWFwcGluZ1VSTD1jYW52YXMuanMubWFwIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///16\n")}]);).      [[?W[K   (    :https://pxdraw.azure.com/dist/bundle.js necko:classified 1 strongly-framed 1 security-info FnhllAKWRHGAlo+ESXykKAAAAAAAAAAAwAAAAAAAAEaphjojH6pBabDSgSnsfLHeAAQAAgAAAAAAAAAAAAAAAAAAAAAB4vFIJp5wRkeyPxAQ9RJGKPqbqVvKO0mKuIl8ec8o/uhmCjImkVxP+7sgiYWmMt8FvcOXmlQiTNWFiWlrbpbqgwAAAAAAAAOMMIIDiDCCAnCgAwIBAgIERTJfyDANBgkqhkiG9w0BAQsFADCBijEUMBIGA1UEBhMLUG9ydFN3aWdnZXIxFDASBgNVBAgTC1BvcnRTd2lnZ2VyMRQwEgYDVQQHEwtQb3J0U3dpZ2dlcjEUMBIGA1UEChMLUG9ydFN3aWdnZXIxFzAVBgNVBAsTDlBvcnRTd2lnZ2VyIENBMRcwFQYDVQQDEw5Qb3J0U3dpZ2dlciBDQTAeFw0xNDEwMjgxMzEyMTBaFw0zODEwMjgxMzEyMTBaMGAxFDASBgNVBAYTC1BvcnRTd2lnZ2VyMRQwEgYDVQQKEwtQb3J0U3dpZ2dlcjEXMBUGA1UECxMOUG9ydFN3aWdnZXIgQ0ExGTAXBgNVBAMTEHB4ZHJhdy5henVyZS5jb20wggEiMA0GCSqGSIb3DQEBAQUAA4IBDwAwggEKAoIBAQCKn7emKINsnWqPZ+C/VsqbQf/l4NsmIh34bXBR0xdNg9bfb+xcoghRlmbPjhZ/A26A2gJ6Rrg2d0GGMLpbqA8nTlRRGXEAD39321zk4ye09ElXClvqguGqdqOJpPQ05DPFD6wSOq+KVAEblE5bi+LMqBLipDERzgUe7xzeqVVk0i0ldh9yQOIk3YuzcBR9igSEuw5qladmMYvXKHYM9YZz0R7axMc8xAtadK7C9KfFPfEI5LS2nhmy4vBrTgFyYhfkEvKfmIj6HTX0ISFCAC2llcBLpEDcuiW76tAHp1pXDeWtSeaV36AeOctdleVgrbmsGs3fu6ppuRcWjEZUbjE3AgMBAAGjHzAdMBsGA1UdEQQUMBKCEHB4ZHJhdy5henVyZS5jb20wDQYJKoZIhvcNAQELBQADggEBAAooUdQc0CwE3/m74Y9pSOjtQ64B7k9z+ZSc48A5BjKKqq5Bvf2zqZzhq77eeNJBapw+qQsk/0oinYd4uCmq2JfETr2j30CJBYjEqCH4nUQd/CViduLFIuimI2z250lqn5Z2OJyTKtfNPj4KOgOuq+nJAvzDteb0LUXGOt4mI7QKKsM/Lfo2xRaujeq0iG5qV9VHmKXjHgzuP8/pdWT55D98WA5sD7AArK2easueQYhk0IvGbgJC9bFva6FHE37KlI+eBRqz/Uw8ouVVw4QdTtvO/I5gMTkHRRE7ZIyk0f4FMGIR/ewnGzwI4ziZM5zHVQ1Trp8BDFfwJ43cM731mYfALwEDAAAAAAEBAAAAAA== request-method GET request-Accept-Encoding gzip, deflate, br response-head HTTP/1.1 200 OK
Content-Type: application/x-javascript
Last-Modified: Sun, 06 May 2018 21:13:50 GMT
Accept-Ranges: bytes
Etag: "0bbee207fe5d31:0"
Vary: Accept-Encoding
Server: Microsoft-IIS/10.0
X-Powered-By: ASP.NET
Date: Sun, 28 Oct 2018 19:39:55 GMT
Content-Length: 325497
 original-response-headers Content-Type: application/x-javascript
Last-Modified: Sun, 06 May 2018 21:13:50 GMT
Accept-Ranges: bytes
Etag: "0bbee207fe5d31:0"
Vary: Accept-Encoding
Server: Microsoft-IIS/10.0
X-Powered-By: ASP.NET
Date: Sun, 28 Oct 2018 19:39:55 GMT
Connection: close
Content-Length: 325497
 uncompressed-len 0 net-response-time-onstart 9485 net-response-time-onstop 9491  y